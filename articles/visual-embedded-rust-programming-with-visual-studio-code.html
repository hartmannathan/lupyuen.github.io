<!doctype html>
<html lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=bsmaklHF" />
  <link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
  <link rel="canonical" href="https://lupyuen.org/articles/visual-embedded-rust-programming-with-visual-studio-code.html" />
  <!-- End Wayback Rewrite JS Include -->
  <title data-rh="true">Visual Embedded Rust Programming with Visual Studio Code</title>
  <meta data-rh="true" charset="utf-8" />
  <meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />
  <meta data-rh="true" name="theme-color" content="#000000" />
  <meta data-rh="true" property="og:type" content="article" />
  <meta data-rh="true" property="article:published_time" content="2019-08-26T17:36:51.946Z" />
  <meta data-rh="true" name="title" content="Visual Embedded Rust Programming with Visual Studio Code" />
  <meta data-rh="true" property="og:title" content="Visual Embedded Rust Programming with Visual Studio Code" />
  <meta data-rh="true" property="twitter:title" content="Visual Embedded Rust Programming with Visual Studio Code" />
  <meta data-rh="true" name="description"
    content="Create and edit Embedded Rust programs for STM32 Blue Pill and Apache Mynewt… By dragging and dropping blocks!" />
  <meta data-rh="true" property="og:description"
    content="Create and edit Embedded Rust programs for STM32 Blue Pill and Apache Mynewt… By dragging and dropping blocks!" />
  <meta data-rh="true" property="twitter:description"
    content="Create and edit Embedded Rust programs for STM32 Blue Pill and Apache Mynewt… By dragging and dropping blocks!" />
  <meta data-rh="true" name="twitter:card" content="summary_large_image" />
  <meta data-rh="true" name="twitter:creator" content="@MisterTechBlog" />
  <meta data-rh="true" name="author" content="Lup Yuen Lee 李立源" />
  <meta data-rh="true" name="robots" content="index,follow" />
  <meta data-rh="true" name="referrer" content="unsafe-url" />
  <meta data-rh="true" name="twitter:label1" value="Reading time" />
  <meta data-rh="true" name="twitter:data1" value="13 min read" />
  <meta property="og:image" 
  content="https://lupyuen.github.io/images/legacy/v1.png">

<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">

<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
    a {
        color: #77d;
    }
</style>
<!-- End scripts/rustdoc-header.html -->

</head>

<body>
  <div id="root">
    <div class="a b c">
      <article class="meteredContent">
        <section class="dm dn do dp ak dq bw n dr"></section><span class="r"></span>
        <div>
          <div class="ds u dt du dv dw"></div>
          <section class="dx dy dz ea eb">
            <div class="ec ak">
              <div class="figure ed ec ak paragraph-image">

                
                <p><img src="https://lupyuen.github.io/images/legacy/v1.png" /></p>


           
                <figcaption><p><em>IoT sensor device with STM32 Blue Pill
                  microcontroller, Quectel BC95-G global NB-IoT module and 18650 lithium ion battery</em></p></figcaption>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <div>
                  <div id="a459" class="fb fc fd at fe b ff fg fh fi fj fk fl">
                    <h1 class="fe b ff fm fd">Visual Embedded Rust Programming with Visual Studio Code</h1>
                  </div>
                  <div class="fn">
                    <div class="n fo fp fq fr">
                      <div class="o n">
                        <div><a
                            href="https://lupyuen.github.io"
                            rel="noopener">
                            <div class="eg fs ft">
                              <div class="fu n fv o p ds fw fx fy fz ga dw"></div>
                              
                            </div>
                          </a></div>
                        <div class="gc ak r">
                          <div class="n">
                            <div style="flex:1"><span class="as b at au av aw r fd q">
                                <div class="gd n o ge"><span class="as cx eu au cd gf gg gh gi gj fd"><a
                                      href="https://lupyuen.github.io"
                                      class="dc dd bb bc bd be bf bg bh bi gk bl bm gl gm" rel="noopener">Lup Yuen Lee
                                      李立源</a></span>

                                </div>
                              </span></div>
                          </div><span class="as b at au av aw r ax ay"><span class="as cx eu au cd gf gg gh gi gj ax">
                              <div><a class="dc dd bb bc bd be bf bg bh bi gk bl bm gl gm" rel="noopener"
                                  href="https://lupyuen.github.io">
                                  17 Aug 2019</a> <!-- -->·
                                <!-- -->
                                <!-- -->13
                                <!-- --> min read<span style="padding-left:4px"></span>
                              </div>
                            </span></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <p id="e13e" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Create and edit Embedded Rust
                  programs for STM32 Blue Pill and Apache Mynewt… By dragging and dropping blocks!</p>
                <div class="figure ib ic id ie if ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v2.png" /></p>
  
  
                
                  <figcaption><p><em>Tomato Crop and Temperature Sensors on Moon
                    Base One</em></p></figcaption>
                </div>
                <p id="722d" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="it">The year is 2029.
                    Humans are populating the Moon, starting at </em><a
                    href="https://lupyuen.github.io/articles/create-your-iot-gadget-with-apache-mynewt-and-stm32-blue-pill"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener"><em class="it">Moon Base One</em></a><em
                    class="it">.</em></p>
                <p id="27dc" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="it">You have one and
                    only one responsibility… Making sure that the crop garden on Moon Base One produces beautiful red
                    tomatoes.</em></p>
                <p id="28f5" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="it">How would you
                    create the IoT sensor devices to monitor the growing conditions of the crop garden?</em></p>
                <p id="0f9b" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="it">…Like reading the
                    temperature periodically and transmitting the data to an IoT server?</em></p>
                <p id="7711" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="it">Would you open up
                    a text editor and write a C program to control the sensor devices?</em></p>
                <p id="61f5" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="it">And troubleshoot
                    problems with invalid C pointers crashing the sensor devices?</em></p>
                <p id="d6dd" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="it">Fortunately in
                    2029 there will be a better way to create embedded programs…</em> <strong class="ho iy">Visual
                    Embedded Rust!</strong></p>
              </div>
            </div>
            <div class="ec ak">
              <div class="figure ib ic id ie if ec ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy/v3.gif" /></p>


              
                <figcaption><p><em>Create programs for IoT devices… Just by
                  dragging and dropping!</em></p></figcaption>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <div class="figure jb jc jd je jf ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v4.jpeg" /></p>
  
  
                
                  <figcaption><p><em>STM32 Blue Pill, the $2 microcontroller inside
                    our IoT sensor gadget. Powered by a 18650 lithium ion battery (in pink). Connected to NB-IoT network
                    via a Quectel BC95-G Global NB-IoT module (top left).</em></p></figcaption>
                </div>
                <p id="4d16" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Today we’ll learn to create an
                  IoT sensor application for a microcontroller that’s tiny, affordable (under $2) and yet packs a
                  powerful punch… <a
                    href="https://github.com/jeelabs/embello/blob/master/docs/hardware/bluepill.md"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener"><strong class="ho iy">STM32 Blue
                      Pill</strong></a>.</p>
                <p id="b490" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Instead of coding in C, we’ll do
                  it the futuristic way — by <strong class="ho iy">drawing the program with blocks</strong>!</p>
                <p id="e533" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Our visual program will be
                  converted into <a href="https://www.rust-lang.org/"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener"><strong class="ho iy">Rust</strong></a>, a
                  modern programming language that performs well on the tiniest microcontrollers.</p>
                <p id="189f" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Rust enables us to write Safe
                  Code, so our devices won’t crash due to bad pointers.</p>
                <p id="16d6" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">If you don’t have a Blue Pill (<a
                    href="https://www.aliexpress.com/wholesale?catId=0&amp;initiative_id=SB_20180924131057&amp;SearchText=stm32f103c8t6+development+board&amp;switch_new_app=y"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">under $2 at AliExpress</a>), no worries!
                  You’re invited on our journey to learn and understand how IoT programs could be created visually.</p>
                <p id="7a31" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">💎 <em class="it">If you’re a
                    seasoned coder like me, we have goodies for you too! You’ll find </em><a
                    href="https://lupyuen.github.io/articles/advanced-topics-for-visual-embedded-rust-programming"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener"><em class="it">Advanced Topics</em></a><em
                    class="it"> in the second half of this tutorial, watch out for the diamond </em>💎<em class="it">
                    icons</em></p>
              </div>
            </div>
          </section>
          <hr class="jh cx ji jj jk ex jl jm jn jo jp" />
          <section class="dx dy dz ea eb">
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <h1 id="5f81" class="jq jr fd at as js jt ju jv jw jx jy jz ka kb kc kd">Our First Visual Rust Program
                </h1>
                <p id="2568" class="hm hn fd at ho b hp ke hr kf ht kg hv kh hx ki hz">For the first part of the
                  tutorial, all we need is a computer (Windows, macOS or Linux). We’ll create a simple Visual Program,
                  just follow these steps…</p>
                <p id="5963" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">1️⃣ Install <a
                    href="https://code.visualstudio.com/"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener"><strong class="ho iy">Visual Studio
                      Code</strong></a></p>
                <p id="7c8d" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Are you using a Raspberry Pi or
                  Nvidia Jetson Nano?<br />Get the <a
                    href="https://code.headmelted.com/"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">community build of Visual Studio Code</a>
                </p>
                <div class="figure ib ic id ie if ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v5.png" /></p>
  
  
                </div>
                <p id="a9d8" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">2️⃣ Launch Visual Studio Code</p>
                <p id="0bb8" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Click <code
                    class="eo kl km kn ko b">Extensions</code></p>
              </div>
            </div>
            <div class="ec ak">
              <div class="figure ib ic id ie if ec ak paragraph-image">

                
                <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>



               
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <div class="figure jb jc jd je jf ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">

                
                  <p><img src="https://lupyuen.github.io/images/legacy/v6.png" /></p>

  
  
               
                </div>
                <p id="0cc5" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">3️⃣ Search for <code
                    class="eo kl km kn ko b">&quot;visual embedded rust&quot;</code> with quotes</p>
                <p id="2f9d" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Click <code
                    class="eo kl km kn ko b">Install</code> to install the <strong class="ho iy">Visual Embedded
                    Rust</strong> extension</p>
                <p id="c8f1" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Or <a
                    href="https://marketplace.visualstudio.com/items?itemName=LeeLupYuen.visual-embedded-rust"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">click this link</a></p>
              </div>
            </div>
            <div class="ec ak">
              <div class="figure ib ic id ie if ec ak paragraph-image">

                
                <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>



              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <div class="figure jb jc jd je jf ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v7.png" /></p>
  
    
  
                </div>
                <p id="d0b5" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">4️⃣ Click <code
                    class="eo kl km kn ko b">File → Open</code> to open any folder</p>
              </div>
            </div>
            <div class="ec ak">
              <div class="figure ib ic id ie if ec ak paragraph-image">

                
                <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>



               
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <div class="figure jb jc jd je jf ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v8.png" /></p>
  
  
                
                </div>
                <p id="3702" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">5️⃣ In the <code
                    class="eo kl km kn ko b">Explorer → (Folder Name)</code> pane at top left, create a new Rust source
                  file, like <code class="eo kl km kn ko b">lib.rs</code></p>
              </div>
            </div>
            <div class="ec ak">
              <div class="figure ib ic id ie if ec ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>


             
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <div class="figure jb jc jd je jf ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v9.png" /></p>
  
  
                </div>
                <p id="0692" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">6️⃣ Edit the Rust source file.
                  Click <code class="eo kl km kn ko b">Visual Editor</code> at top right</p>
              </div>
            </div>
            <div class="ec ak">
              <div class="figure ib ic id ie if ec ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>


            
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <div class="figure jb jc jd je jf ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v10.png" /></p>
  
  
               
                </div>
                <p id="6bcd" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">7️⃣ When prompted to populate the
                  visual program into the Rust source file, click <code class="eo kl km kn ko b">OK</code></p>
                <p id="8d0e" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">8️⃣ Click the Rust source file to
                  see the generated Rust code. Save the file to save the visual program.</p>
                <p id="bcfb" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">You should see the screen below.
                  Let’s study the four main blocks (or functions) in the Visual Program…</p>
              </div>
            </div>
            <div class="ec">
              <div class="n p">
                <div class="la lb lc ld le lf ag lg ah lh aj ak">
                  <div class="figure ib ic id ie if ec lj lk paragraph-image">
                
                    <p><img src="https://lupyuen.github.io/images/legacy/v11.png" /></p>
    
    
               
                    <figcaption><p><em>Editing a Visual Embedded Rust program with
                      Visual Studio Code</em></p></figcaption>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <hr class="jh cx ji jj jk ex jl jm jn jo jp" />
          <section class="dx dy dz ea eb">
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <h1 id="a6ca" class="jq jr fd at as js jt ju jv jw jx jy jz ka kb kc kd">[1] On Start</h1>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v12.png" /></p>
  
  
                
                </div>
                <p id="7df5" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><code
                    class="eo kl km kn ko b">On Start</code> marks the start of the program. Here we define some
                  constants — values used by the program that won’t change as the program runs…</p>
                <p id="2f47" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">1️⃣ <code
                    class="eo kl km kn ko b">SENSOR_DEVICE</code> is the name of the sensor that the program will poll
                  (check periodically). We’ll be polling Blue Pill’s Internal Temperature Sensor, which is named <code
                    class="eo kl km kn ko b">temp_stm32_0</code></p>
                <p id="7c4d" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">2️⃣ <code
                    class="eo kl km kn ko b">SENSOR_POLL_TIME</code> is the time interval (in milliseconds) for polling
                  the sensor. We’ll set this to 10 seconds (or 10,000 milliseconds)</p>
                <p id="50d6" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">3️⃣ <code
                    class="eo kl km kn ko b">TEMP_SENSOR_KEY</code> is the name of the sensor data field that our
                  program will send to the server. We’ll call it <code class="eo kl km kn ko b">t</code> to tell the
                  server we’re sending a temperature value.</p>
                <p id="23b8" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">4️⃣ <code
                    class="eo kl km kn ko b">TEMP_SENSOR_TYPE</code> is the type of sensor data that our program will
                  send: Raw ambient temperature in whole numbers (integers from <code class="eo kl km kn ko b">0</code>
                  to <code class="eo kl km kn ko b">4095</code>), hence <code
                    class="eo kl km kn ko b">SENSOR_TYPE_AMBIENT_TEMPERATURE_RAW</code></p>
                <p id="ff56" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Why do we send the temperature in
                  raw form instead of the usual decimal (floating-point) form like <code
                    class="eo kl km kn ko b">28.9</code> degrees Celsius? That’s because Blue Pill has very limited RAM
                  and ROM. Sending the raw temperature without conversion will save us from reserving RAM and ROM that
                  would be needed for the floating-point conversion. We’ll let the server convert instead.</p>
                <p id="4b38" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">By Rust convention, constants are
                  named in uppercase. Hence we name the constants as <code class="eo kl km kn ko b">SENSOR_DEVICE</code>
                  instead of <code class="eo kl km kn ko b">sensor_device</code></p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v13.png" /></p>
  
  
                  
                </div>
                <p id="a9c2" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Next we call the function <code
                    class="eo kl km kn ko b">start_sensor_listener</code> to begin polling the temperature sensor every
                  10 seconds. More about this in the next section.</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v14.png" /></p>
  
  
                
                </div>
                <p id="f2ad" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Finally we call <code
                    class="eo kl km kn ko b">start_server_transport</code>, which is a system function defined in the
                  <code class="eo kl km kn ko b">sensor_network</code> library. This function starts a background task
                  to establish a connection to the NB-IoT network. For this tutorial, we’ll be transmitting sensor data
                  over the <a
                    href="https://en.wikipedia.org/wiki/Narrowband_IoT"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">NB-IoT network</a>, which is available
                  worldwide.</p>
                <p id="fbd4" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">It may take a few seconds to
                  complete, but the function executes in the background so it won’t hold up other tasks, like polling
                  the temperature sensor.</p>
                <p id="3aeb" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Take note of the Rust convention…
                  <code class="eo kl km kn ko b">sensor_network::start_server_transport</code> refers to the function
                  <code class="eo kl km kn ko b">start_server_transport</code> that’s found inside the Rust Library
                  <code class="eo kl km kn ko b">sensor_network</code>. Rust Libraries are also known as “Crates”.</p>
                <div class="figure ib ic id ie if ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v15.png" /></p>
  
  
                
                  <figcaption><p><em>Blocks Bar</em></p></figcaption>
                </div>
                <p id="6dbf" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="it">How was the
                  </em><code class="eo kl km kn ko b"><em class="it">On Start</em></code><em class="it"> function
                    created?</em></p>
                <p id="3c5a" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">By dragging and dropping the
                  blocks from the Blocks Bar at the left of the Visual Program.</p>
                <p id="d3e9" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">That’s how we create a Visual
                  Program… By arranging the blocks to compose a program!</p>
                <p id="7d7b" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Check this out…</p>
                <p id="8dd9" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><a
                    href="https://weibo.com/7285313566/I2MOamxS9"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">微博视频</a></p>
              </div>
            </div>
            <div class="ec">
              <div class="n p">
                <div class="la lb lc ld le lf ag lg ah lh aj ak">
                  <div class="figure ib ic id ie if ec">
                    <div class="en r eg">
                      <div class="lu r"><iframe
                          src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FQw1N-01PAy8%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DQw1N-01PAy8&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FQw1N-01PAy8%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                          allowfullscreen="" frameborder="0" height="300" width="400"
                          title="Visual Embedded Rust with Visual Studio Code: On Start" class="ds t u ek ak"
                          scrolling="auto"></iframe></div>
                    </div>
                    <figcaption><p><em>Creating the On Start function with Visual
                      Embedded Rust</em></p></figcaption>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <hr class="jh cx ji jj jk ex jl jm jn jo jp" />
          <section class="dx dy dz ea eb">
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <h1 id="3773" class="jq jr fd at as js jt ju jv jw jx jy jz ka kb kc kd">[2] Start Sensor Listener</h1>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v16.png" /></p>
  
  
                </div>
                <p id="1e30" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><code
                    class="eo kl km kn ko b">To start_sensor_listener With ...</code> is the way that we define
                  functions in the Visual Program. Here we define <code
                    class="eo kl km kn ko b">start_sensor_listener</code> as a function that accepts 4 parameters (or
                  inputs), whose values we have seen from the previous section…</p>
                <p id="0faf" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">1️⃣ <code
                    class="eo kl km kn ko b">sensor_name</code>: Name of the sensor to be polled. Set to <code
                    class="eo kl km kn ko b">SENSOR_DEVICE</code> (i.e. <code
                    class="eo kl km kn ko b">temp_stm32_0</code>)</p>
                <p id="0676" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">2️⃣ <code
                    class="eo kl km kn ko b">sensor_key</code>: Name of the sensor data field to be sent to the server.
                  Set to <code class="eo kl km kn ko b">TEMP_SENSOR_KEY</code> (i.e. <code
                    class="eo kl km kn ko b">t</code>)</p>
                <p id="782c" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">3️⃣ <code
                    class="eo kl km kn ko b">sensor_type</code>: Type of sensor data that will be sent to the server.
                  Set to <code class="eo kl km kn ko b">SENSOR_TYPE_AMBIENT_TEMPERATURE_RAW</code></p>
                <p id="1652" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">4️⃣ <code
                    class="eo kl km kn ko b">poll_time</code>: Time interval (in milliseconds) for polling the sensor.
                  Set to <code class="eo kl km kn ko b">SENSOR_POLL_TIME</code> (i.e. 10,000 milliseconds or 10 seconds)
                </p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v17.png" /></p>
  
  
             
                </div>
                <p id="c755" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Next we call the system function
                  <code class="eo kl km kn ko b">set_poll_rate_ms</code>, defined in the <code
                    class="eo kl km kn ko b">sensor</code> library. The <code class="eo kl km kn ko b">sensor</code>
                  library comes from the <a href="https://mynewt.apache.org/"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">Apache Mynewt operating system</a>, which
                  manages all sensors on the Blue Pill.</p>
                <p id="8ebb" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">By calling the function <code
                    class="eo kl km kn ko b">set_poll_rate_ms</code> with <code
                    class="eo kl km kn ko b">sensor_name</code> set to <code
                    class="eo kl km kn ko b">temp_stm32_0</code> and <code class="eo kl km kn ko b">poll_time</code> set
                  to <code class="eo kl km kn ko b">10000</code> (milliseconds), we are asking the system to poll the
                  temperature sensor every 10 seconds. And the system will happily fetch the temperature value on our
                  behalf every 10 seconds.</p>
                <p id="7ba2" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">What shall we do with the
                  temperature value? We’ll define a Listener Function to transmit the data. But first…</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v18.png" /></p>
  
  
               
                </div>
                <p id="286b" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">We call function <code
                    class="eo kl km kn ko b">mgr_find_next_bydevname</code> (also from the <code
                    class="eo kl km kn ko b">sensor</code> library) to fetch the sensor driver from the system and store
                  it in the variable <code class="eo kl km kn ko b">sensor_driver</code>. By passing the <code
                    class="eo kl km kn ko b">sensor_name</code> as <code class="eo kl km kn ko b">temp_stm32_0</code>,
                  the function returns the driver responsible for managing the temperature sensor. The driver will be
                  used for setting the Listener Function in a while.</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v19.png" /></p>
  
  
            
                </div>
                <p id="1844" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Before that, we check the sensor
                  driver was actually found. If we had misspelt the name of the sensor, the sensor driver would not be
                  found and it would be set to <code class="eo kl km kn ko b">null</code>, a special Rust value that
                  means “nothing”. Hence we check to ensure that <code class="eo kl km kn ko b">sensor_driver</code> is
                  not <code class="eo kl km kn ko b">null</code>.</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v20.png" /></p>
  
  
             
                </div>
                <p id="2db8" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">We create a sensor listener
                  (stored as <code class="eo kl km kn ko b">listener</code>) by calling the system function <code
                    class="eo kl km kn ko b">new_sensor_listener</code>, passing in the <code
                    class="eo kl km kn ko b">sensor_key</code> (set to <code class="eo kl km kn ko b">t</code>) and the
                  <code class="eo kl km kn ko b">sensor_type</code> (raw ambient temperature). <code
                    class="eo kl km kn ko b">func</code> is the name of the Listener Function that will be called after
                  reading the sensor data: <code class="eo kl km kn ko b">handle_sensor_data</code>. Which we’ll cover
                  in the next section.</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v21.png" /></p>
  
  
                
                </div>
                <p id="5b95" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">To register the Listener Function
                  in the system, we call the system function <code class="eo kl km kn ko b">register_listener</code>,
                  passing in the <code class="eo kl km kn ko b">sensor_driver</code> and the sensor listener that we
                  have just created.</p>
                <p id="973e" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">After that, the operating system
                  will automatically read the temperature sensor every 10 seconds and call our function <code
                    class="eo kl km kn ko b">handle_sensor_data</code> with the temperature value.</p>
                <p id="88aa" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">If you’re curious how the
                  complicated <code class="eo kl km kn ko b">start_sensor_listener</code> function was created from
                  scratch, check out this video…</p>
                <p id="8cc6" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><a
                    href="https://weibo.com/7285313566/I2MWZ1CnK"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">微博视频</a></p>
              </div>
            </div>
            <div class="ec">
              <div class="n p">
                <div class="la lb lc ld le lf ag lg ah lh aj ak">
                  <div class="figure ib ic id ie if ec">
                    <div class="en r eg">
                      <div class="me r"><iframe
                          src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FytGa-7q6sqY%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DytGa-7q6sqY&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FytGa-7q6sqY%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                          allowfullscreen="" frameborder="0" height="480" width="854"
                          title="Visual Embedded Rust with Visual Studio Code: Start Sensor Listener"
                          class="ds t u ek ak" scrolling="auto"></iframe></div>
                    </div>
                    <figcaption><p><em>Creating the start_sensor_listener function
                      with Visual Embedded Rust</em></p></figcaption>
                  </div>
                </div>
              </div>
            </div>
          </section>
          <hr class="jh cx ji jj jk ex jl jm jn jo jp" />
          <section class="dx dy dz ea eb">
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <h1 id="fcb1" class="jq jr fd at as js jt ju jv jw jx jy jz ka kb kc kd">[3] Handle Sensor Data</h1>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v22.png" /></p>
  
  
                 
                </div>
                <p id="60ec" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">How shall we handle the
                  temperature data that has been read? <code class="eo kl km kn ko b">handle_sensor_data</code> passes
                  the sensor data to another function <code class="eo kl km kn ko b">send_sensor_data</code> that
                  transmits the sensor data to the server. More about <code
                    class="eo kl km kn ko b">send_sensor_data</code> in a while.</p>
                <p id="64cb" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">The function <code
                    class="eo kl km kn ko b">handle_sensor_data</code> doesn’t seem to do much… why did we design the
                  program this way? It’s meant for future expansion — when we need more complicated logic for handling
                  sensor data, we’ll put the logic into <code class="eo kl km kn ko b">handle_sensor_data</code></p>
                <p id="90aa" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><code
                    class="eo kl km kn ko b">handle_sensor_data</code> could be extended to handle multiple sensors,
                  aggregating the sensor data before transmitting. Or it could check for certain conditions and decide
                  whether it should transmit the data. This program structure gives us the most room to expand for the
                  future.</p>
              </div>
            </div>
          </section>
          <hr class="jh cx ji jj jk ex jl jm jn jo jp" />
          <section class="dx dy dz ea eb">
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <h1 id="d236" class="jq jr fd at as js jt ju jv jw jx jy jz ka kb kc kd">[4] Send Sensor Data</h1>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v23.png" /></p>
  
  
              
                </div>
                <p id="5b88" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">The final function in our
                  program, <code class="eo kl km kn ko b">send_sensor_data</code>, is called by <code
                    class="eo kl km kn ko b">handle_sensor_data</code> to transmit sensor data. The parameter <code
                    class="eo kl km kn ko b">sensor_data</code> contains the field name <code
                    class="eo kl km kn ko b">t</code> and the sensor value, like <code
                    class="eo kl km kn ko b">1715</code>. Remember that this is a raw temperature value. The server will
                  convert the raw value to degrees Celsius later.</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v24.png" /></p>
  
  
               
                </div>
                <p id="4e87" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">We call <code
                    class="eo kl km kn ko b">get_device_id</code> from the <code
                    class="eo kl km kn ko b">sensor_network</code> library to fetch the Device ID from the system. This
                  is a long string of random letters and digits like <code
                    class="eo kl km kn ko b">a8b2c7d8e9b2...</code> Each time we restart Blue Pill we’ll get a different
                  Device ID. We’ll use this Device ID later to identify our Blue Pill uniquely and check whether the
                  server has received the temperature sensor data from our Blue Pill.</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v25.png" /></p>
  
  
              
                </div>
                <p id="9a98" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Next we call <code
                    class="eo kl km kn ko b">init_server_post</code> (also from <code
                    class="eo kl km kn ko b">sensor_network</code> library) to prepare a sensor data message that will
                  be sent to the server. Because Blue Pill has limited RAM, this function will ensure that only one task
                  is allowed to compose messages at any time. The other tasks will have to wait for their turn.</p>
                <p id="f759" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><code
                    class="eo kl km kn ko b">init_server_post</code> returns a true/false result (known as a boolean)
                  that indicates whether the NB-IoT network connection has been established. This stored in the variable
                  <code class="eo kl km kn ko b">network_ready</code>.</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v26.png" /></p>
  
  
              
                </div>
                <p id="85d1" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Only when <code
                    class="eo kl km kn ko b">network_ready</code> is true, which means that the device has connected to
                  the NB-IoT network, then we proceed to compose a CoAP Message.</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v27.png" /></p>
  
  
               
                </div>
                <p id="19b4" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><a
                    href="https://en.wikipedia.org/wiki/Constrained_Application_Protocol"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">What’s a CoAP Message</a>? It’s a standard
                  format for transmitting sensor data over NB-IoT. Here we are transmitting two data values in the CoAP
                  Message...</p>
                <p id="d62e" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">1️⃣ <code
                    class="eo kl km kn ko b">device_id</code>: The randomly-generated Device ID that uniquely identifies
                  our Blue Pill. This field shall be transmitted with the field name <code
                    class="eo kl km kn ko b">device</code></p>
                <p id="9f4b" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">2️⃣ <code
                    class="eo kl km kn ko b">sensor_data</code>: Contains the field name <code
                    class="eo kl km kn ko b">t</code> and the sensor value, like <code
                    class="eo kl km kn ko b">1715</code></p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v28.png" /></p>
  
  
             
                </div>
                <p id="f1be" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">The CoAP Message is transmitted
                  only when function <code class="eo kl km kn ko b">do_server_post</code> is called. Again this
                  transmission takes place in a background task, so it won’t hold up our program from polling the
                  sensor.</p>
                <p id="32ce" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Notice that <code
                    class="eo kl km kn ko b">_payload</code> is named differently… it begins with an underscore <code
                    class="eo kl km kn ko b">_</code>. By Rust convention, variables that are set but not read should be
                  named with an underscore <code class="eo kl km kn ko b">_</code> as the first character. Because the
                  Rust Compiler will warn us about unused variables.</p>
                <p id="c26d" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">This effectively tells the Rust
                  Compiler: <em class="it">“Yes I’m setting the variable </em><code
                    class="eo kl km kn ko b">_payload</code><em class="it"> and I’m not using the value… Please don’t
                    warn me that I may have misspelt the name </em><code class="eo kl km kn ko b">_payload</code><em
                    class="it">&quot;</em></p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v29.png" /></p>
  
  
                
                </div>
                <p id="fcd5" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">At the end of the function, we
                  display a URL in the Blue Pill log that contains the Device ID. The URL looks like this: <code
                    class="eo kl km kn ko b">https://blue-pill-geolocate.appspot.com/?device=5cfca8c…</code></p>
                <p id="32a9" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Later we’ll click this URL to
                  verify that the server has received our sensor data.</p>
                <blockquote class="mr ms mt">
                  <p id="a217" class="hm hn fd it ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="at">💎 </em>CoAP
                    Messages are explained <a
                      href="https://lupyuen.github.io/articles/get-started-with-nb-iot-and-quectel-modules"
                      class="dc by iu iv iw ix" target="_blank" rel="noopener">in this article</a></p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="jh cx ji jj jk ex jl jm jn jo jp" />
          <section class="dx dy dz ea eb">
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <h1 id="b2bb" class="jq jr fd at as js jt ju jv jw jx jy jz ka kb kc kd">The Visual Program</h1>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v30.png" /></p>
  
  
             
                </div>
                <p id="1083" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">And that’s the complete program
                  for an IoT sensor device that reads the temperature sensor every 10 seconds and transmits the data to
                  the server over the NB-IoT network.</p>
                <p id="7fbe" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">When expressed as a Visual
                  Program, it looks so simple and elegant! Now let’s prove to ourselves that it really works…</p>
                <blockquote class="mr ms mt">
                  <p id="1dac" class="hm hn fd it ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="at">💎 </em>The Rust
                    code that’s generated is a special kind of Rust code known as “Typeless Rust”. Check the sections
                    “<a
                      href="https://lupyuen.github.io/articles/advanced-topics-for-visual-embedded-rust-programming"
                      class="dc by iu iv iw ix" target="_blank" rel="noopener">What’s Wrong With Rust? Types</a>!” and
                    “<a
                      href="https://lupyuen.github.io/articles/advanced-topics-for-visual-embedded-rust-programming"
                      class="dc by iu iv iw ix" target="_blank" rel="noopener">Typeless Rust</a>”. To understand the
                    generated Rust code, <a
                      href="https://lupyuen.github.io/articles/rust-rocks-nb-iot-stm32-blue-pill-with-quectel-bc95-g-on-apache-mynewt"
                      class="dc by iu iv iw ix" target="_blank" rel="noopener">read this article</a></p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="jh cx ji jj jk ex jl jm jn jo jp" />
          <section class="dx dy dz ea eb">
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <h1 id="a487" class="jq jr fd at as js jt ju jv jw jx jy jz ka kb kc kd">Compile The Rust Program</h1>
                <p id="9a93" class="hm hn fd at ho b hp ke hr kf ht kg hv kh hx ki hz">Ready to experience for yourself
                  how a Rust program gets compiled into ROM firmware? You don’t need a Blue Pill yet, just follow these
                  steps…</p>
                <p id="63db" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">1️⃣ Follow the <a
                    href="https://lupyuen.github.io/articles/install-embedded-rust-and-apache-mynewt-for-visual-studio-code-on-windows"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">instructions here to install Embedded Rust
                    and Apache Mynewt</a></p>
                <p id="d0af" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">You may skip the sections <em
                    class="it">“Optional: Install Rust Language Server”</em> and <em class="it">“Optional: Program
                    Settings”</em></p>
                <p id="7571" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">2️⃣ Copy your Visual Program
                  source file to <code class="eo kl km kn ko b">stm32bluepill-mynewt-sensor/rust/app/src/lib.rs</code>.
                  Overwrite the existing file.</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v31.png" /></p>
  
  
                
                </div>
                <p id="aafc" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">3️⃣ Delete the files <code
                    class="eo kl km kn ko b">app_network.rs</code> and <code
                    class="eo kl km kn ko b">app_sensor.rs</code> in that folder</p>
                <p id="6214" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">4️⃣ Compile the Rust program by
                  clicking <code class="eo kl km kn ko b">Terminal → Run Task → [2] Build bluepill_my_sensor</code></p>
                <p id="6a3a" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">When our Rust program has been
                  successfully compiled as Blue Pill ROM firmware, we should see this…</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v32.png" /></p>
  
  
                  
                </div>
                <p id="6e0e" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">If you wish to make any changes
                  to the Visual Program, use the Visual Editor to edit the file <code
                    class="eo kl km kn ko b">stm32bluepill-mynewt-sensor/rust/app/src/lib.rs</code></p>
                <blockquote class="mr ms mt">
                  <p id="acc6" class="hm hn fd it ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="at">💎 </em>How was
                    the Rust code merged into the Mynewt build? Check the section “<a
                      href="https://lupyuen.github.io/articles/rust-rocks-nb-iot-stm32-blue-pill-with-quectel-bc95-g-on-apache-mynewt"
                      class="dc by iu iv iw ix" target="_blank" rel="noopener">Advanced Topic: Hosting Rust on
                      Mynewt</a>”</p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="jh cx ji jj jk ex jl jm jn jo jp" />
          <section class="dx dy dz ea eb">
            <div class="ec">
              <div class="n p">
                <div class="la lb lc ld le lf ag lg ah lh aj ak">
                  <div class="figure ib ic id ie if ec lj lk paragraph-image">
                
                    <p><img src="https://lupyuen.github.io/images/legacy/v33.jpeg" /></p>
    
    
             
                    <figcaption><p><em>Blue Pill connected to Quectel BC95-G NB-IoT
                      module and ST-Link V2</em></p></figcaption>
                  </div>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <h1 id="483b" class="jq jr fd at as js jt nb jv nc jx nd jz ne kb nf kd">Flash The Firmware To Blue Pill
                </h1>
                <p id="8bcd" class="hm hn fd at ho b hp ke hr kf ht kg hv kh hx ki hz">Time to use our Blue Pill! The
                  next step is to flash the firmware into Blue Pill’s ROM. We’ll need to connect the Blue Pill to the
                  USB port of our computer via an <a
                    href="https://www.aliexpress.com/wholesale?catId=0&amp;initiative_id=SB_20180924134644&amp;SearchText=st-link+v2&amp;switch_new_app=y"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">ST-Link V2 adapter</a>.</p>
                <p id="1c8a" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><strong class="ho iy"><em
                      class="it">Optional:</em></strong> To transmit sensor data over the NB-IoT network, we’ll also
                  need a <a
                    href="https://www.aliexpress.com/wholesale?catId=0&amp;initiative_id=SB_20190725022150&amp;SearchText=bc95-g+nb101&amp;switch_new_app=y"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">Quectel BC95-G Global NB-IoT Module</a>
                  (breakout board with antenna). And an NB-IoT SIM from your local NB-IoT network operator.</p>
                <p id="537b" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">1️⃣ Connect the hardware by <a
                    href="https://lupyuen.github.io/articles/connect-the-nb-iot-hardware-stm32-blue-pill-and-quectel-bc95-g-module"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">following the instructions here</a></p>
                <div class="figure ib ic id ie if ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v34.jpeg" /></p>
  
  
             
                  <figcaption><p><em>Blue Pill and ST-Link connected to USB port
                  </em></p></figcaption>
                </div>
                <p id="57ae" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">2️⃣ Check that the Blue Pill is
                  connected to ST-Link…</p>
                <p id="7b56" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">And that the ST-Link is connected
                  to your computer’s USB port.</p>
                <p id="e455" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Now let’s head back to Visual
                  Studio Code…</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>


            
                </div>
                <p id="8762" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">3️⃣ Click <code
                    class="eo kl km kn ko b">Terminal → Run Task → [4] Load bluepill_boot</code></p>
                <p id="a933" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">This flashes the bootloader to
                  Blue Pill, to start the Apache Mynewt operating system upon startup. If it shows errors, compare with
                  <a href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-nbiot/logs/load-bootloader.log"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">this flash log</a>.</p>
                <p id="c69e" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">4️⃣ Click <code
                    class="eo kl km kn ko b">Terminal → Run Task → [5] Load bluepill_my_sensor</code></p>
                <p id="6784" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">This flashes the firmware
                  (containing our Visual Program) to Blue Pill. If it shows errors, compare with <a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-nbiot/logs/load-application.log"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">this flash log</a>.</p>
                <blockquote class="mr ms mt">
                  <p id="f2c6" class="hm hn fd it ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="at">💎 </em>Blue
                    Pill was chosen for a reason… Check the section “<a
                      href="https://lupyuen.github.io/articles/advanced-topics-for-visual-embedded-rust-programming"
                      class="dc by iu iv iw ix" target="_blank" rel="noopener">Why Blue Pill? Power vs Price
                      Compromise</a>”</p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="jh cx ji jj jk ex jl jm jn jo jp" />
          <section class="dx dy dz ea eb">
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <h1 id="11c0" class="jq jr fd at as js jt ju jv jw jx jy jz ka kb kc kd">Run The Program</h1>
                <p id="ddac" class="hm hn fd at ho b hp ke hr kf ht kg hv kh hx ki hz">Now we are ready to run the
                  Visual Program on our Blue Pill IoT device!</p>
                <p id="170c" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">1️⃣ Click <code
                    class="eo kl km kn ko b">Debug → Start Debugging</code></p>
                <div class="figure ib ic id ie if ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v35.png" /></p>
  
  
              
                </div>
                <p id="3235" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">2️⃣ Click <code
                    class="eo kl km kn ko b">View → Output</code></p>
                <p id="42e0" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Select <code
                    class="eo kl km kn ko b">Adapter Output</code> to see the Blue Pill log</p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/a0.png" /></p>


                </div>
                <div class="figure ew ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v36.png" /></p>
  
  
            
                </div>
                <p id="8d04" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">3️⃣ The debugger pauses at the
                  line with <code class="eo kl km kn ko b">LoopCopyDataInit</code></p>
                <p id="e66e" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Click <code
                    class="eo kl km kn ko b">Continue</code> or press <code class="eo kl km kn ko b">F5</code></p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/a0.png" /></p>


           
                </div>
                <div class="figure ew ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v37.png" /></p>
  
  
                </div>
                <p id="04a7" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">4️⃣ The debugger pauses next at
                  the <code class="eo kl km kn ko b">main()</code> function.</p>
                <p id="8483" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Click <code
                    class="eo kl km kn ko b">Continue</code> or press <code class="eo kl km kn ko b">F5</code></p>
                <div class="figure ib ic id ie if ec do dp paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/a0.png" /></p>


            
                </div>
                <p id="5fe3" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Our Blue Pill should now poll its
                  internal temperature sensor every 10 seconds. It should also transmit the temperature data to the CoAP
                  server hosted at thethings.io. Exactly like the temperature sensor on Moon Base One!</p>
                <p id="23d9" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Here’s what you’ll see…</p>
                <p id="9a3d" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz"><a
                    href="https://weibo.com/7285313566/I2MZOeP0F"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">微博视频</a></p>
              </div>
            </div>
            <div class="ec">
              <div class="n p">
                <div class="la lb lc ld le lf ag lg ah lh aj ak">
                  <div class="figure ib ic id ie if ec">
                    <div class="en r eg">
                      <div class="lu r"><iframe
                          src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FPL4Yj3IS5ck%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DPL4Yj3IS5ck&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FPL4Yj3IS5ck%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                          allowfullscreen="" frameborder="0" height="300" width="400"
                          title="Debugging a Visual Embedded Rust program" class="ds t u ek ak"
                          scrolling="auto"></iframe></div>
                    </div>
                    <figcaption><p><em>Running the Visual Embedded Rust program
                    </em></p></figcaption>
                  </div>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <p id="9d3a" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">The Blue Pill log <a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/blob/rust-nbiot/logs/visual.log"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener">should look like this</a>.</p>
                <div class="figure ib ic id ie if ec et ig bv ih ii ij ik il bg im in io ip iq ir paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/v38.png" /></p>
  
  
             
                </div>
                <p id="4d19" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">Upon clicking the URL <code
                    class="eo kl km kn ko b">https://blue-pill-geolocate.appspot.com/?device=5cfca8c…</code> that’s
                  shown in the Blue Pill log, we’ll see a web page that displays the temperature received by the server
                  at thethings.io.</p>
                <p id="8ee4" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">The server has converted the raw
                  temperature into degrees Celsius. Remember that we convert the temperature at the server to conserve
                  RAM and ROM on Blue Pill.</p>
                <blockquote class="mr ms mt">
                  <p id="a62a" class="hm hn fd it ho b hp hq hr hs ht hu hv hw hx hy hz"><em class="at">💎 </em>To
                    understand the messages in the Blue Pill log, read the section “<a
                      href="https://lupyuen.github.io/articles/connect-stm32-blue-pill-to-nb-iot-with-quectel-bc95-g-and-apache-mynewt"
                      class="dc by iu iv iw ix" target="_blank" rel="noopener">Check The Log</a>”. The configuration of
                    the CoAP Server at thethings.io <a
                      href="https://lupyuen.github.io/articles/get-started-with-nb-iot-and-quectel-modules"
                      class="dc by iu iv iw ix" target="_blank" rel="noopener">is explained here</a>.</p>
                </blockquote>
              </div>
            </div>
          </section>
          <hr class="jh cx ji jj jk ex jl jm jn jo jp" />
          <section class="dx dy dz ea eb">
            <div class="n p">
              <div class="ac ae af ag ah fa aj ak">
                <h1 id="e835" class="jq jr fd at as js jt ju jv jw jx jy jz ka kb kc kd">The End…?</h1>
                <p id="6b51" class="hm hn fd at ho b hp ke hr kf ht kg hv kh hx ki hz">Keen to learn how Visual Embedded
                  Rust was created? Check out this companion article on 💎 <a
                    href="https://lupyuen.github.io/articles/advanced-topics-for-visual-embedded-rust-programming"
                    class="dc by iu iv iw ix" target="_blank" rel="noopener"><strong class="ho iy">Advanced Topics for
                      Visual Embedded Rust Programming</strong></a>…</p>
                <div class="ns nt nu nv nw nx"><a
                    href="https://lupyuen.github.io/articles/advanced-topics-for-visual-embedded-rust-programming"
                    rel="noopener">
                    <section class="oa do dp ak bw n ap ob oc od oe of og oh oi oj ok ol om on oo op">
                      <div class="oq n dr p or os">
                        <h2 class="as js ot au fd">
                          <div class="cd ny gg gh nz gj">Advanced Topics for Visual Embedded Rust Programming</div>
                        </h2>
                      </div>
                      <div class="ow r">
                        <div class="ox r oy oz pa ow pb pc pd"></div>
                      </div>
                    </section>
                  </a></div>
                <p id="e92c" class="hm hn fd at ho b hp hq hr hs ht hu hv hw hx hy hz">If you would like to join me in
                  making Rust simpler for beginners, drop me a note!</p>
              </div>
            </div>
          </section>
        </div>
      </article>
    </div>
  </div>

  <ul>
    <li>
    <p><a href="https://github.com/sponsors/lupyuen">Sponsor me a coffee</a></p>
    </li>
    <li>
    <p><a href="https://lupyuen.github.io">Check out my articles</a></p>
    </li>
    <li>
    <p><a href="https://lupyuen.github.io/rss.xml">RSS Feed</a></p>
    </li>
  </ul>
    
</body>

</html>
<!--
     FILE ARCHIVED ON 19:43:31 Dec 04, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 23:17:58 Feb 22, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  load_resource: 467.978
  esindex: 0.017
  RedisCDXSource: 2.142
  exclusion.robots.policy: 0.418
  captures_list: 172.273
  PetaboxLoader3.resolve: 218.38
  LoadShardBlock: 143.31 (3)
  exclusion.robots: 0.436
  PetaboxLoader3.datanode: 314.673 (4)
  CDXLines.iter: 23.025 (3)
-->