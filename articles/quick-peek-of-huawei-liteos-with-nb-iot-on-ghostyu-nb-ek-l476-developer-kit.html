<!doctype html>
<html lang="en">

<head>
  <link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=bsmaklHF" />
  <link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=qtvMKcIJ" />
  <link rel="canonical" href="https://lupyuen.org/articles/quick-peek-of-huawei-liteos-with-nb-iot-on-ghostyu-nb-ek-l476-developer-kit.html" />
  <!-- End Wayback Rewrite JS Include -->
  <title data-rh="true">Quick Peek of Huawei LiteOS with NB-IoT on Ghostyu NB-EK-L476 Developer Kit (STM32L476RCT6)
  </title>
  <meta data-rh="true" charset="utf-8" />
  <meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />
  <meta data-rh="true" name="theme-color" content="#000000" />
  <meta data-rh="true" property="og:type" content="article" />
  <meta data-rh="true" property="article:published_time" content="2019-09-07T08:55:27.942Z" />
  <meta data-rh="true" name="title"
    content="Quick Peek of Huawei LiteOS with NB-IoT on Ghostyu NB-EK-L476 Developer Kit (STM32L476RCT6)" />
  <meta data-rh="true" property="og:title"
    content="Quick Peek of Huawei LiteOS with NB-IoT on Ghostyu NB-EK-L476 Developer Kit" />
  <meta data-rh="true" property="twitter:title"
    content="Quick Peek of Huawei LiteOS with NB-IoT on Ghostyu NB-EK-L476 Developer Kit" />
  <meta data-rh="true" name="description"
    content=" I ordered a few NB-IoT Developer Kits from Taobao.com and realised that their firmware had one thing in common… They were built with Huawei LiteOS. Although LiteOS is a new embedded OS, we’ll find…" />
  <meta data-rh="true" property="og:description"
    content="I ordered a few NB-IoT Developer Kits from Taobao.com and realised that their firmware had one thing in common… They were built with LiteOS" />
  <meta data-rh="true" property="twitter:description"
    content="I ordered a few NB-IoT Developer Kits from Taobao.com and realised that their firmware had one thing in common… They were built with LiteOS" />
  <meta data-rh="true" name="twitter:card" content="summary_large_image" />
  <meta data-rh="true" name="twitter:creator" content="@MisterTechBlog" />
  <meta data-rh="true" name="author" content="Lup Yuen Lee 李立源" />
  <meta data-rh="true" name="robots" content="index,follow" />
  <meta data-rh="true" name="referrer" content="unsafe-url" />
  <meta data-rh="true" name="twitter:label1" value="Reading time" />
  <meta data-rh="true" name="twitter:data1" value="6 min read" />
  <meta property="og:image" 
  content="https://lupyuen.github.io/images/legacy/s1.jpeg">

<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">

<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
    a {
        color: #77d;
    }
</style>
<!-- End scripts/rustdoc-header.html -->

</head>

<body>
  <div id="root">
    <div class="a b c">
      <article>
        <section class="cj ck cl cm ak cn ce n co"></section><span class="r"></span>
        <div>
          <div class="cp u cq cr cs ct"></div>
          <section class="cu cv cw cx cy">
            <div class="cz">
              <div class="n p">
                <div class="da db dc dd de df ag dg ah dh aj ak">
                  <div class="figure dj dk dl dm dn cz do dp paragraph-image">

                
                    <p><img src="https://lupyuen.github.io/images/legacy/s1.jpeg" /></p>


                   
                    <figcaption><p><em>Ghostyu NB-EK-L476 Developer Kit
                    </em></p></figcaption>
                  </div>
                </div>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eo aj ak">
                <div>
                  <div id="52f8" class="ep eq er bk es b et eu ev ew ex ey ez">
                    <h1 class="es b et fa er">Quick Peek of Huawei LiteOS with NB-IoT on Ghostyu NB-EK-L476 Developer
                      Kit (STM32L476RCT6)</h1>
                  </div>
                  <div class="fb">
                    <div class="n fc fd fe ff">
                      <div class="o n">
                        <div><a rel="noopener"
                            href="https://lupyuen.github.io">
                            <div class="ds fg fh">
                              <div class="bs n fi o p cp fj fk fl fm fn ct"></div>
                              
                            </div>
                          </a></div>
                        <div class="fp ak r">
                          <div class="n">
                            <div style="flex:1"><span class="bj b bk bl bm bn r er q">
                                <div class="fq n o fr"><span class="bj en eh bl dx fs ft fu fv fw er"><a
                                      class="at au av aw ax ay az ba bb bc fx bf bg bh bi" rel="noopener"
                                      href="https://lupyuen.github.io">Lup
                                      Yuen Lee 李立源</a></span>
                             
                                </div>
                              </span></div>
                          </div><span class="bj b bk bl bm bn r bo bp"><span class="bj en eh bl dx fs ft fu fv fw bo">
                              <div><a class="at au av aw ax ay az ba bb bc fx bf bg bh bi" rel="noopener"
                                  href="https://lupyuen.github.io/articles/quick-peek-of-huawei-liteos-with-nb-iot-on-ghostyu-nb-ek-l476-developer-kit">
                                  4 Sep 2019</a> <!-- -->·
                                <!-- -->
                                <!-- -->6
                                <!-- --> min read
                              </div>
                            </span></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <p id="69d8" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">I ordered a few <a
                    href="https://docs.google.com/document/d/1V96zQc8PbxuxEwsdd3wzEb7SxpDhbSsOOP6faiFPfzo/edit"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">NB-IoT Developer Kits</a> from
                  Taobao.com and realised that their firmware had one thing in common… They were built with <a
                    href="https://liteos.github.io/en/kernel/"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow"><strong class="gy ho">Huawei
                      LiteOS</strong></a>.</p>
                <p id="d4e4" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">Although LiteOS is a new embedded
                  OS, we’ll find features that are commonly associated with modern Real-Time Operating Systems like <a
                    href="https://mynewt.apache.org/"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Apache Mynewt</a> and <a
                    href="https://www.zephyrproject.org/"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Zephyr</a>.</p>
                <p id="d084" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">In this article we’ll peek into
                  the LiteOS + Application source code that was bundled with the NB-IoT Developer Kit that I have just
                  received… <a
                    href="https://item.taobao.com/item.htm?spm=a1z10.5-c-s.w4002-16913145420.11.18f84e29msvnJa&amp;id=577139082865"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow"><strong class="gy ho">Ghostyu
                      NB-EK-L476 Developer Kit</strong></a> (also available on <a
                    href="https://www.aliexpress.com/item/32947266380.html?spm=a2g0o.productlist.0.0.8d6c5a57G3F6vm&amp;algo_pvid=3dd0f3d8-597e-4028-8dba-ace9aa1b820a&amp;algo_expid=3dd0f3d8-597e-4028-8dba-ace9aa1b820a-10&amp;btsid=3cdd8617-4f90-46db-9567-423431c9e122&amp;ws_ab_test=searchweb0_0,searchweb201602_1,searchweb201603_52"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">AliExpress</a>)</p>
                <p id="78c1" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><em class="hp">(I bought the kit
                    myself from Taobao and I’m not paid to write this article)</em></p>
                <p id="ef9e" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">The kit (shown in the photo
                  above) contains…</p>
                <p id="ea01" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">0️⃣ <strong
                    class="gy ho">STMicroelectronics </strong><a
                    href="https://www.st.com/en/microcontrollers-microprocessors/stm32l476rc.html"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow"><strong
                      class="gy ho">STM32L476RCT6</strong></a><strong class="gy ho"> microcontroller</strong></p>
                <ul class="">
                  <li id="f581" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj hq hr hs">80 MHz Arm Cortex M4
                    CPU with Floating-Point Unit</li>
                  <li id="903b" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs">256 KB Flash ROM (at
                    <code class="eb hy hz ia ib b">0x0800 0000</code>)</li>
                  <li id="1f51" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs">128 KB RAM (96 KB at
                    <code class="eb hy hz ia ib b">0x2000 0000</code>, 32 KB with hardware parity at <code
                      class="eb hy hz ia ib b">0x1000 0000</code>)</li>
                  <li id="a50a" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs">Supported Interfaces:
                    CAN, I2C, LPUART, SAI, SPI, USART, USB.</li>
                </ul>
                <p id="93eb" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">1️⃣ <strong class="gy ho">Quectel
                    BC95-B8 Band 8 NB-IoT Breakout Board with SIM slot</strong><br /><em class="hp">(Connected to Port
                    LPUART1, PA0 for Enable Pin, PB15 for Interrupt Pin. Note that </em><a
                    href="https://www.linkedin.com/posts/lupyuen_stm32-activity-6575887681237155840-5Uly"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow"><em class="hp">Port LPUART1 is not
                      the same as USART3</em></a><em class="hp">, but we may </em><a
                    href="https://www.linkedin.com/posts/lupyuen_stm32-activity-6576022871896915968-H8ne"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow"><em class="hp">swap the TX/RX pins
                      to make them the same</em></a><em class="hp">)</em></p>
                <div class="figure id ie if ig ih cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/s2.png" /></p>

                
                  <figcaption><p><em>NB-IoT Breakout Board with SIM slot
                    underneath. Note the unusual orientation of the SIM — the notch faces outwards not inwards. Many
                    thanks to <a href="https://www.starhub.com/"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">StarHub</a> for sponsoring the
                    NB-IoT SIM!</em></p></figcaption>
                </div>
                <p id="ebd9" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">This NB-IoT breakout board (at
                  top right) is for <strong class="gy ho">NB-IoT Frequency Band 8 only</strong>, so it may not be
                  suitable for all countries. But you may buy and replace the breakout board with the version that
                  supports Global Frequency Bands: <a
                    href="https://item.taobao.com/item.htm?spm=a1z10.5-c-s.w4002-16913145420.25.7a33f55b1VkUtY&amp;id=577310122904"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow"><strong class="gy ho">Quectel
                      BC95-G Global Band NB-IoT Breakout Board</strong></a><strong class="gy ho"> </strong>(also on <a
                    href="https://www.aliexpress.com/item/32920599836.html?spm=a2g0o.productlist.0.0.2a325a57wZrhkp&amp;algo_pvid=de28479e-f67f-4b51-b733-7920e772f73a&amp;algo_expid=de28479e-f67f-4b51-b733-7920e772f73a-16&amp;btsid=441f1582-ab5f-4f30-8bb1-9321a166f8e0&amp;ws_ab_test=searchweb0_0,searchweb201602_1,searchweb201603_52"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">AliExpress</a>, ask for the BC95-G
                  version)</p>
                <p id="4e2d" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><em class="hp">(I have used this
                    BC95-G breakout board </em><a class="at cg hk hl hm hn" target="_blank" rel="noopener"
                    href="https://lupyuen.github.io/articles/connect-stm32-blue-pill-to-nb-iot-with-quectel-bc95-g-and-apache-mynewt"><em
                      class="hp">in an earlier tutorial</em></a><em class="hp">)</em></p>
                <div class="figure id ie if ig ih cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/s3.jpeg" /></p>

                  <figcaption><p><em>Replacing Quectel BC95-B8 (Band 8, left) by
                    BC95-G (Global Band, right)</em></p></figcaption>
                </div>
                <p id="7162" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">2️⃣ <a
                    href="https://www.quectel.com/product/l70r.htm"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow"><strong class="gy ho">Quectel
                      L70-R GPS Module</strong></a><strong class="gy ho"> with GPS antenna</strong><br /><em
                    class="hp">(Port UART2, PA1 for Enable Pin)</em></p>
                <div class="figure id ie if ig ih cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/s4.jpeg" /></p>

                  
                  <figcaption><p><em>Underside of the board with GPS antenna
                  </em></p></figcaption>
                </div>
                <p id="ebab" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">3️⃣ <strong class="gy ho">SHT20
                    Temperature and Humidity Sensor</strong> <br /><em class="hp">(Port I2C2)</em></p>
                <p id="0d93" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">4️⃣ <strong class="gy ho">Light
                    Sensor </strong><br /><em class="hp">(Analog, Port ADC1, GPIO PB1)</em></p>
                <p id="57ab" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">5️⃣ <strong class="gy ho">MicroSD
                    Slot</strong> <br /><em class="hp">(SDMMC1)</em></p>
                <p id="9585" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">6️⃣ <strong class="gy ho">Four
                    Push Buttons </strong><br /><em class="hp">(GPIO PC0 to PC3)</em></p>
                <p id="9fb3" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">7️⃣ <strong class="gy ho">Green
                    LED </strong><br /><em class="hp">(GPIO PA15)</em></p>
                <p id="cf76" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">8️⃣ <strong class="gy ho">White
                    LED </strong><br /><em class="hp">(Composite red + green + blue LEDs, Analog, GPIO PB2)</em></p>
                <p id="e707" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">9️⃣ <strong
                    class="gy ho">Expansion Port</strong> at lower centre that exposes Ports SPI3, I2C1 and UART3</p>
                <div class="figure id ie if ig ih cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/s5.jpeg" /></p>

               
                  <figcaption><p><em>STM32L476RCT6 microcontroller with Expansion
                    Port</em></p></figcaption>
                </div>
                <p id="e734" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">🔟 <strong class="gy ho">LCD
                    Connector</strong> (8-pin, yellow) at upper left that exposes Port SPI1, GPIO PA4, PB0 (LCD screen
                  not included)</p>
                <div class="figure id ie if ig ih cz eg io cd ip iq ir is it ba iu iv iw ix iy iz paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/s6.png" /></p>

              
                  <figcaption><p><em>SWD Debug Port</em></p></figcaption>
                </div>
                <p id="04fb" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">Plus an <strong class="gy ho">SWD
                    Debug Port</strong> (10-pin, white) at left, compatible with ST-Link v2.</p>
                <p id="cc8d" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">The following pins should be
                  connected: <strong class="gy ho">SWDIO, SWCLK, VCC, GND</strong>.</p>
                <div class="figure id ie if ig ih cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/s7.jpeg" /></p>

               
                  <figcaption><p><em>Pins connected from the board to ST-Link:
                    SWDIO, SWCLK, VCC, GND</em></p></figcaption>
                </div>
                <p id="3e81" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><a
                    href="https://drive.google.com/file/d/14KZqMO6cj20eKqM85iJNth8vf_WbI5VM/view?usp=sharing"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Here are the schematics</a> (in
                  Chinese)</p>
                <p id="0fe6" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">The source code in this article
                  was downloaded from the official Ghostyu website at <code
                    class="eb hy hz ia ib b"><a href="http://doc.iotxx.com/NB-EK-L476" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">doc.iotxx.com/NB-EK-L476</a></code>
                  and reuploaded to GitHub…</p>
                <div class="dj dk dl dm dn jd"><a
                    href="https://github.com/lupyuen/NB-EK-L476?source=post_page-----2bbfb7f2fbcc----------------------"
                    rel="noopener nofollow">
                    <section class="jg cl cm ak ce n ar jh ji jj jk jl jm jn jo jp jq jr js jt ju jv">
                      <div class="jw n co p jx jy">
                        <h2 class="bj jz ka bl er">
                          <div class="dx je ft fu jf fw">lupyuen/NB-EK-L476</div>
                        </h2>
                      </div>
                      <div class="kd r">
                        <div class="ke r kf kg kh kd ki kj kk"></div>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
          </section>
          <hr class="kl en km kn ko ek kp kq kr ks kt" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah eo aj ak">
                <h1 id="94d8" class="ku kv er bk bj jz kw kx ky kz la lb lc ld le lf lg">Source Code Structure</h1>
                <div class="figure id ie if ig ih cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/s8.png" /></p>

               
                  <figcaption><p><em>Overall Structure of LiteOS</em></p></figcaption>
                </div>
                <p id="99b2" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">The source code folder consists
                  of three major subfolders…</p>
                <p id="389f" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/kernel" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">kernel</a></code>:
                  LiteOS kernel source code. This is provided by Huawei and is common to all LiteOS projects. Arm
                  Cortex-specific code is also located here.</p>
                <p id="69c1" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/platform/" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">platform</a></code>:
                  Source code specific to the STM32L476RCT6 microcontroller and the NB-EK-L476 Developer Kit. This
                  folder is packaged by Ghostyu, the makers of the kit.</p>
                <p id="abb1" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/user" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">user</a></code>:
                  Application source code. Provided by Ghostyu.</p>
                <p id="fc59" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">GCC, Keil and IAR build tools may
                  be used to build LiteOS and the embedded application.</p>
              </div>
            </div>
          </section>
          <hr class="kl en km kn ko ek kp kq kr ks kt" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah eo aj ak">
                <h1 id="5152" class="ku kv er bk bj jz kw kx ky kz la lb lc ld le lf lg">Kernel Functions</h1>
                <div class="figure id ie if ig ih cz eg io cd ip iq ir is it ba iu iv iw ix iy iz paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/s9.png" /></p>

               
                  <figcaption><p><em>LiteOS Kernel Functions</em></p></figcaption>
                </div>
                <p id="652d" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">The LiteOS kernel functions are
                  located in the <code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/kernel" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">kernel</a></code>
                  folder. The functions cover…</p>
                <ul class="">
                  <li id="3664" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj hq hr hs"><a
                      href="https://liteos.github.io/en/kernel/memory.html"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Memory Management</a></li>
                  <li id="9ac8" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs">Interprocess
                    Communication (<a
                      href="https://liteos.github.io/en/kernel/queue.html#overview"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Queues</a> and <a
                      href="https://liteos.github.io/en/kernel/event.html"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Events</a>)</li>
                  <li id="263c" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs">Task Synchronisation
                    (<a
                      href="https://liteos.github.io/en/kernel/semaphore.html"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Semaphore</a> and <a
                      href="https://liteos.github.io/en/kernel/mutex.html"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Mutex</a>)</li>
                  <li id="e69c" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs"><a
                      href="https://liteos.github.io/en/kernel/task.html#overview"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Task Management</a></li>
                  <li id="f205" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs"><a
                      href="https://liteos.github.io/en/kernel/time-magmt.html"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Time Management</a></li>
                  <li id="6d59" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs"><a
                      href="https://liteos.github.io/en/kernel/interrupt.html#overview"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Hardware Interrupts and
                      Exceptions</a></li>
                </ul>
                <div class="figure id ie if ig ih cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>


              
                </div>
                <p id="a255" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">Below we see the contents of the
                  <code class="eb hy hz ia ib b">kernel</code> folder, and a source file from the kernel that deals with
                  task initialisation…</p>
              </div>
            </div>
            <div class="cz ak">
              <div class="figure id ie if ig ih cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy/s10.png" /></p>

          
                <figcaption><p><em>Kernel Functions. From <a
                    href="https://github.com/lupyuen/NB-EK-L476/blob/master/kernel/base/core/los_task.c"
                    class="at cg hk hl hm hn" target="_blank"
                    rel="noopener nofollow">https://github.com/lupyuen/NB-EK-L476/blob/master/kernel/base/core/los_task.c</a>
                </em></p></figcaption>
              </div>
            </div>
          </section>
          <hr class="kl en km kn ko ek kp kq kr ks kt" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah eo aj ak">
                <h1 id="2e9d" class="ku kv er bk bj jz kw kx ky kz la lb lc ld le lf lg">Main Function</h1>
                <p id="3367" class="gw gx er bk gy b gz lo hb lp hd lq hf lr hh ls hj">The <code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/blob/master/user/main.c" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">main</a>()</code>
                  function is located in the <code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/user" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">user</a></code>
                  folder. The <code class="eb hy hz ia ib b">main()</code> function starts up the various functions of
                  the developer kit.</p>
                <p id="aaff" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">In the same source file, we see
                  the <code class="eb hy hz ia ib b">SystemClock_Config()</code> function that powers on the STM32
                  microcontroller peripherals and initialises the clocks. <a class="at cg hk hl hm hn" target="_blank"
                    rel="noopener"
                    href="https://lupyuen.github.io/articles/low-power-nb-iot-on-stm32-blue-pill-with-apache-mynewt-and-embedded-rust">Read
                    more about STM32 Clocks</a></p>
              </div>
            </div>
            <div class="cz ak">
              <div class="figure id ie if ig ih cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy/s11.png" /></p>

           
                <figcaption><p><em>main() function from <a
                    href="https://github.com/lupyuen/NB-EK-L476/blob/master/user/main.c"
                    class="at cg hk hl hm hn" target="_blank"
                    rel="noopener nofollow">https://github.com/lupyuen/NB-EK-L476/blob/master/user/main.c</a>
                </em></p></figcaption>
              </div>
            </div>
          </section>
          <hr class="kl en km kn ko ek kp kq kr ks kt" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah eo aj ak">
                <h1 id="5a68" class="ku kv er bk bj jz kw kx ky kz la lb lc ld le lf lg">Platform Functions</h1>
                <p id="bb4e" class="gw gx er bk gy b gz lo hb lp hd lq hf lr hh ls hj">The <code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/platform" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">platform</a></code>
                  folder contains code that’s specific to the microcontroller (STM32L4xx) and the development board
                  (NB-EK-L476). This folder is likely managed by Ghostyu since it contains code specific to their
                  development board. Here’s what we’ll find in the folder…</p>
                <div class="figure id ie if ig ih cz eg io cd ip iq ir is it ba iu iv iw ix iy iz paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy/s12.png" /></p>

                  <figcaption><p><em>From <a
                      href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/los_bsp_adapter.c"
                      class="at cg hk hl hm hn" target="_blank"
                      rel="noopener nofollow">https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/los_bsp_adapter.c</a>
                  </em></p></figcaption>
                </div>
                <p id="ae47" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/platform/STM32L476RC_NBEK/Display" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Display</a></code>:
                  Source code for the optional LED display (SPI)</p>
                <p id="5f74" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/platform/STM32L476RC_NBEK/Drivers" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Drivers</a></code>:
                  STM32 HAL (explained below)</p>
                <p id="49a1" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/platform/STM32L476RC_NBEK/GpsParse" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">GpsParse</a></code>:
                  Driver for onboard Quectel L70-R GPS module</p>
                <p id="ef13" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/platform/STM32L476RC_NBEK/NBxxModule" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">NBxxModule</a></code>:
                  Driver for onboard Quectel BC95 NB-IoT module</p>
                <p id="b22e" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/platform/STM32L476RC_NBEK/Src" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Src</a></code>:
                  Board-specific functions</p>
                <p id="1c61" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">An drivers for various <a
                    href="https://github.com/lupyuen/NB-EK-L476/tree/master/platform/STM32L476RC_NBEK"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Onboard Sensors and Outputs</a>:
                </p>
                <ul class="">
                  <li id="9008" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj hq hr hs"><a
                      href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/los_bsp_flash.c"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Flash Memory</a></li>
                  <li id="4f66" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs"><a
                      href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/los_bsp_key.c"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Push Buttons</a></li>
                  <li id="2658" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs"><a
                      href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/los_bsp_led.c"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Green LED</a></li>
                  <li id="b756" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs"><a
                      href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/los_bsp_led.h"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">White LED</a></li>
                  <li id="4b12" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs"><a
                      href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/los_bsp_lux.c"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Light Sensor</a></li>
                  <li id="41dc" class="gw gx er bk gy b gz ht hb hu hd hv hf hw hh hx hj hq hr hs"><a
                      href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/los_bsp_sht2x.c"
                      class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">SHT20 Temperature and Humidity
                      Sensor</a></li>
                </ul>
                <div class="figure id ie if ig ih cz cl cm paragraph-image">
                
                  <p><img src="https://lupyuen.github.io/images/legacy2/h0.png" /></p>


              
                </div>
                <p id="ab4b" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">Under <code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/platform/STM32L476RC_NBEK/Drivers" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">platform/STM32L476RC_NBEK/Drivers</a></code>
                  we find the standard STM32 HAL Functions, provided by STMicroelectronics. These are the low-level
                  Hardware Adaptation Layer functions called by the operating system to perform STM32-specific
                  operations like accessing the UART, I2C and SPI ports.</p>
                <p id="3679" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">This is fairly common in embedded
                  operating systems, we see this in <a
                    href="https://github.com/zephyrproject-rtos/hal_stm32/tree/master/stm32cube/stm32l4xx/drivers/src"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Zephyr</a> and <a
                    href="https://github.com/apache/mynewt-core/tree/master/hw/mcu/stm/stm32l4xx/src/ext/Drivers/STM32L4xx_HAL_Driver/Src"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">Mynewt</a> too.</p>
              </div>
            </div>
            <div class="cz ak">
              <div class="figure id ie if ig ih cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy/s13.png" /></p>

              
                <figcaption><p><em>STM32 Hardware Adaptation Layer Functions. From
                  <a href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/Drivers/STM32L4xx_HAL_Driver/Src/stm32l4xx_hal.c"
                    class="at cg hk hl hm hn" target="_blank"
                    rel="noopener nofollow">https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/Drivers/STM32L4xx_HAL_Driver/Src/stm32l4xx_hal.c</a>
                </em></p></figcaption>
              </div>
            </div>
          </section>
          <hr class="kl en km kn ko ek kp kq kr ks kt" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah eo aj ak">
                <h1 id="1bd8" class="ku kv er bk bj jz kw kx ky kz la lb lc ld le lf lg">Quectel BC95 NB-IoT Driver</h1>
                <p id="d7a3" class="gw gx er bk gy b gz lo hb lp hd lq hf lr hh ls hj">Inside the <code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/platform" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">platform</a></code>
                  folder is the <a
                    href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/NBxxModule/NB_BC95.c"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">driver developed by Ghostyu</a>
                  for the Quectel BC95 NB-IoT module, which is connected to Port UART1.</p>
                <p id="287b" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">Below we see a State Transition
                  Machine for handling the AT commands: <code class="eb hy hz ia ib b">nb95_init_process</code>, <code
                    class="eb hy hz ia ib b">nb95_info_process</code>, <code class="eb hy hz ia ib b">cmd_next</code>, …
                </p>
                <p id="1970" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj"><em class="hp">(The </em><a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/tree/low-power/libs/bc95g"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow"><em class="hp">BC95 driver that I
                      have built</em></a><em class="hp"> for Apache Mynewt uses a different approach)</em></p>
              </div>
            </div>
            <div class="cz ak">
              <div class="figure id ie if ig ih cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy/s14.png" /></p>

             
                <figcaption><p><em>Driver for Quectel BC95 NB-IoT Module. From <a
                    href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/NBxxModule/NB_BC95.c"
                    class="at cg hk hl hm hn" target="_blank"
                    rel="noopener nofollow">https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/NBxxModule/NB_BC95.c</a>
                </em></p></figcaption>
              </div>
            </div>
            <div class="n p">
              <div class="ac ae af ag ah eo aj ak">
                <p id="09de" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">Below we see the main loop for
                  handling the AT commands, as well as the message-sending logic…</p>
              </div>
            </div>
            <div class="cz ak">
              <div class="figure id ie if ig ih cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy/s15.png" /></p>

                <figcaption><p><em>Driver for Quectel BC95 NB-IoT Module. From <a
                    href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/NBxxModule/NB_BC95.c"
                    class="at cg hk hl hm hn" target="_blank"
                    rel="noopener nofollow">https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/NBxxModule/NB_BC95.c</a>
                </em></p></figcaption>
              </div>
            </div>
          </section>
          <hr class="kl en km kn ko ek kp kq kr ks kt" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah eo aj ak">
                <h1 id="d1c0" class="ku kv er bk bj jz kw kx ky kz la lb lc ld le lf lg">Quectel L70-R GPS Driver</h1>
                <p id="529d" class="gw gx er bk gy b gz lo hb lp hd lq hf lr hh ls hj">Also inside the <code
                    class="eb hy hz ia ib b"><a href="https://github.com/lupyuen/NB-EK-L476/tree/master/platform" class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">platform</a></code>
                  folder, Ghostyu has included <a
                    href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/GpsParse/gps_l70_r.c"
                    class="at cg hk hl hm hn" target="_blank" rel="noopener nofollow">a driver for the onboard Quectel
                    L70-R GPS module</a>, which is connected to Port UART2.</p>
                <p id="b401" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">Here we see the code to transmit
                  GPS commands and to parse the GPS responses…</p>
              </div>
            </div>
            <div class="cz ak">
              <div class="figure id ie if ig ih cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy/s16.png" /></p>

               
                <figcaption><p><em>Driver for Quectel L70-R GPS module. From <a
                    href="https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/GpsParse/gps_l70_r.c"
                    class="at cg hk hl hm hn" target="_blank"
                    rel="noopener nofollow">https://github.com/lupyuen/NB-EK-L476/blob/master/platform/STM32L476RC_NBEK/GpsParse/gps_l70_r.c</a>
                </em></p></figcaption>
              </div>
            </div>
          </section>
          <hr class="kl en km kn ko ek kp kq kr ks kt" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah eo aj ak">
                <h1 id="0e1c" class="ku kv er bk bj jz kw kx ky kz la lb lc ld le lf lg">Comparing Huawei LiteOS, Apache
                  Mynewt, FreeRTOS and Zephyr</h1>
                <p id="542a" class="gw gx er bk gy b gz lo hb lp hd lq hf lr hh ls hj">Below is the source code in four
                  embedded operating systems for initialising a task: Huawei LiteOS, Apache Mynewt, FreeRTOS and Zephyr.
                </p>
                <p id="5a45" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">We can see that LiteOS and Mynewt
                  are the most similar, since both are lightweight, modern operating systems.</p>
              </div>
            </div>
            <div class="cz ak">
              <div class="figure id ie if ig ih cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy/s17.png" /></p>

            
                <figcaption><p><em>Creating a task in Huawei LiteOS vs Apache
                  Mynewt</em></p></figcaption>
              </div>
              <div class="figure mb cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy/s18.png" /></p>

             
                <figcaption><p><em>Creating a task in FreeRTOS vs Zephyr
                </em></p></figcaption>
              </div>
            </div>
          </section>
          <hr class="kl en km kn ko ek kp kq kr ks kt" />
          <section class="cu cv cw cx cy">
            <div class="n p">
              <div class="ac ae af ag ah eo aj ak">
                <h1 id="3209" class="ku kv er bk bj jz kw kx ky kz la lb lc ld le lf lg">What’s Next</h1>
                <p id="82e8" class="gw gx er bk gy b gz lo hb lp hd lq hf lr hh ls hj">Although I won’t be running
                  LiteOS, I’ll be porting some of the driver code to Apache Mynewt. Soon we’ll have an NB-IoT tutorial
                  based on the Ghostyu NB-EK-L476 Developer Kit… In Embedded Rust!</p>
                <p id="c1b5" class="gw gx er bk gy b gz ha hb hc hd he hf hg hh hi hj">Stay Tuned! Work in progress…</p>
                <div class="dj dk dl dm dn jd"><a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/tree/l476?source=post_page-----2bbfb7f2fbcc----------------------"
                    rel="noopener nofollow">
                    <section class="jg cl cm ak ce n ar jh ji jj jk jl jm jn jo jp jq jr js jt ju jv">
                      <div class="jw n co p jx jy">
                        <h2 class="bj jz ka bl er">
                          <div class="dx je ft fu jf fw">lupyuen/stm32bluepill-mynewt-sensor</div>
                        </h2>
                      </div>
                    </section>
                  </a></div>
              </div>
            </div>
            <div class="cz ak">
              <div class="figure id ie if ig ih cz">
                <div class="ea r ds">
                  <div class="md r"><iframe
                      src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FZsKAlydub9o%3Ffeature%3Doembed&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DZsKAlydub9o&amp;image=https%3A%2F%2Fi.ytimg.com%2Fvi%2FZsKAlydub9o%2Fhqdefault.jpg&amp;key=a19fcc184b9711e1b4764040d3dc5c07&amp;type=text%2Fhtml&amp;schema=youtube"
                      allowfullscreen="" frameborder="0" height="480" width="854"
                      title="Embedded Rust + Apache Mynewt + Quectel BC95 + STM32 L476 + StarHub NB-IoT + thethings.io"
                      class="cp t u dw ak" scrolling="auto"></iframe></div>
                </div>
                <figcaption><p><em>Rust and Mynewt transmitting over NB-IoT on the
                  Ghostyu NB-EK-L476 Developer Kit</em></p></figcaption>
              </div>
              <div class="figure mb cz ak paragraph-image">
                
                <p><img src="https://lupyuen.github.io/images/legacy/s19.png" /></p>

              
                <figcaption><p><em>Rust and Mynewt running OK on the Ghostyu
                  NB-EK-L476 Developer Kit. From <a
                    href="https://github.com/lupyuen/stm32bluepill-mynewt-sensor/tree/l476"
                    class="at cg hk hl hm hn" target="_blank"
                    rel="noopener nofollow">https://github.com/lupyuen/stm32bluepill-mynewt-sensor/tree/l476</a>
                </em></p></figcaption>
              </div>
            </div>
          </section>
        </div>
      </article>
    </div>
  </div>

  <ul>
    <li>
    <p><a href="https://github.com/sponsors/lupyuen">Sponsor me a coffee</a></p>
    </li>
    <li>
    <p><a href="https://lupyuen.github.io">Check out my articles</a></p>
    </li>
    <li>
    <p><a href="https://lupyuen.github.io/rss.xml">RSS Feed</a></p>
    </li>
  </ul>
    
</body>

</html>
<!--
     FILE ARCHIVED ON 19:41:36 Dec 04, 2019 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 23:13:41 Feb 22, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 160.619
  exclusion.robots: 0.152
  exclusion.robots.policy: 0.146
  RedisCDXSource: 1.961
  esindex: 0.008
  LoadShardBlock: 135.325 (3)
  PetaboxLoader3.datanode: 78.347 (4)
  CDXLines.iter: 20.848 (3)
  load_resource: 55.75
  PetaboxLoader3.resolve: 31.323
-->