<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>NuttX RTOS for PinePhone: 4G LTE Modem</title>

    
    <!-- Begin scripts/articles/*-header.html: Article Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<meta property="og:title" 
    content="NuttX RTOS for PinePhone: 4G LTE Modem" 
    data-rh="true">
<meta property="og:description" 
    content="All about the Quectel EG25-G 4G LTE Modem inside Pine64 PinePhone... And how we'll control it with Apache NuttX RTOS"
    data-rh="true">
<meta name="description" 
    content="All about the Quectel EG25-G 4G LTE Modem inside Pine64 PinePhone... And how we'll control it with Apache NuttX RTOS">
<meta property="og:image" 
    content="https://lupyuen.github.io/images/lte-title.jpg">
<meta property="og:type" 
    content="article" data-rh="true">
<!-- End scripts/articles/*-header.html -->
<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">
<link rel="stylesheet" type="text/css" href="../dark.css">
<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
    a {
        color: #77d;
    }
</style>
<!-- End scripts/rustdoc-header.html -->


</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

        <!-- Begin scripts/rustdoc-before.html: Pre-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker -->
    <div class="theme-picker" style="left: 0"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg"
        width="18" alt="Pick another theme!"></button>
        <div id="theme-choices"></div>
    </div>
    <script src="../theme.js"></script>
    <script src="../prism.js"></script>
    <!-- Theme Picker -->

    <!-- End scripts/rustdoc-before.html -->
    

    <h1 class="title">NuttX RTOS for PinePhone: 4G LTE Modem</h1>
    <nav id="TOC"><ul>
<li><a href="#power-on-lte-modem">1 Power On LTE Modem</a><ul></ul></li>
<li><a href="#lte-modem-pins">2 LTE Modem Pins</a><ul></ul></li>
<li><a href="#lte-modem-uart">3 LTE Modem UART</a><ul></ul></li>
<li><a href="#whats-next">4 What‚Äôs Next</a><ul></ul></li></ul></nav><p>üìù <em>12 Apr 2023</em></p>
<p><img src="https://lupyuen.github.io/images/lte-title.jpg" alt="(Quectel EG25-G Hardware Design)" /></p>
<p><a href="https://wiki.pine64.org/images/2/20/Quectel_EG25-G_Hardware_Design_V1.4.pdf"><em>(Quectel EG25-G Hardware Design)</em></a></p>
<p>TODO</p>
<p>Weeks ago we talked about porting <a href="https://lupyuen.github.io/articles/what"><strong>Apache NuttX RTOS</strong></a> (Real-Time Operating System) to <a href="https://wiki.pine64.org/index.php/PinePhone"><strong>Pine64 PinePhone</strong></a>. And how we might turn it into a <strong>Feature Phone</strong>‚Ä¶</p>
<h1 id="power-on-lte-modem"><a href="#power-on-lte-modem">1 Power On LTE Modem</a></h1>
<p>TODO</p>
<p><em>How to power up PinePhone‚Äôs LTE Modem?</em></p>
<p>According to PinePhone Schematic Page 15, the LTE Modem is connected to‚Ä¶</p>
<ul>
<li>
<p>Power DCDC1: From PMIC, 3.3V <a href="https://wiki.pine64.org/wiki/PinePhone_Power_Management#Current_Assignments">(See this)</a></p>
</li>
<li>
<p>Power VBAT: PL7 (4G-PWR-BAT) <a href="https://wiki.pine64.org/wiki/PinePhone_Power_Management#Current_Assignments">(See this)</a></p>
</li>
<li>
<p>Power VDD_EXT: From LTE Modem (EG25-G HW Design Page 22)</p>
</li>
<li>
<p>Reset: BB-RESET (RESET_N) -&gt; PC4-RESET-4G</p>
</li>
<li>
<p>Power Key: BB-PWRKEY (PWRKEY) -&gt; PB3-PWRKEY-4G</p>
</li>
<li>
<p>Disable: BB-DISABLE (W_DISABLE#) -&gt; PH8-DISABLE-4G</p>
</li>
<li>
<p>Status: PH9-STATUS</p>
</li>
<li>
<p>Ring Indicator: PMIC ALDO2  1.8V / PL6 (RI) <a href="https://wiki.pine64.org/wiki/PinePhone_Power_Management#Current_Assignments">(See this)</a></p>
</li>
<li>
<p>AP Ready: BB-AP-READY (AP_READY) -&gt; PH7-AP-READY</p>
</li>
</ul>
<p>(LTE Modem Pins are explained in the next section)</p>
<p><img src="https://lupyuen.github.io/images/lte-title.jpg" alt="LTE Modem inside PinePhone" /></p>
<p>So to power up PinePhone‚Äôs LTE Modem, we need to‚Ä¶</p>
<ol>
<li>
<p>Program PMIC to output DCDC1 at 3.3V</p>
</li>
<li>
<p>Set PL7 to High to Power On LTE Modem (4G-PWR-BAT)</p>
</li>
<li>
<p>Set PC4 to High to Deassert LTE Modem Reset (BB-RESET / RESET_N)</p>
</li>
<li>
<p>Wait 30 ms for VBAT to be stable</p>
</li>
<li>
<p>Set PB3 to Power On LTE Modem (BB-PWRKEY / PWRKEY). PWRKEY should be pulled down at least 500 ms, then pulled up.</p>
</li>
<li>
<p>Set PH8 to High to Enable LTE Modem and Disable Airplane Mode (BB-DISABLE / W_DISABLE#)</p>
</li>
<li>
<p>Read PH9 to check LTE Modem Status</p>
</li>
<li>
<p>In Future: Read PL6 to handle Ring Indicator / <a href="https://embeddedfreak.wordpress.com/2008/08/19/handling-urc-unsolicited-result-code-in-hayes-at-command/">Unsolicited Result Code</a></p>
</li>
<li>
<p>In Future: Set PH7 to High or Low for Sleep State</p>
</li>
</ol>
<p>The code looks like this‚Ä¶</p>
<p>https://github.com/lupyuen/pinephone-nuttx-usb/blob/3ceaf44c23b85ec105a0d85cd377f4a55eff5ef5/a64_usbhost.c#L337-L421</p>
<p><a href="https://github.com/lupyuen2/wip-pinephone-nuttx/blob/0216f6968a82a73b67fb48a276b3c0550c47008a/boards/arm64/a64/pinephone/src/pinephone_pmic.c#L294-L340">(<code>pinephone_pmic_usb_init</code> is defined here)</a></p>
<p>TODO: Why does LTE Modem Status change from Low to High, then stay at High? <a href="https://github.com/lupyuen/pinephone-nuttx-usb/blob/6fb84655b4ed19af7209817cc01b2a589798620a/README.md#output-log">(See this)</a></p>
<p>Is it because of this‚Ä¶</p>
<blockquote>
<p>‚ÄúCurrently STATUS pin is connected to PWRKEY and to PB3. STATUS can‚Äôt be read reliably since voltage divider from R1526 and R1517 places the STATUS signal at 0V or 0.5*Vcc-IO, which is unspecified input value according to A64 datasheet (Vih is 0.7*Vcc-IO, Vil is 0.3*Vcc-IO, the range in between is unspecified).‚Äù </p>
</blockquote>
<p><a href="https://wiki.pine64.org/wiki/PinePhone_Power_Management#Open_Questions_2">(Source)</a></p>
<p>References:</p>
<ul>
<li>
<p><a href="https://wiki.pine64.org/wiki/PinePhone_Power_Management">PinePhone Power Management</a></p>
</li>
<li>
<p><a href="https://wiki.osdev.org/PinePhone">OSDev PinePhone</a></p>
</li>
<li>
<p><a href="https://genodians.org/ssumpf/2022-05-09-telephony">Genode PinePhone Telephony</a></p>
</li>
</ul>
<h1 id="lte-modem-pins"><a href="#lte-modem-pins">2 LTE Modem Pins</a></h1>
<p>TODO</p>
<p><img src="https://lupyuen.github.io/images/lte-title.jpg" alt="LTE Modem inside PinePhone" /></p>
<p><em>What‚Äôs the purpose of the above LTE Modem pins?</em></p>
<p>From <a href="https://wiki.pine64.org/images/2/20/Quectel_EG25-G_Hardware_Design_V1.4.pdf">Quectel EG25-G Hardware Design</a>‚Ä¶</p>
<p><strong>Power-on/off</strong></p>
<div><table><thead><tr><th>Pin Name</th><th>Pin No.</th><th>I/O</th><th>Description</th><th>DC Characteristics</th><th>Comment</th></tr></thead><tbody>
<tr><td>PWRKEY</td><td>21</td><td>DI</td><td>Turn on/off the module</td><td>VH = 0.8 V</td><td>The output voltage is 0.8V because of the diode drop in the Qualcomm chipset.</td></tr>
<tr><td>RESET_N</td><td>20</td><td>DI</td><td>Reset signal of the module</td><td>VIHmax = 2.1 V, VIHmin = 1.3 V, VILmax = 0.5 V</td><td>If unused, keep it open.</td></tr>
</tbody></table>
</div>
<ul>
<li>
<p>PWRKEY should be pulled down at least 500 ms, then pulled up</p>
<p>(EG25-G HW Design, Page 41)</p>
</li>
<li>
<p>‚ÄúMake sure that VBAT is stable before pulling down PWRKEY pin. It is recommended that the time between powering up VBAT and pulling down PWRKEY pin is no less than 30 ms.‚Äù</p>
<p>(EG25-G HW Design, Page 41)</p>
</li>
<li>
<p>‚ÄúThe RESET_N pin can be used to reset the module. The module can be reset by driving RESET_N to a low level voltage for 150‚Äì460 ms‚Äù</p>
<p>(EG25-G HW Design, Page 42)</p>
</li>
</ul>
<p><strong>Other Interface Pins</strong></p>
<div><table><thead><tr><th>Pin Name</th><th>Pin No.</th><th>I/O</th><th>Description</th><th>DC Characteristics</th><th>Comment</th></tr></thead><tbody>
<tr><td>W_DISABLE#</td><td>4</td><td>DI</td><td>Airplane mode control</td><td>VILmin = -0.3 V, VILmax = 0.6 V, VIHmin = 1.2 V, VIHmax = 2.0 V</td><td>1.8 V power domain. Pull-up by default. At low voltage level, module can enter into airplane mode. If unused, keep it open.</td></tr>
<tr><td>AP_READY</td><td>2</td><td>DI</td><td>Application processor sleep state detection</td><td>VILmin = -0.3 V, VILmax = 0.6 V, VIHmin = 1.2 V, VIHmax = 2.0 V</td><td>1.8 V power domain. If unused, keep it open.</td></tr>
</tbody></table>
</div>
<ul>
<li>
<p>‚ÄúThe W_DISABLE# pin is pulled up by default. Driving it to low level will let the module enter airplane mode‚Äù</p>
<p>(EG25-G HW Design, Page 37)</p>
</li>
</ul>
<p><strong>USB Interface</strong></p>
<div><table><thead><tr><th>Pin Name</th><th>Pin No.</th><th>I/O</th><th>Description</th><th>DC Characteristics</th><th>Comment</th></tr></thead><tbody>
<tr><td>USB_VBUS</td><td>71</td><td>PI</td><td>USB connection detection</td><td>Vmax = 5.25 V, Vmin = 3.0 V, Vnorm = 5.0 V, Typical: 5.0 V</td><td>If unused, keep it open.</td></tr>
</tbody></table>
</div>
<p><strong>Status Indication</strong></p>
<div><table><thead><tr><th>Pin Name</th><th>Pin No.</th><th>I/O</th><th>Description</th><th>DC Characteristics</th><th>Comment</th></tr></thead><tbody>
<tr><td>STATUS</td><td>61</td><td>OD</td><td>Indicate the module operating status.</td><td>The drive current should be less than 0.9 mA</td><td>An external pull-up resistor is required. If unused, keep it open.</td></tr>
</tbody></table>
</div>
<ul>
<li>
<p>When PWRKEY is pulled Low, STATUS goes High for ‚â•2.5 s, then STATUS goes Low</p>
<p>(EG25-G HW Design, Page 41)</p>
</li>
</ul>
<p><strong>Main UART Interface</strong></p>
<div><table><thead><tr><th>Pin Name</th><th>Pin No.</th><th>I/O</th><th>Description</th><th>DC Characteristics</th><th>Comment</th></tr></thead><tbody>
<tr><td>RI</td><td>62</td><td>DO</td><td>Ring indicator</td><td>VOLmax = 0.45 V, VOHmin = 1.35 V</td><td>1.8 V power domain. If unused, keep it open</td></tr>
</tbody></table>
</div>
<p><strong>Power Supply</strong></p>
<div><table><thead><tr><th>Pin Name</th><th>Pin No.</th><th>I/O</th><th>Description</th><th>DC Characteristics</th><th>Comment</th></tr></thead><tbody>
<tr><td>VDD_EXT</td><td>7</td><td>PO</td><td>Provide 1.8 V for external circuit</td><td>Vnorm = 1.8 V, IOmax = 50 mA</td><td>Power supply for external GPIO‚Äôs pull up circuits. If unused, keep it open.</td></tr>
</tbody></table>
</div>
<p><strong>I/O Parameters Definition</strong></p>
<div><table><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>AI</td><td>Analog Input</td></tr>
<tr><td>AO</td><td>Analog Output</td></tr>
<tr><td>DI</td><td>Digital Input</td></tr>
<tr><td>DO</td><td>Digital Output</td></tr>
<tr><td>IO</td><td>Bidirectional</td></tr>
<tr><td>OD</td><td>Open Drain</td></tr>
<tr><td>PI</td><td>Power Input</td></tr>
<tr><td>PO</td><td>Power Output</td></tr>
</tbody></table>
</div><h1 id="lte-modem-uart"><a href="#lte-modem-uart">3 LTE Modem UART</a></h1>
<p>TODO: LTE Modem UART</p>
<ul>
<li>
<p>BB-TX: PD1-UART3_RX</p>
</li>
<li>
<p>BB-RX: PD0-UART3_TX</p>
</li>
<li>
<p>BB-CTS: PD5-UART4_CTS</p>
</li>
<li>
<p>BB-RTS: PD4-UART4_RTS</p>
</li>
<li>
<p>BB-DTR: PB2-DTR</p>
</li>
</ul>
<h1 id="whats-next"><a href="#whats-next">4 What‚Äôs Next</a></h1>
<p>TODO</p>
<p>Meanwhile please check out the other articles on NuttX for PinePhone‚Ä¶</p>
<ul>
<li><a href="https://github.com/lupyuen/pinephone-nuttx"><strong>‚ÄúApache NuttX RTOS for PinePhone‚Äù</strong></a></li>
</ul>
<p>Many Thanks to my <a href="https://github.com/sponsors/lupyuen"><strong>GitHub Sponsors</strong></a> for supporting my work! This article wouldn‚Äôt have been possible without your support.</p>
<ul>
<li>
<p><a href="https://github.com/sponsors/lupyuen"><strong>Sponsor me a coffee</strong></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/pinephone-nuttx"><strong>My Current Project: ‚ÄúApache NuttX RTOS for PinePhone‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/book"><strong>My Other Project: ‚ÄúThe RISC-V BL602 Book‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io"><strong>Check out my articles</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/rss.xml"><strong>RSS Feed</strong></a></p>
</li>
</ul>
<p><em>Got a question, comment or suggestion? Create an Issue or submit a Pull Request here‚Ä¶</em></p>
<p><a href="https://github.com/lupyuen/lupyuen.github.io/blob/master/src/lte.md"><strong>lupyuen.github.io/src/lte.md</strong></a></p>

    
</body>
</html>