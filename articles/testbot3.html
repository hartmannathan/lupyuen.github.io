<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>PR Test Bot for PinePhone (Apache NuttX RTOS)</title>

    
    <!-- Begin scripts/articles/*-header.html: Article Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<meta property="og:title" 
    content="PR Test Bot for PinePhone (Apache NuttX RTOS)" 
    data-rh="true">
<meta property="og:description" 
    content=""
    data-rh="true">
<meta name="description" 
    content="">
<meta property="og:image" 
    content="https://lupyuen.github.io/images/testbot3-title.jpg">
<meta property="og:type" 
    content="article" data-rh="true">
<link rel="canonical"
    href="https://lupyuen.org/articles/testbot3.html" />
<!-- End scripts/articles/*-header.html -->
<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">
<link rel="stylesheet" type="text/css" href="../dark.css">
<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
</style>
<!-- End scripts/rustdoc-header.html -->


</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    
    <!-- Begin scripts/rustdoc-before.html: Pre-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker -->
    <div class="theme-picker" style="left: 0"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg"
        width="18" alt="Pick another theme!"></button>
        <div id="theme-choices"></div>
    </div>
    <!-- Theme Picker -->

    <!-- End scripts/rustdoc-before.html -->
    

    <h1 class="title">PR Test Bot for PinePhone (Apache NuttX RTOS)</h1>
    <nav id="rustdoc"><ul>
<li><a href="#sdwire-microsd-multiplexer" title="SDWire MicroSD Multiplexer">1 SDWire MicroSD Multiplexer</a><ul></ul></li>
<li><a href="#install-linux" title="Install Linux">2 Install Linux</a><ul></ul></li>
<li><a href="#usb-uart" title="USB UART">3 USB UART</a><ul></ul></li>
<li><a href="#connect-sdwire" title="Connect SDWire">4 Connect SDWire</a><ul></ul></li>
<li><a href="#compile-sdwire" title="Compile SDWire">5 Compile SDWire</a><ul></ul></li>
<li><a href="#mount-microsd" title="Mount MicroSD">6 Mount MicroSD</a><ul></ul></li>
<li><a href="#inside-sdwire" title="Inside SDWire">7 Inside SDWire</a><ul></ul></li>
<li><a href="#whats-next" title="What‚Äôs Next">8 What‚Äôs Next</a><ul></ul></li></ul></nav><p>üìù <em>23 Mar 2025</em></p>
<p><img src="https://lupyuen.org/images/testbot3-title.jpg" alt="PR Test Bot for PinePhone (Apache NuttX RTOS)" /></p>
<p>Earlier we created a <a href="TODO"><strong>PR Test Bot</strong></a> that will <strong>Build and Test</strong> the Pull Requests for <strong>Apache NuttX RTOS</strong>. Our Test Bot goes into action when we post these PR Comments‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>## For Oz64 SG2000 RISC-V SBC:
@nuttxpr test oz64:nsh

## For QEMU Emulator: Arm64 and RISC-V
@nuttxpr test TODO
@nuttxpr test TODO</code></pre></div>
<p>Today we extend our Test Bot to Build and Test the Pull Requests for <a href="TODO"><strong>PINE64 PinePhone</strong></a>. Yep on the <strong>Real PinePhone Hardware</strong>!</p>
<div class="example-wrap"><pre class="language-bash"><code>@nuttxpr test pinephone:nsh</code></pre></div>
<ul>
<li>
<p>We used Special Hardware: <strong>SDWire MicroSD Multiplexer</strong> <em>(pic above)</em></p>
</li>
<li>
<p>Controlled by a Single-Board Computer: <strong>Yuzuki Avaota-A1</strong> <em>(Open Hardware)</em></p>
</li>
<li>
<p><strong>PinePhone Test Bot</strong> kinda works!</p>
</li>
<li>
<p>Though <strong>PinePhone Battery</strong> complicates Hardware Testing</p>
</li>
<li>
<p>We might pivot to another <strong>Arm64 Single-Board Computer</strong></p>
</li>
<li>
<p>Maybe we‚Äôll port NuttX to <strong>Allwinner A527 SoC</strong>?</p>
</li>
</ul>
<p>TODO: I bought. Yuzuki Avaota-A1 is open hardware. <a href="https://pine64.com/product/yuzuki-avaota-a1-single-board-computer-4gb-32gb/"><em>(Quite affordable too: $55)</em></a></p>
<p>TODO: I ordered another <em>(batteryless)</em> <a href="https://nuttx.apache.org/docs/latest/platforms/arm64/bcm2711/boards/raspberrypi-4b/index.html"><strong>Arm64 Single-Board Computer</strong></a>. Hope it works better with Test Bot!</p>
<p>TODO: Pic of SDWire</p>
<h1 id="sdwire-microsd-multiplexer"><a class="doc-anchor" href="#sdwire-microsd-multiplexer">¬ß</a>1 SDWire MicroSD Multiplexer</h1>
<p><em>MicroSD Multiplexer: What‚Äôs that?</em></p>
<p><a href="TODO"><strong>SDWire MicroSD Multiplexer</strong></a> (pic above) is a brilliant gadget that allows <strong>Two Devices</strong> to access One Single <strong>MicroSD Card</strong>. <em>(One device at a time, not simultaneously)</em></p>
<p><em>Why would we need it?</em></p>
<p>For Testing NuttX on <strong>Arm64 Devices</strong> <em>(PinePhone)</em>:</p>
<h1 id="install-linux"><a class="doc-anchor" href="#install-linux">¬ß</a>2 Install Linux</h1><div class="example-wrap"><pre class="language-bash"><code>https://github.com/AvaotaSBC/AvaotaOS/releases

https://github.com/AvaotaSBC/AvaotaOS/releases/download/0.3.0.4/AvaotaOS-0.3.0.4-noble-gnome-arm64-avaota-a1.img.xz

xz -d AvaotaOS-0.3.0.4-noble-gnome-arm64-avaota-a1.img.xz
Etcher

Ê†áÂáÜÁî®Êà∑Ôºö

Áî®Êà∑ÂêçÔºöavaota
ÂØÜÁ†ÅÔºöavaota
Ê†πÁî®Êà∑

Áî®Êà∑ÂêçÔºöroot
ÂØÜÁ†ÅÔºöavaota

ssh avaota@avaota-a1</code></pre></div>
<p>Avaota A1: Boot to AvaotaOS Noble GNOME OK!</p>
<p>https://gist.github.com/lupyuen/dd4beb052ce07c36d41d409631c6d68b</p>
<p>Armbian Ubuntu won‚Äôt boot:</p>
<p>https://gist.github.com/lupyuen/32876ee9696d60e6e95c839c0a937ad4</p>
<div class="example-wrap"><pre class="language-text"><code>ERROR:   Error initializing runtime service opteed_fast
[    0.000000] Booting Linux on physical CPU 0x0000000000 [0x412fd050]
[    0.000000] Linux version 5.15.154-legacy-sun55iw3-syterkit (build@armbian) (aarch64-linux-gnu-gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0, GNU ld (GNU Binutils for Ubuntu) 2.38) #1 SMP PREEMPT Mon Jan 6 07:05:34 UTC 2025
[    0.000000] Machine model: Avaota A1
[    0.000000] earlycon: uart8250 at MMIO32 0x0000000002500000 (options &#39;&#39;)
[    0.000000] printk: bootconsole [uart8250] enabled
[    0.000000] Reserved memory: created DMA memory pool at 0x000000004ac00000, size 0 MiB
[    0.000000] OF: reserved mem: initialized node vdev0buffer@4ac00000, compatible id shared-dma-pool
[    0.000000] Reserved memory: created DMA memory pool at 0x000000004ae00000, size 0 MiB
[    0.000000] OF: reserved mem: initialized node vdev0buffer@4ae00000, compatible id shared-dma-pool
[    0.000000] Reserved memory: created DMA memory pool at 0x000000004ae44000, size 0 MiB
[    0.000000] OF: reserved mem: initialized node dsp0_rpbuf@4ae44000, compatible id shared-dma-pool
[    0.000000] Kernel panic - not syncing: Failed to allocate page table page
[    0.000000] CPU: 0 PID: 0 Comm: swapper Not tainted 5.15.154-legacy-sun55iw3-syterkit #1
[    0.000000] Hardware name: Avaota A1 (DT)
[    0.000000] Call trace:
[    0.000000]  dump_backtrace+0x0/0x1b0
[    0.000000]  show_stack+0x18/0x24
[    0.000000]  dump_stack_lvl+0x7c/0xa8
[    0.000000]  dump_stack+0x18/0x34
[    0.000000]  panic+0x188/0x334
[    0.000000]  early_pgtable_alloc+0x34/0xa8
[    0.000000]  __create_pgd_mapping+0x3a8/0x6a4
[    0.000000]  map_kernel_segment+0x74/0xdc
[    0.000000]  paging_init+0x104/0x528
[    0.000000]  setup_arch+0x264/0x57c
[    0.000000]  start_kernel+0x7c/0x8f0
[    0.000000]  __primary_switched+0xa0/0xa8
[    0.000000] ---[ end Kernel panic - not syncing: Failed to allocate page table page ]---</code></pre></div>
<p>Factory default: Boot to Android</p>
<p>https://gist.github.com/lupyuen/f0195a2ccdd40906b80e2a360b1782ba</p>
<div class="example-wrap"><pre class="language-text"><code>Hit any key to stop autoboot:  0
ramdisk use init boot
Android&#39;s image name: arm64
[04.634]Starting kernel ...

[04.637][mmc]: mmc exit start
[04.654][mmc]: mmc 2 exit ok
NOTICE:  [SCP] :wait arisc ready....
NOTICE:  [SCP] :arisc version: [001bf1581dbae091dc22b8772b739ccafacdd4b5rid-]
NOTICE:  [SCP] :arisc startup ready
NOTICE:  [SCP] :arisc startup notify message feedback
NOTICE:  [SCP] :sunxi-arisc driver is starting
BL3-1: Next image address = 0x40080000
BL3-1: Next image spsr = 0x3c5
[    0.000000][    T0] Booting Linux on physical CPU 0x0000000000 [0x412fd050]
[    0.000000][    T0] Linux version 5.15.119-gc08c29131003 (yuzuki@YuzukiKoddo) (Android (8490178, based on r450784d) clang version 14.0.6 (https://android.googlesource.com/toolchain/llvm-project 4c603efb0cca074e9238af8b4106c30add4418f6), LLD 14.0.6) #22 SMP PREEMPT Sat Sep 14 19:49:30 CST 2024
[    0.000000][    T0] Machine model: AvaotaSBC,Avaota A1
[    0.000000][    T0] Stack Depot is disabled
[    0.000000][    T0] KVM is not available. Ignoring kvm-arm.mode
[    0.000000][    T0] earlycon: uart8250 at MMIO32 0x0000000002500000 (options &#39;&#39;)
[    0.000000][    T0] printk: bootconsole [uart8250] enabled
[    0.000000][    T0] efi: UEFI not found.
[    0.000000][    T0] [Firmware Bug]: Kernel image misaligned at boot, please fix your bootloader!
[    0.000000][    T0] OF: reserved mem: 0x0000000000020000..0x000000000002ffff (64 KiB) nomap non-reusable mcu0iram@20000
[    0.000000][    T0] OF: reserved mem: 0x0000000000030000..0x0000000000037fff (32 KiB) nomap non-reusable mcu0dram0@30000
[    0.000000][    T0] OF: reserved mem: 0x0000000000038000..0x000000000003ffff (32 KiB) nomap non-reusable mcu0dram1@38000
[    0.000000][    T0] OF: reserved mem: 0x0000000007280000..0x00000000072bffff (256 KiB) nomap non-reusable riscvsram0@7280000
[    0.000000][    T0] OF: reserved mem: 0x00000000072c0000..0x00000000072fffff (256 KiB) nomap non-reusable riscvsram1@72c0000
[    0.000000][    T0] OF: reserved mem: 0x0000000048000000..0x0000000048ffffff (16384 KiB) map non-reusable bl31
[    0.000000][    T0] OF: reserved mem: 0x000000004a000000..0x000000004a9fffff (10240 KiB) nomap non-reusable dsp0ddr@4a000000
[    0.000000][    T0] OF: reserved mem: 0x000000004ab00000..0x000000004ab0ffff (64 KiB) nomap non-reusable dsp_share_space@4ab00000
[    0.000000][    T0] Reserved memory: created DMA memory pool at 0x000000004ac00000, size 0 MiB</code></pre></div>
<p>Avaota A1: Default U-Boot in eMMC. No network :-(</p>
<p>https://gist.github.com/lupyuen/366f1ffefc8231670ffd58a3b88ae8e5</p>
<h1 id="usb-uart"><a class="doc-anchor" href="#usb-uart">¬ß</a>3 USB UART</h1><div class="example-wrap"><pre class="language-bash"><code>##  Allow the user to access the USB UART ports
sudo usermod -a -G dialout $USER
##  Logout and login to refresh the permissions
logout</code></pre></div><h1 id="connect-sdwire"><a class="doc-anchor" href="#connect-sdwire">¬ß</a>4 Connect SDWire</h1>
<p>#SDWire MicroSD Multiplexer connected to #Yuzuki Avaota-A1 SBC ‚Ä¶ When was the last you saw a Micro-USB Data Cable üòÇ</p>
<div class="example-wrap"><pre class="language-text"><code>## Disconnect then reconnect
$ dmesg

[ 1829.473620] usb 1-1: USB disconnect, device number 2
[ 1829.473656] usb 1-1.1: USB disconnect, device number 3
[ 1829.535380] usb 1-1.2: USB disconnect, device number 4

[ 1829.813511] usb 1-1: new full-speed USB device number 5 using xhci-hcd
[ 1833.469452] usb 1-1: new high-speed USB device number 6 using xhci-hcd
[ 1833.617735] usb 1-1: New USB device found, idVendor=0424, idProduct=2640, bcdDevice= 0.00
[ 1833.617771] usb 1-1: New USB device strings: Mfr=0, Product=0, SerialNumber=0
[ 1833.625490] hub 1-1:1.0: USB hub found
[ 1833.625626] hub 1-1:1.0: 3 ports detected
[ 1833.913607] usb 1-1.1: new high-speed USB device number 7 using xhci-hcd
[ 1834.019412] usb 1-1.1: New USB device found, idVendor=0424, idProduct=4050, bcdDevice= 1.76
[ 1834.019446] usb 1-1.1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[ 1834.019465] usb 1-1.1: Product: Ultra Fast Media Reader
[ 1834.019480] usb 1-1.1: Manufacturer: Generic
[ 1834.019494] usb 1-1.1: SerialNumber: 000000264001
[ 1834.021126] usb-storage 1-1.1:1.0: USB Mass Storage device detected
[ 1834.023454] scsi host0: usb-storage 1-1.1:1.0
[ 1834.101528] usb 1-1.2: new full-speed USB device number 8 using xhci-hcd
[ 1834.209026] usb 1-1.2: New USB device found, idVendor=04e8, idProduct=6001, bcdDevice=10.00
[ 1834.209060] usb 1-1.2: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[ 1834.209080] usb 1-1.2: Product: sd-wire
[ 1834.209094] usb 1-1.2: Manufacturer: SRPOL
[ 1834.209108] usb 1-1.2: SerialNumber: sd-wire_02-09
[ 1835.034363] scsi 0:0:0:0: Direct-Access     Generic  Ultra HS-SD/MMC  1.76 PQ: 0 ANSI: 0
[ 1835.036652] sd 0:0:0:0: [sda] 30318592 512-byte logical blocks: (15.5 GB/14.5 GiB)
[ 1835.037460] sd 0:0:0:0: [sda] Write Protect is off
[ 1835.037486] sd 0:0:0:0: [sda] Mode Sense: 23 00 00 00
[ 1835.038526] sd 0:0:0:0: [sda] No Caching mode page found
[ 1835.044589] sd 0:0:0:0: [sda] Assuming drive cache: write through
[ 1835.055251]  sda: sda1
[ 1835.058244] sd 0:0:0:0: [sda] Attached SCSI removable disk

avaota@avaota-a1:~$</code></pre></div><h1 id="compile-sdwire"><a class="doc-anchor" href="#compile-sdwire">¬ß</a>5 Compile SDWire</h1>
<p>Getting Started</p>
<p>https://docs.dasharo.com/transparent-validation/sd-wire/getting-started/</p>
<p>Usage</p>
<p>https://docs.dasharo.com/transparent-validation/sd-wire/usage-validation/</p>
<div class="example-wrap"><pre class="language-bash"><code>sudo apt-get install libftdi1-dev libpopt-dev cmake pkg-config
git clone https://github.com/3mdeb/sd-mux
cd sd-mux
mkdir build
cd build
cmake ..
make
sudo make install</code></pre></div>
<p>Test SDWire. Default Blue LED, MicroSD Enabled. Open <code>dmesg -w</code> in a new window.</p>
<div class="example-wrap"><pre class="language-bash"><code>$ sudo sd-mux-ctrl --list
Number of FTDI devices found: 1
Dev: 0, Manufacturer: SRPOL, Serial: sd-wire_02-09, Description: sd-wire

## Test Server: Blue LED
$ sudo sd-mux-ctrl --device-serial=sd-wire_02-09 --ts

dmesg:
[ 4132.212882] sd 0:0:0:0: [sda] 30318592 512-byte logical blocks: (15.5 GB/14.5 GiB)
[ 4132.214999] sda: detected capacity change from 0 to 30318592
[ 4132.216313]  sda: sda1

## Test Device: Green LED
$ sudo sd-mux-ctrl --device-serial=sd-wire_02-09 --dut

dmesg:
[ 4089.816219] sda: detected capacity change from 30318592 to 0</code></pre></div><h1 id="mount-microsd"><a class="doc-anchor" href="#mount-microsd">¬ß</a>6 Mount MicroSD</h1><div class="example-wrap"><pre class="language-bash"><code>avaota@avaota-a1:~/sd-mux/build$ mkdir /tmp/sda1
avaota@avaota-a1:~/sd-mux/build$ sudo mount /dev/sda1 /tmp/sda1
avaota@avaota-a1:~/sd-mux/build$ ls -l /tmp/sda1
total 5453
-rwxr-xr-x 1 root root  118737 Dec 31 06:18 Image.gz
-rwxr-xr-x 1 root root 4275261 May 23  2021 Image.gz.old
-rwxr-xr-x 1 root root     653 May 23  2021 boot.scr
-rwxr-xr-x 1 root root 1078500 May 23  2021 initramfs.gz
-rwxr-xr-x 1 root root   35865 May 23  2021 sun50i-a64-pinephone-1.0.dtb
-rwxr-xr-x 1 root root   36080 May 23  2021 sun50i-a64-pinephone-1.1.dtb
-rwxr-xr-x 1 root root   36162 May 23  2021 sun50i-a64-pinephone-1.2.dtb</code></pre></div>
<p>Unmount:</p>
<div class="example-wrap"><pre class="language-bash"><code>$ sudo umount /tmp/sda1</code></pre></div><h1 id="inside-sdwire"><a class="doc-anchor" href="#inside-sdwire">¬ß</a>7 Inside SDWire</h1>
<p>https://github.com/3mdeb/sd-mux/blob/master/src/main.cpp</p>
<h1 id="whats-next"><a class="doc-anchor" href="#whats-next">¬ß</a>8 What‚Äôs Next</h1>
<p>TODO</p>
<ul>
<li>
<p><a href="https://lupyuen.org/articles/sponsor"><strong>Sponsor me a coffee</strong></a></p>
</li>
<li>
<p><a href="TODO"><strong>Discuss this article on Hacker News</strong></a></p>
</li>
<li>
<p><a href="https://nuttx-forge.org/lupyuen/nuttx-sg2000"><strong>My Current Project: ‚ÄúApache NuttX RTOS for Sophgo SG2000‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://nuttx-forge.org/lupyuen/nuttx-ox64"><strong>My Other Project: ‚ÄúNuttX for Ox64 BL808‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://nuttx-forge.org/lupyuen/nuttx-star64"><strong>Older Project: ‚ÄúNuttX for Star64 JH7110‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://nuttx-forge.org/lupyuen/pinephone-nuttx"><strong>Olderer Project: ‚ÄúNuttX for PinePhone‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.org"><strong>Check out my articles</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.org/rss.xml"><strong>RSS Feed</strong></a></p>
</li>
</ul>
<p><em>Got a question, comment or suggestion? Create an Issue or submit a Pull Request here‚Ä¶</em></p>
<p><a href="https://codeberg.org/lupyuen/lupyuen.org/src/branch/master/src/testbot3.md"><strong>lupyuen.org/src/testbot3.md</strong></a></p>

    
    <!-- Begin scripts/rustdoc-after.html: Post-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker and Prism Theme -->
    <script src="../theme.js"></script>
    <script src="../prism.js"></script>
    <!-- Theme Picker and Prism Theme -->

    <!-- End scripts/rustdoc-after.html -->
    

</body>
</html>