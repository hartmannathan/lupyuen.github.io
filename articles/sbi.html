<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>Star64 JH7110 RISC-V SBC: Experiments with OpenSBI (Supervisor Binary Interface)</title>

    
    <!-- Begin scripts/articles/*-header.html: Article Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<meta property="og:title" 
    content="Star64 JH7110 RISC-V SBC: Experiments with OpenSBI (Supervisor Binary Interface)" 
    data-rh="true">
<meta property="og:description" 
    content="Let's call OpenSBI (Supervisor Binary Interface) on the Star64 JH7110 RISC-V SBC with Apache NuttX RTOS"
    data-rh="true">
<meta name="description" 
    content="Let's call OpenSBI (Supervisor Binary Interface) on the Star64 JH7110 RISC-V SBC with Apache NuttX RTOS">
<meta property="og:image" 
    content="https://lupyuen.github.io/images/sbi-title.png">
<meta property="og:type" 
    content="article" data-rh="true">
<link rel="canonical"
    href="https://lupyuen.codeberg.page/articles/sbi.html" />
<!-- End scripts/articles/*-header.html -->
<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">
<link rel="stylesheet" type="text/css" href="../dark.css">
<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
    a {
        color: #77d;
    }
</style>
<!-- End scripts/rustdoc-header.html -->


</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

        <!-- Begin scripts/rustdoc-before.html: Pre-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker -->
    <div class="theme-picker" style="left: 0"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg"
        width="18" alt="Pick another theme!"></button>
        <div id="theme-choices"></div>
    </div>
    <script src="../theme.js"></script>
    <script src="../prism.js"></script>
    <!-- Theme Picker -->

    <!-- End scripts/rustdoc-before.html -->
    

    <h1 class="title">Star64 JH7110 RISC-V SBC: Experiments with OpenSBI (Supervisor Binary Interface)</h1>
    <nav id="TOC"><ul>
<li><a href="#opensbi-supervisor-binary-interface">1 OpenSBI Supervisor Binary Interface</a><ul></ul></li>
<li><a href="#call-opensbi-from-nuttx">2 Call OpenSBI from NuttX</a><ul></ul></li>
<li><a href="#run-nuttx-with-opensbi">3 Run NuttX with OpenSBI</a><ul></ul></li>
<li><a href="#opensbi-debug-console">4 OpenSBI Debug Console</a><ul></ul></li>
<li><a href="#read-the-sbi-version">5 Read the SBI Version</a><ul></ul></li>
<li><a href="#set-a-system-timer">6 Set a System Timer</a><ul></ul></li>
<li><a href="#query-the-risc-v-cpus">7 Query the RISC-V CPUs</a><ul></ul></li>
<li><a href="#fetch-the-system-info">8 Fetch the System Info</a><ul></ul></li>
<li><a href="#integrate-opensbi-with-nuttx">9 Integrate OpenSBI with NuttX</a><ul></ul></li>
<li><a href="#whats-next">10 What‚Äôs Next</a><ul></ul></li></ul></nav><p>üìù <em>31 Oct 2023</em></p>
<p><img src="https://lupyuen.github.io/images/sbi-title.png" alt="OpenSBI on Star64 JH7110 RISC-V SBC" /></p>
<p>Bare Metal Programming on a <strong>RISC-V SBC</strong> (Single-Board Computer) sounds difficult‚Ä¶ Thankfully we can get help from <strong>OpenSBI</strong>! (Supervisor Binary Interface)</p>
<p>In this article, we call OpenSBI to‚Ä¶</p>
<ul>
<li>
<p>Print to the <strong>Serial Console</strong></p>
</li>
<li>
<p>Set a <strong>System Timer</strong></p>
</li>
<li>
<p>Query the <strong>RISC-V CPUs</strong></p>
</li>
<li>
<p>Fetch the <strong>System Information</strong></p>
</li>
</ul>
<p>We‚Äôll do this on the <a href="https://wiki.pine64.org/wiki/STAR64"><strong>Star64 JH7110 RISC-V SBC</strong></a>. (Pic below)</p>
<p>(The same steps will work OK on <strong>StarFive VisionFive2</strong>, <strong>Milk-V Mars</strong> and other SBCs based on the <a href="https://doc-en.rvspace.org/Doc_Center/jh7110.html"><strong>StarFive JH7110 SoC</strong></a>)</p>
<p><em>We‚Äôre running Bare Metal Code on our SBC?</em></p>
<p>Not quite, but close to the Metal!</p>
<p>We‚Äôre running our code with <a href="https://lupyuen.github.io/articles/release"><strong>Apache NuttX Real-Time Operating System</strong></a> (RTOS). NuttX lets us inject our Test Code into its tiny Kernel and boot it easily on our SBC.</p>
<p>(Without messing around with the Linux Kernel)</p>
<p><em>Why are we doing this?</em></p>
<p>Right now we‚Äôre <strong>porting NuttX RTOS</strong> to the Star64 SBC.</p>
<p>The experiments that we run today will be super helpful as we <strong>integrate NuttX with OpenSBI</strong> for System Timers, CPU Scheduling and other System Functions.</p>
<p><img src="https://lupyuen.github.io/images/release-star64.jpg" alt="Pine64 Star64 RISC-V SBC" /></p>
<h1 id="opensbi-supervisor-binary-interface"><a href="#opensbi-supervisor-binary-interface">1 OpenSBI Supervisor Binary Interface</a></h1>
<p><em>What‚Äôs this OpenSBI?</em></p>
<p>When we power up our RISC-V SBC, we‚Äôll see OpenSBI in the <a href="https://lupyuen.github.io/articles/linux#serial-console-on-star64"><strong>Serial Console</strong></a>‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>U-Boot SPL 2021.10 (Jan 19 2023 - 04:09:41 +0800)
DDR version: dc2e84f0.
Trying to boot from SPI
OpenSBI v1.2
   ____                    _____ ____ _____
  / __ \                  / ____|  _ \_   _|
 | |  | |_ __   ___ _ __ | (___ | |_) || |
 | |  | | &#39;_ \ / _ \ &#39;_ \ \___ \|  _ &lt; | |
 | |__| | |_) |  __/ | | |____) | |_) || |_
  \____/| .__/ \___|_| |_|_____/|____/_____|
        | |
        |_|
Platform Name             : StarFive VisionFive V2
Platform Features         : medeleg
Platform HART Count       : 5
Platform IPI Device       : aclint-mswi
Platform Timer Device     : aclint-mtimer @ 4000000Hz
Platform Console Device   : uart8250
Platform HSM Device       : jh7110-hsm
Platform PMU Device       : ---
Platform Reboot Device    : pm-reset
Platform Shutdown Device  : pm-reset
Firmware Base             : 0x40000000
Firmware Size             : 288 KB
Runtime SBI Version       : 1.0
</code></pre></div>
<p><a href="https://lupyuen.github.io/articles/linux#appendix-opensbi-log-for-star64">(Source)</a></p>
<p><a href="https://www.thegoodpenguin.co.uk/blog/an-overview-of-opensbi/"><strong>OpenSBI (Open Source Supervisor Binary Interface)</strong></a> is the first thing that boots on our SBC.</p>
<p>OpenSBI provides Secure Access to the <strong>Low-Level System Functions</strong> (controlling CPUs, Timers, Interrupts) for the JH7110 SoC, as described in the SPI Spec‚Ä¶</p>
<ul>
<li>
<p><a href="https://github.com/riscv-non-isa/riscv-sbi-doc"><strong>RISC-V Supervisor Binary Interface Spec</strong></a></p>
<p><a href="https://lupyuen.github.io/articles/linux#appendix-opensbi-log-for-star64">(More about <strong>OpenSBI for Star64</strong>)</a></p>
</li>
</ul>
<p><em>Can‚Äôt we access the Low-Level System Features without OpenSBI?</em></p>
<p>Our code runs in <a href="https://lupyuen.github.io/articles/privilege#risc-v-privilege-levels"><strong>RISC-V Supervisor Mode</strong></a>, which doesn‚Äôt allow direct access to Low-Level System Features, like for starting a CPU. (Pic below)</p>
<p>(NuttX Kernel, Linux Kernel and U-Boot Bootloader all run in Supervisor Mode)</p>
<p>OpenSBI runs in <a href="https://lupyuen.github.io/articles/privilege#risc-v-privilege-levels"><strong>RISC-V Machine Mode</strong></a>, which has complete access to Low-Level System Features. That‚Äôs why we call OpenSBI from our code.</p>
<p><img src="https://lupyuen.github.io/images/privilege-title.jpg" alt="OpenSBI runs in RISC-V Machine Mode" /></p>
<h1 id="call-opensbi-from-nuttx"><a href="#call-opensbi-from-nuttx">2 Call OpenSBI from NuttX</a></h1>
<p><em>How to call OpenSBI from our code?</em></p>
<p>Suppose we‚Äôre calling OpenSBI to print something to the <a href="https://lupyuen.github.io/articles/linux#serial-console-on-star64"><strong>Serial Console</strong></a> like so: <a href="https://github.com/lupyuen2/wip-pinephone-nuttx/blob/sbi/boards/risc-v/jh7110/star64/src/jh7110_appinit.c#L155-L237">jh7110_appinit.c</a></p>
<div class="example-wrap"><pre class="language-c"><code>// After NuttX Kernel boots on JH7110...
void board_late_initialize(void) {
  ...
  // Call OpenSBI to print something
  test_opensbi();
}

// Call OpenSBI to print something. Based on
// https://github.com/riscv-software-src/opensbi/blob/master/firmware/payloads/test_main.c
// https://www.thegoodpenguin.co.uk/blog/an-overview-of-opensbi/
int test_opensbi(void) {

  // Print `123` with (Legacy) Console Putchar.
  // Call sbi_console_putchar: Extension ID 1, Function ID 0
  // https://github.com/riscv-non-isa/riscv-sbi-doc/blob/master/src/ext-legacy.adoc
  sbi_ecall(
    SBI_EXT_0_1_CONSOLE_PUTCHAR,  // Extension ID: 1
    0,    // Function ID: 0
    &#39;1&#39;,  // Character to be printed
    0, 0, 0, 0, 0  // Other Parameters (unused)
  );

  // Do the same, but print `2` and `3`
  sbi_ecall(SBI_EXT_0_1_CONSOLE_PUTCHAR, 0, &#39;2&#39;, 0, 0, 0, 0, 0);
  sbi_ecall(SBI_EXT_0_1_CONSOLE_PUTCHAR, 0, &#39;3&#39;, 0, 0, 0, 0, 0);
</code></pre></div>
<p>This calls the (Legacy) <a href="https://github.com/riscv-non-isa/riscv-sbi-doc/blob/v1.0.0/riscv-sbi.adoc#52-extension-console-putchar-eid-0x01"><strong>Console Putchar Function</strong></a> from the SBI Spec‚Ä¶</p>
<ul>
<li>
<p><strong>Extension ID:</strong> 1 (CONSOLE_PUTCHAR)</p>
</li>
<li>
<p><strong>Function ID:</strong> 0</p>
</li>
<li>
<p><strong>Parameter:</strong> Character to be printed</p>
</li>
</ul>
<p>(There‚Äôs a newer version of this, we‚Äôll soon see)</p>
<p><em>What‚Äôs this ecall to SBI?</em></p>
<p>Remember that OpenSBI runs in (super-privileged) <strong>RISC-V Machine Mode</strong>. And our code runs in (less-privileged) <strong>RISC-V Supervisor Mode</strong>.</p>
<p>To jump from Supervisor Mode to Machine Mode, we execute the <a href="https://five-embeddev.com/quickref/instructions.html#-rv32--rv32"><strong><code>ecall</code> RISC-V Instruction</strong></a> like this: <a href="https://github.com/lupyuen2/wip-pinephone-nuttx/blob/sbi/boards/risc-v/jh7110/star64/src/jh7110_appinit.c#L268-L299">jh7110_appinit.c</a></p>
<div class="example-wrap"><pre class="language-c"><code>// Make an `ecall` to OpenSBI. Based on
// https://github.com/apache/nuttx/blob/master/arch/risc-v/src/common/supervisor/riscv_sbi.c#L52-L77
// https://github.com/riscv-software-src/opensbi/blob/master/firmware/payloads/test_main.c
static struct sbiret sbi_ecall(
  unsigned int extid,  // Extension ID
  unsigned int fid,    // Function ID
  uintptr_t parm0, uintptr_t parm1,  // Parameters 0 and 1
  uintptr_t parm2, uintptr_t parm3,  // Parameters 2 and 3
  uintptr_t parm4, uintptr_t parm5   // Parameters 4 and 5
) {
  // Pass the Extension ID, Function ID and Parameters
  // in RISC-V Registers A0 to A7
  register long r0 asm(&quot;a0&quot;) = (long)(parm0);
  register long r1 asm(&quot;a1&quot;) = (long)(parm1);
  register long r2 asm(&quot;a2&quot;) = (long)(parm2);
  register long r3 asm(&quot;a3&quot;) = (long)(parm3);
  register long r4 asm(&quot;a4&quot;) = (long)(parm4);
  register long r5 asm(&quot;a5&quot;) = (long)(parm5);
  register long r6 asm(&quot;a6&quot;) = (long)(fid);
  register long r7 asm(&quot;a7&quot;) = (long)(extid);

  // Execute the `ecall` RISC-V Instruction.
  // Output Registers: A0 and A1
  // Input Registers: A2 to A7
  // Clobbers the Memory
  asm volatile (
    &quot;ecall&quot;
    : &quot;+r&quot;(r0), &quot;+r&quot;(r1)
    : &quot;r&quot;(r2), &quot;r&quot;(r3), &quot;r&quot;(r4), &quot;r&quot;(r5), &quot;r&quot;(r6), &quot;r&quot;(r7)
    : &quot;memory&quot;
  );

  // Return the OpenSBI Error and Value
  struct sbiret ret;
  ret.error = r0;
  ret.value = r1;
  return ret;
}
</code></pre></div>
<p><a href="https://gist.github.com/lupyuen/4cd98a4075d5b528940095b39fd5b445">(See the <strong>RISC-V Disassembly</strong>)</a></p>
<p>Now we run this on our SBC‚Ä¶</p>
<p><a href="https://www.thegoodpenguin.co.uk/blog/an-overview-of-opensbi/">(How <strong><code>ecall</code></strong> works in OpenSBI)</a></p>
<p><a href="https://courses.stephenmarz.com/my-courses/cosc562/risc-v/opensbi-calls/">(More about OpenSBI)</a></p>
<p>TODO: Pic of NuttX</p>
<h1 id="run-nuttx-with-opensbi"><a href="#run-nuttx-with-opensbi">3 Run NuttX with OpenSBI</a></h1>
<p><em>Will our Test Code print correctly to the Serial Console?</em></p>
<p>Let‚Äôs find out!</p>
<ol>
<li>
<p>Follow these steps to download <strong>Apache NuttX RTOS</strong> and compile the NuttX Kernel and Apps‚Ä¶</p>
<p><a href="https://lupyuen.github.io/articles/release#build-nuttx-for-star64"><strong>‚ÄúBuild NuttX for Star64‚Äù</strong></a></p>
</li>
<li>
<p>Locate this <strong>NuttX Source File</strong>‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>nuttx/boards/risc-v/jh7110/star64/src/jh7110_appinit.c
</code></pre></div>
<p>Replace the contents of that file by this <strong>Test Code</strong>‚Ä¶</p>
<p><a href="https://github.com/lupyuen2/wip-pinephone-nuttx/blob/sbi/boards/risc-v/jh7110/star64/src/jh7110_appinit.c"><strong>jh7110_appinit.c: OpenSBI Test Code</strong></a></p>
</li>
<li>
<p>Rebuild the <strong>NuttX Kernel</strong>‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>$ make
$ riscv64-unknown-elf-objcopy -O binary nuttx nuttx.bin
</code></pre></div></li>
<li>
<p>Copy the NuttX Kernel and NuttX Apps to a <strong>microSD Card</strong>‚Ä¶</p>
<p><a href="https://lupyuen.github.io/articles/release#nuttx-in-a-bootable-microsd"><strong>‚ÄúNuttX in a Bootable microSD‚Äù</strong></a></p>
</li>
<li>
<p>Insert the microSD Card into our SBC and power up‚Ä¶</p>
<p><a href="https://lupyuen.github.io/articles/release#boot-nuttx-on-star64"><strong>‚ÄúBoot NuttX on Star64‚Äù</strong></a></p>
<p><a href="https://lupyuen.github.io/articles/tftp">(Or boot our SBC over the <strong>Network with TFTP</strong>)</a></p>
</li>
</ol>
<p>When we boot the Modified NuttX Kernel on our SBC, we see ‚Äú<strong><code>123</code></strong>‚Äù printed on the Serial Console‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>Starting kernel ...
123
NuttShell (NSH) NuttX-12.0.3
nsh&gt; 
</code></pre></div>
<p><a href="https://github.com/lupyuen2/wip-pinephone-nuttx/blob/sbi/boards/risc-v/jh7110/star64/src/jh7110_appinit.c#L300-L310">(Source)</a></p>
<p>Yep our OpenSBI Experiment works yay!</p>
<h1 id="opensbi-debug-console"><a href="#opensbi-debug-console">4 OpenSBI Debug Console</a></h1>
<p>TODO</p>
<p><em>But that‚Äôs calling the Legacy Console Putchar Function. What about the newer Debug Console Functions?</em></p>
<p>Let‚Äôs call the newer <a href="https://github.com/riscv-non-isa/riscv-sbi-doc/blob/master/src/ext-debug-console.adoc">Debug Console Functions</a> in OpenSBI‚Ä¶</p>
<p>From <a href="https://github.com/lupyuen2/wip-pinephone-nuttx/blob/sbi/boards/risc-v/jh7110/star64/src/jh7110_appinit.c#L237-L265">jh7110_appinit.c</a></p>
<div class="example-wrap"><pre class="language-c"><code>  // TODO: Not supported by SBI v1.0, this will return SBI_ERR_NOT_SUPPORTED
  // Print `456` to Debug Console.
  // Call sbi_debug_console_write: EID 0x4442434E, FID 0
  // https://github.com/riscv-non-isa/riscv-sbi-doc/blob/master/src/ext-debug-console.adoc#function-console-write-fid-0
  const char *str = &quot;456&quot;;
	struct sbiret sret = sbi_ecall(
    SBI_EXT_DBCN,  // Extension ID
    SBI_EXT_DBCN_CONSOLE_WRITE,  // Function ID
		strlen(str),         // Number of bytes
    (unsigned long)str,  // Address Low
    0,                   // Address High
    0, 0, 0              // Unused
  );
  _info(&quot;sret.value=%d, sret.error=%d\n&quot;, sret.value, sret.error);

  // TODO: Not supported by SBI v1.0, this will return SBI_ERR_NOT_SUPPORTED
  // Print `789` to Debug Console.
  // Call sbi_debug_console_write_byte: EID 0x4442434E, FID 2
  // https://github.com/riscv-non-isa/riscv-sbi-doc/blob/master/src/ext-debug-console.adoc#function-console-write-byte-fid-2
  sret = sbi_ecall(SBI_EXT_DBCN, SBI_EXT_DBCN_CONSOLE_WRITE_BYTE, &#39;7&#39;, 0, 0, 0, 0, 0);
  sret = sbi_ecall(SBI_EXT_DBCN, SBI_EXT_DBCN_CONSOLE_WRITE_BYTE, &#39;8&#39;, 0, 0, 0, 0, 0);
  sret = sbi_ecall(SBI_EXT_DBCN, SBI_EXT_DBCN_CONSOLE_WRITE_BYTE, &#39;9&#39;, 0, 0, 0, 0, 0);
  _info(&quot;sret.value=%d, sret.error=%d\n&quot;, sret.value, sret.error);
</code></pre></div>
<p>But it fails with <code>SBI_ERR_NOT_SUPPORTED</code>‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>Starting kernel ...
test_opensbi: sret.value=0, sret.error=-2
test_opensbi: sret.value=0, sret.error=-2
</code></pre></div>
<p><a href="https://github.com/lupyuen2/wip-pinephone-nuttx/blob/sbi/boards/risc-v/jh7110/star64/src/jh7110_appinit.c#L300-L310">(Source)</a></p>
<h1 id="read-the-sbi-version"><a href="#read-the-sbi-version">5 Read the SBI Version</a></h1>
<p>TODO</p>
<p><em>Why is the Debug Console not supported on JH7110 OpenSBI?</em></p>
<p>If we trace the StarFive JH7110 Source Code‚Ä¶</p>
<ol>
<li>
<p>Browse to <a href="https://github.com/starfive-tech/VisionFive2">github.com/starfive-tech/VisionFive2</a></p>
</li>
<li>
<p>Click the <a href="https://github.com/starfive-tech/opensbi/tree/c6a092cd80112529cb2e92e180767ff5341b22a3">opensbi Folder</a></p>
</li>
</ol>
<p>It says‚Ä¶</p>
<blockquote>
<p>OpenSBI fully supports SBI specification v0.2</p>
</blockquote>
<p>Current version of SBI Spec is 2.0 (draft). OpenSBI implements a 4-year-old spec?</p>
<p>But then we see this: <a href="https://github.com/starfive-tech/opensbi/blob/c6a092cd80112529cb2e92e180767ff5341b22a3/include/sbi/sbi_ecall.h#L16-L17">sbi_ecall.h</a></p>
<div class="example-wrap"><pre class="language-c"><code>#define SBI_ECALL_VERSION_MAJOR		1
#define SBI_ECALL_VERSION_MINOR		0
</code></pre></div>
<p>Which is returned by <a href="https://github.com/starfive-tech/opensbi/blob/c6a092cd80112529cb2e92e180767ff5341b22a3/lib/sbi/sbi_ecall_base.c#L43-L48">GET_SPEC_VERSION</a>. So JH7110 OpenSBI probably implements SBI v1.0.</p>
<p>SBI v1.0 also appears in the JH7110 OpenSBI Log‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>Runtime SBI Version: 1.0
</code></pre></div>
<p><a href="https://gist.github.com/lupyuen/1e009a3343da70257d6f24400339053f#file-nuttx-scheme-star64-log-L30">(Source)</a></p>
<p><img src="https://lupyuen.github.io/images/sbi-title.png" alt="SBI v1.0 appears in the JH7110 OpenSBI Log" /></p>
<p><em>What exactly is in SBI v0.2 and v1.0?</em></p>
<p>Here are the SBI Specs‚Ä¶</p>
<ul>
<li>
<p><a href="https://github.com/riscv-non-isa/riscv-sbi-doc/blob/v0.2.0/riscv-sbi.adoc">SBI Spec v0.2</a> (Jan 2020)</p>
</li>
<li>
<p><a href="https://github.com/riscv-non-isa/riscv-sbi-doc/blob/v1.0.0/riscv-sbi.adoc">SBI Spec v1.0</a> (Mar 2022)</p>
</li>
</ul>
<p>Definitely no Debug Console in there!</p>
<p><em>When was Debug Console added to the SBI Spec?</em></p>
<p>Debug Console appears in <a href="https://github.com/riscv-non-isa/riscv-sbi-doc/blob/v2.0-rc1/riscv-sbi.adoc">SBI Spec v2.0 RC1</a> (Jun 2023), but there isn‚Äôt an official SBI Spec v2.0 yet.</p>
<p>And the Debug Console code is already inside JH7110 OpenSBI: <a href="https://github.com/starfive-tech/opensbi/blob/c6a092cd80112529cb2e92e180767ff5341b22a3/lib/sbi/sbi_ecall_dbcn.c">sbi_ecall_dbcn.c</a></p>
<p><em>So why can‚Äôt we call the Debug Console?</em></p>
<p>Our JH7110 Firmware seems to be built in <a href="https://gist.github.com/lupyuen/1e009a3343da70257d6f24400339053f#file-nuttx-scheme-star64-log-L4">Jan 2023</a>. But Debug Console was only implemented in <a href="https://github.com/starfive-tech/opensbi/commits/c6a092cd80112529cb2e92e180767ff5341b22a3/lib/sbi/sbi_ecall_dbcn.c">Feb 2023</a>! Maybe that‚Äôs why we can‚Äôt call the Debug Console on JH7110 OpenSBI.</p>
<p>FYI: Upstream OpenSBI now supports <a href="https://github.com/riscv-software-src/opensbi/commit/cbdd86973901b6be2a1a2d3d6b54f3184fdf9a44">SBI 2.0</a></p>
<p>TODO: Call sbi_get_spec_version, sbi_get_impl_id, sbi_get_impl_version, sbi_probe_extension, sbi_get_mvendorid, sbi_get_marchid, sbi_get_mimpid</p>
<h1 id="set-a-system-timer"><a href="#set-a-system-timer">6 Set a System Timer</a></h1>
<p>TODO</p>
<h1 id="query-the-risc-v-cpus"><a href="#query-the-risc-v-cpus">7 Query the RISC-V CPUs</a></h1>
<p>TODO</p>
<h1 id="fetch-the-system-info"><a href="#fetch-the-system-info">8 Fetch the System Info</a></h1>
<p>TODO</p>
<h1 id="integrate-opensbi-with-nuttx"><a href="#integrate-opensbi-with-nuttx">9 Integrate OpenSBI with NuttX</a></h1>
<p>TODO</p>
<h1 id="whats-next"><a href="#whats-next">10 What‚Äôs Next</a></h1>
<p>TODO</p>
<p>Many Thanks to my <a href="https://github.com/sponsors/lupyuen"><strong>GitHub Sponsors</strong></a> (and the awesome NuttX Community) for supporting my work! This article wouldn‚Äôt have been possible without your support.</p>
<ul>
<li>
<p><a href="https://github.com/sponsors/lupyuen"><strong>Sponsor me a coffee</strong></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/nuttx-star64"><strong>My Current Project: ‚ÄúApache NuttX RTOS for Star64 JH7110‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/pinephone-nuttx"><strong>My Other Project: ‚ÄúNuttX for PinePhone‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io"><strong>Check out my articles</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/rss.xml"><strong>RSS Feed</strong></a></p>
</li>
</ul>
<p><em>Got a question, comment or suggestion? Create an Issue or submit a Pull Request here‚Ä¶</em></p>
<p><a href="https://github.com/lupyuen/lupyuen.github.io/blob/master/src/sbi.md"><strong>lupyuen.github.io/src/sbi.md</strong></a></p>

    
</body>
</html>