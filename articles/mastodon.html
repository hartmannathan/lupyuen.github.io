<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>(Experimental) Mastodon Server for Apache NuttX Continuous Integration (macOS Rancher Desktop)</title>

    
    <!-- Begin scripts/articles/*-header.html: Article Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<meta property="og:title" 
    content="(Experimental) Mastodon Server for Apache NuttX Continuous Integration (macOS Rancher Desktop)" 
    data-rh="true">
<meta property="og:description" 
    content=""
    data-rh="true">
<meta name="description" 
    content="">
<meta property="og:image" 
    content="https://lupyuen.github.io/images/mastodon-title.jpg">
<meta property="og:type" 
    content="article" data-rh="true">
<link rel="canonical"
    href="https://lupyuen.github.io/articles/mastodon" />
<!-- End scripts/articles/*-header.html -->
<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">
<link rel="stylesheet" type="text/css" href="../dark.css">
<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
</style>
<!-- End scripts/rustdoc-header.html -->


</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    
    <!-- Begin scripts/rustdoc-before.html: Pre-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker -->
    <div class="theme-picker" style="left: 0"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg"
        width="18" alt="Pick another theme!"></button>
        <div id="theme-choices"></div>
    </div>
    <!-- Theme Picker -->

    <!-- End scripts/rustdoc-before.html -->
    

    <h1 class="title">(Experimental) Mastodon Server for Apache NuttX Continuous Integration (macOS Rancher Desktop)</h1>
    <nav id="rustdoc"><ul>
<li><a href="#todo" title="TODO">1 TODO</a><ul></ul></li>
<li><a href="#whats-next" title="What‚Äôs Next">2 What‚Äôs Next</a><ul></ul></li></ul></nav><p>üìù <em>30 Dec 2024</em></p>
<p><img src="https://lupyuen.github.io/images/mastodon-title.jpg" alt="TODO" /></p>
<p>TODO</p>
<p>We‚Äôre out for an <a href="TODO"><strong>overnight hike</strong></a>, city to airport. Our <a href="TODO"><strong>Build Farm for Apache NuttX RTOS</strong></a> runs non-stop. Continuously compiling 1,000 NuttX Targets.</p>
<p>Can we be really sure that NuttX is OK? Without getting spammed by alert emails all night?</p>
<h1 id="todo"><a class="doc-anchor" href="#todo">¬ß</a>1 TODO</h1>
<p>TODO: mastodon-grafana.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-grafana.png" alt="TODO" /></p>
<p>TODO: mastodon-log.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-log.png" alt="TODO" /></p>
<p>TODO: mastodon-mobile1.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-mobile1.png" alt="TODO" /></p>
<p>TODO: mastodon-mobile2.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-mobile2.png" alt="TODO" /></p>
<p>TODO: mastodon-mobile3.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-mobile3.png" alt="TODO" /></p>
<p>TODO: mastodon-mobile4.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-mobile4.png" alt="TODO" /></p>
<p>TODO: mastodon-prometheus.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-prometheus.png" alt="TODO" /></p>
<p>TODO: mastodon-register1.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-register1.png" alt="TODO" /></p>
<p>TODO: mastodon-register2.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-register2.png" alt="TODO" /></p>
<p>TODO: mastodon-register3.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-register3.png" alt="TODO" /></p>
<p>TODO: mastodon-register4.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-register4.png" alt="TODO" /></p>
<p>TODO: mastodon-register5.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-register5.png" alt="TODO" /></p>
<p>TODO: mastodon-register6.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-register6.png" alt="TODO" /></p>
<p>TODO: mastodon-register7.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-register7.png" alt="TODO" /></p>
<p>TODO: mastodon-web1.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-web1.png" alt="TODO" /></p>
<p>TODO: mastodon-web2.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-web2.png" alt="TODO" /></p>
<p>TODO: mastodon-web3.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-web3.png" alt="TODO" /></p>
<p>TODO: mastodon-web4.png</p>
<p><img src="https://lupyuen.github.io/images/mastodon-web4.png" alt="TODO" /></p>
<p>TODO: <a href="https://github.com/lupyuen/nuttx-prometheus-to-mastodon/blob/main/run.sh">run.sh</a></p>
<div class="example-wrap"><pre class="language-bash"><code>#!/usr/bin/env bash
## Post the Failed Jobs from Prometheus to Mastodon

set -e  ## Exit when any command fails
set -x  ## Echo commands

## Set the Access Token for Mastodon
## https://docs.joinmastodon.org/client/authorized/#token
## export MASTODON_TOKEN=...
set +x  ## Disable Echo
. ../mastodon-token.sh
set -x  ## Echo commands

set +e  ## Ignore errors
for (( ; ; )); do
    ## Post the Failed Jobs from Prometheus to Mastodon
    cargo run

    ## Wait a while
    date ; sleep 900
done</code></pre></div>
<p>TODO: <a href="https://github.com/lupyuen/nuttx-prometheus-to-mastodon/blob/main/src/main.rs">main.rs</a></p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="doccomment">//! (1) Fetch the Failed NuttX Builds from Prometheus
//! (2) Post to Mastodon

</span><span class="kw">use </span>std::{
    fs::File,
    io::{BufReader, Write},
    thread::sleep,
    time::Duration,
};
<span class="kw">use </span>clap::Parser;
<span class="kw">use </span>serde_json::{
    json,
    to_string_pretty,
    Value,
};

<span class="comment">// Remembers the Mastodon Posts for All Builds:
// {
//   "rv-virt:citest" : {
//     status_id: "12345",
//     users: ["nuttxpr", "NuttX", "lupyuen"]
//   }
//   "rv-virt:citest64" : ...
// }
</span><span class="kw">const </span>ALL_BUILDS_FILENAME: <span class="kw-2">&amp;</span>str = <span class="string">"/tmp/nuttx-prometheus-to-mastodon.json"</span>;

<span class="doccomment">/// Command-Line Arguments
</span><span class="attr">#[derive(Parser, Debug)]
#[command(version, about, long_about = <span class="prelude-val">None</span>)]
</span><span class="kw">struct </span>Args {
}

<span class="attr">#[tokio::main]
</span><span class="kw">async fn </span>main() -&gt; <span class="prelude-ty">Result</span>&lt;(), Box&lt;<span class="kw">dyn </span>std::error::Error&gt;&gt; {
    <span class="comment">// Init the Logger and Command-Line Args
    </span>env_logger::init();
    <span class="comment">// let args = Args::parse();

    // Fetch the Failed Builds from Prometheus
    </span><span class="kw">let </span>query = <span class="string">r##"
        build_score{
            config!="leds64_zig",
            user!="rewind",
            user!="nuttxlinux",
            user!="nuttxmacos",
            user!="jerpelea"
        } &lt; 0.5
    "##</span>;
    <span class="macro">println!</span>(<span class="string">"query={query}"</span>);
    <span class="kw">let </span>params = [(<span class="string">"query"</span>, query)];
    <span class="kw">let </span>client = reqwest::Client::new();
    <span class="kw">let </span>prometheus = <span class="string">"http://localhost:9090/api/v1/query"</span>;
    <span class="kw">let </span>res = client
        .post(prometheus)
        .form(<span class="kw-2">&amp;</span>params)
        .send()
        .<span class="kw">await</span><span class="question-mark">?</span>;
    <span class="macro">println!</span>(<span class="string">"res={res:?}"</span>);
    <span class="kw">if </span>!res.status().is_success() {
        <span class="macro">println!</span>(<span class="string">"*** Prometheus Failed"</span>);
        sleep(Duration::from_secs(<span class="number">1</span>));
    }
    <span class="macro">println!</span>(<span class="string">"Status: {}"</span>, res.status());
    <span class="macro">println!</span>(<span class="string">"Headers:\n{:#?}"</span>, res.headers());
    <span class="kw">let </span>body = res.text().<span class="kw">await</span><span class="question-mark">?</span>;
    <span class="macro">println!</span>(<span class="string">"Body: {body}"</span>);
    <span class="kw">let </span>data: Value = serde_json::from_str(<span class="kw-2">&amp;</span>body).unwrap();
    <span class="kw">let </span>builds = <span class="kw-2">&amp;</span>data[<span class="string">"data"</span>][<span class="string">"result"</span>];
    <span class="macro">println!</span>(<span class="string">"\n\nbuilds={builds:?}"</span>);

    <span class="comment">// Load the Mastodon Posts for All Builds
    </span><span class="kw">let </span><span class="kw-2">mut </span>all_builds = <span class="macro">json!</span>({});
    <span class="kw">if let </span><span class="prelude-val">Ok</span>(file) = File::open(ALL_BUILDS_FILENAME) {
        <span class="kw">let </span>reader = BufReader::new(file);
        all_builds = serde_json::from_reader(reader).unwrap();    
    }

    <span class="comment">// For Each Failed Build...
    </span><span class="kw">for </span>build <span class="kw">in </span>builds.as_array().unwrap() {
        <span class="macro">println!</span>(<span class="string">"\n\nbuild={build:?}"</span>);
        <span class="kw">let </span>metric = <span class="kw-2">&amp;</span>build[<span class="string">"metric"</span>];
        <span class="macro">println!</span>(<span class="string">"\n\nmetric={metric:?}"</span>);
        <span class="kw">let </span>board = metric[<span class="string">"board"</span>].as_str().unwrap();
        <span class="kw">let </span>config = metric[<span class="string">"config"</span>].as_str().unwrap();
        <span class="kw">let </span>user = metric[<span class="string">"user"</span>].as_str().unwrap();
        <span class="kw">let </span>msg = metric[<span class="string">"msg"</span>].as_str().unwrap_or(<span class="string">""</span>);
        <span class="kw">let </span>config_upper = config.to_uppercase();
        <span class="kw">let </span>target = <span class="macro">format!</span>(<span class="string">"{board}:{config}"</span>);
        <span class="macro">println!</span>(<span class="string">"\n\nboard={board}"</span>);
        <span class="macro">println!</span>(<span class="string">"config={config}"</span>);
        <span class="macro">println!</span>(<span class="string">"user={user}"</span>);
        <span class="macro">println!</span>(<span class="string">"msg={msg}"</span>);

        <span class="comment">// Compose the Mastodon Post as...
        // rv-virt : CITEST - Build Failed (NuttX)
        // NuttX Dashboard: ...
        // Build History: ...
        // [Error Message]
        </span><span class="kw">let </span><span class="kw-2">mut </span>status = <span class="macro">format!</span>(
            <span class="string">r##"
{board} : {config_upper} - Build Failed ({user})
NuttX Dashboard: https://nuttx-dashboard.org
Build History: https://nuttx-dashboard.org/d/fe2q876wubc3kc/nuttx-build-history?var-board={board}&amp;var-config={config}

{msg}
            "##</span>);
        status.truncate(<span class="number">512</span>);  <span class="comment">// Mastodon allows only 500 chars
        </span><span class="kw">let </span><span class="kw-2">mut </span>params = Vec::new();
        params.push((<span class="string">"status"</span>, status));

        <span class="comment">// If the Mastodon Post already exists for Board and Config:
        // Reply to the Mastodon Post
        </span><span class="kw">if let </span><span class="prelude-val">Some</span>(status_id) = all_builds[<span class="kw-2">&amp;</span>target][<span class="string">"status_id"</span>].as_str() {
            params.push((<span class="string">"in_reply_to_id"</span>, status_id.to_string()));

            <span class="comment">// If the User already exists for the Board and Config:
            // Skip the Mastodon Post
            </span><span class="kw">if let </span><span class="prelude-val">Some</span>(users) = all_builds[<span class="kw-2">&amp;</span>target][<span class="string">"users"</span>].as_array() {
                <span class="kw">if </span>users.contains(<span class="kw-2">&amp;</span><span class="macro">json!</span>(user)) {
                    <span class="macro">println!</span>(<span class="string">"Skipping {user} @ {target}, already exists"</span>);
                    <span class="kw">continue</span>;
                }
            }
        }

        <span class="comment">// Post to Mastodon
        </span><span class="kw">let </span>token = std::env::var(<span class="string">"MASTODON_TOKEN"</span>)
            .expect(<span class="string">"MASTODON_TOKEN env variable is required"</span>);
        <span class="kw">let </span>client = reqwest::Client::new();
        <span class="kw">let </span>mastodon = <span class="string">"https://nuttx-feed.org/api/v1/statuses"</span>;
        <span class="kw">let </span>res = client
            .post(mastodon)
            .header(<span class="string">"Authorization"</span>, <span class="macro">format!</span>(<span class="string">"Bearer {token}"</span>))
            .form(<span class="kw-2">&amp;</span>params)
            .send()
            .<span class="kw">await</span><span class="question-mark">?</span>;
        <span class="macro">println!</span>(<span class="string">"res={res:?}"</span>);
        <span class="kw">if </span>!res.status().is_success() {
            <span class="macro">println!</span>(<span class="string">"*** Mastodon Failed: {user} @ {target}"</span>);
            sleep(Duration::from_secs(<span class="number">30</span>));
            <span class="kw">continue</span>;
        }
        <span class="macro">println!</span>(<span class="string">"Status: {}"</span>, res.status());
        <span class="macro">println!</span>(<span class="string">"Headers:\n{:#?}"</span>, res.headers());
        <span class="kw">let </span>body = res.text().<span class="kw">await</span><span class="question-mark">?</span>;
        <span class="macro">println!</span>(<span class="string">"Body: {body}"</span>);

        <span class="comment">// Remember the Mastodon Post ID (Status ID)
        </span><span class="kw">let </span>status: Value = serde_json::from_str(<span class="kw-2">&amp;</span>body).unwrap();
        <span class="kw">let </span>status_id = status[<span class="string">"id"</span>].as_str().unwrap();
        <span class="macro">println!</span>(<span class="string">"status_id={status_id}"</span>);
        all_builds[<span class="kw-2">&amp;</span>target][<span class="string">"status_id"</span>] = status_id.into();

        <span class="comment">// Append the User to All Builds
        </span><span class="kw">if let </span><span class="prelude-val">Some</span>(users) = all_builds[<span class="kw-2">&amp;</span>target][<span class="string">"users"</span>].as_array() {
            <span class="kw">if </span>!users.contains(<span class="kw-2">&amp;</span><span class="macro">json!</span>(user)) {
                <span class="kw">let </span><span class="kw-2">mut </span>users = users.clone();
                users.push(<span class="macro">json!</span>(user));
                all_builds[<span class="kw-2">&amp;</span>target][<span class="string">"users"</span>] = <span class="macro">json!</span>(users);
            }
        } <span class="kw">else </span>{
            all_builds[<span class="kw-2">&amp;</span>target][<span class="string">"users"</span>] = <span class="macro">json!</span>([user]);
        }

        <span class="comment">// Save the Mastodon Posts for All Builds
        </span><span class="kw">let </span>json = to_string_pretty(<span class="kw-2">&amp;</span>all_builds).unwrap();
        <span class="kw">let </span><span class="kw-2">mut </span>file = File::create(ALL_BUILDS_FILENAME).unwrap();
        file.write_all(json.as_bytes()).unwrap();
        <span class="macro">println!</span>(<span class="string">"\n\nall_builds=\n{json}"</span>);

        <span class="comment">// Wait a while
        </span>sleep(Duration::from_secs(<span class="number">30</span>));
    }

    <span class="comment">// Return OK
    </span><span class="prelude-val">Ok</span>(())
}</code></pre></div>
<p>TODO: Suppose I‚Äôm interested in only rv-virt:python. Can I subscribe to the alerts via Mastodon / Fediverse / ActivityPub?</p>
<div class="example-wrap"><pre class="language-text"><code>Query Prometheus for Build Failures
http://localhost:9090
build_score{user!=&quot;rewind&quot;, user!=&quot;nuttxlinux&quot;, user!=&quot;nuttxmacos&quot;, user!=&quot;jerpelea&quot;} &lt; 0.5

curl -X POST \
        -F &#39;query=build_score{config!=&quot;leds64_zig&quot;, user!=&quot;rewind&quot;, user!=&quot;nuttxlinux&quot;, user!=&quot;nuttxmacos&quot;, user!=&quot;jerpelea&quot;} &lt; 0.5&#39; \
        http://localhost:9090/api/v1/query

{&quot;status&quot;:&quot;success&quot;,&quot;data&quot;:{&quot;resultType&quot;:&quot;vector&quot;,&quot;result&quot;:[{&quot;metric&quot;:{&quot;__name__&quot;:&quot;build_score&quot;,&quot;apps_hash&quot;:&quot;b08c29617bbf1f2c6227f74e23ffdd7706997e0c&quot;,&quot;arch&quot;:&quot;risc-v&quot;,&quot;board&quot;:&quot;rv-virt&quot;,&quot;config&quot;:&quot;citest&quot;,&quot;exported_instance&quot;:&quot;rv-virt:citest&quot;,&quot;exported_job&quot;:&quot;nuttxpr&quot;,&quot;group&quot;:&quot;risc-v-05&quot;,&quot;instance&quot;:&quot;localhost:9091&quot;,&quot;job&quot;:&quot;pushgateway&quot;,&quot;msg&quot;:&quot;virtio/virtio-mmio.c: In function &#39;virtio_mmio_config_virtqueue&#39;: \n virtio/virtio-mmio.c:346:14: error: cast from pointer to integer of different size [-Werror=pointer-to-int-cast] \n 346 |       addr = (uint64_t)kasan_reset_tag((FAR void *)vq-&gt;vq_ring.desc); \n |              ^ \n virtio/virtio-mmio.c:350:14: error: cast from pointer to integer of different size [-Werror=pointer-to-int-cast] \n 350 |       addr = (uint64_t)kasan_reset_tag((FAR void *)vq-&gt;vq_ring.avail); \n |              ^ \n virtio/virti&quot;,&quot;nuttx_hash&quot;:&quot;04815338334e63cd82c38ee12244e54829766e88&quot;,&quot;subarch&quot;:&quot;qemu-rv&quot;,&quot;target&quot;:&quot;rv-virt:citest&quot;,&quot;timestamp&quot;:&quot;2024-12-06T06:14:54&quot;,&quot;url&quot;:&quot;https://gist.github.com/nuttxpr/7bec636a5f7b23ea8c845923025f2406#file-ci-risc-v-05-log-L169&quot;,&quot;url_display&quot;:&quot;gist.github.com/nuttxpr/7bec636a5f7b23ea8c845923025f2406#file-ci-risc-v-05-log-L169&quot;,&quot;user&quot;:&quot;nuttxpr&quot;,&quot;version&quot;:&quot;3&quot;},&quot;value&quot;:[1733974316.308,&quot;0&quot;]},{&quot;metric&quot;:{&quot;__name__&quot;:&quot;build_score&quot;,&quot;apps_hash&quot;:&quot;b08c29617bbf1f2c6227f74e23ffdd7706997e0c&quot;,&quot;arch&quot;:&quot;risc-v&quot;,&quot;board&quot;:&quot;rv-virt&quot;,&quot;config&quot;:&quot;citest64&quot;,&quot;exported_instance&quot;:&quot;rv-virt:citest64&quot;,&quot;exported_job&quot;:&quot;nuttxpr&quot;,&quot;group&quot;:&quot;risc-v-05&quot;,&quot;instance&quot;:&quot;localhost:9091&quot;,&quot;job&quot;:&quot;pushgateway&quot;,&quot;msg&quot;:&quot;test_example/test_example.py::test_popen FAILED                                  [ 30%] \n test_example/test_example.py::test_usrsocktest FAILED                            [ 38%] \n test_os/test_os.py::test_ostest FAILED                                           [ 46%]&quot;,&quot;nuttx_hash&quot;:&quot;04815338334e63cd82c38ee12244e54829766e88&quot;,&quot;subarch&quot;:&quot;qemu-rv&quot;,&quot;target&quot;:&quot;rv-virt:citest64&quot;,&quot;timestamp&quot;:&quot;2024-12-06T06:19:39&quot;,&quot;url&quot;:&quot;https://gist.github.com/nuttxpr/7bec636a5f7b23ea8c845923025f2406#file-ci-risc-v-05-log-L236&quot;,&quot;url_display&quot;:&quot;gist.github.com/nuttxpr/7bec636a5f7b23ea8c845923025f2406#file-ci-risc-v-05-log-L236&quot;,&quot;user&quot;:&quot;nuttxpr&quot;,&quot;version&quot;:&quot;3&quot;},&quot;value&quot;:[1733974316.308,&quot;0&quot;]},{&quot;metric&quot;:{&quot;__name__&quot;:&quot;build_score&quot;,&quot;apps_hash&quot;:&quot;37acd5e6712bc91e6c5fd3b9cdde06ff9a3cada3&quot;,&quot;arch&quot;:&quot;xtensa&quot;,&quot;board&quot;:&quot;esp32-devkitc&quot;,&quot;config&quot;:&quot;nxdiag&quot;,&quot;exported_instance&quot;:&quot;esp32-devkitc:nxdiag&quot;,&quot;exported_job&quot;:&quot;nuttxmacos2&quot;,&quot;group&quot;:&quot;xtensa-01&quot;,&quot;instance&quot;:&quot;localhost:9091&quot;,&quot;job&quot;:&quot;pushgateway&quot;,&quot;msg&quot;:&quot;./nxdiag.c:34:10: fatal error: sysinfo.h: No such file or directory \n 34 | #include \&quot;sysinfo.h\&quot; \n |          ^~~~~~~~~~~ \n compilation terminated. \n ERROR: xtensa-esp32-elf-gcc failed: 1 \n command: xtensa-esp32-elf-gcc -MT ./nxdiag.c.private.tmp.run-job-macos.apps.system.nxdiag.o  -M &#39;-fno-common&#39; &#39;-Wall&#39; &#39;-Wstrict-prototypes&#39; &#39;-Wshadow&#39; &#39;-Wundef&#39; &#39;-Wno-attributes&#39; &#39;-Wno-unknown-pragmas&#39; &#39;-Wno-psabi&#39; &#39;-Os&#39; &#39;-fno-strict-aliasing&#39; &#39;-fomit-frame-pointer&#39; &#39;-ffunction-sections&#39; &#39;-fdata-sections&#39; &#39;-mlongca&quot;,&quot;nuttx_hash&quot;:&quot;fd20684a7b65b45a8e1e4e52ea8a4bd4b47cb11a&quot;,&quot;subarch&quot;:&quot;esp32&quot;,&quot;target&quot;:&quot;esp32-devkitc:nxdiag&quot;,&quot;timestamp&quot;:&quot;2024-12-09T23:07:00&quot;,&quot;url&quot;:&quot;https://gitlab.com/nuttxmacos2/nuttx-build-log/-/snippets/4778616#L1075&quot;,&quot;url_display&quot;:&quot;gitlab.com/nuttxmacos2/nuttx-build-log/-/snippets/4778616#L1075&quot;,&quot;user&quot;:&quot;nuttxmacos2&quot;,&quot;version&quot;:&quot;3&quot;},&quot;value&quot;:[1733974316.308,&quot;0&quot;]},{&quot;metric&quot;:{&quot;__name__&quot;:&quot;build_score&quot;,&quot;apps_hash&quot;:&quot;1f8b9aa74c38460fe8fe47646f70e85e79bcc21f&quot;,&quot;arch&quot;:&quot;risc-v&quot;,&quot;board&quot;:&quot;rv-virt&quot;,&quot;config&quot;:&quot;citest&quot;,&quot;exported_instance&quot;:&quot;rv-virt:citest&quot;,&quot;exported_job&quot;:&quot;nuttxmacos2&quot;,&quot;group&quot;:&quot;risc-v-05&quot;,&quot;instance&quot;:&quot;localhost:9091&quot;,&quot;job&quot;:&quot;pushgateway&quot;,&quot;msg&quot;:&quot;test_example/test_example.py::test_helloxx FAILED                                            [  0%] \n test_example/test_example.py::test_pipe FAILED                                               [  0%] \n test_example/test_example.py::test_popen FAILED                                              [  0%] \n test_example/test_example.py::test_usrsocktest FAILED                                        [  0%] \n test_open_posix/test_openposix_.py::test_ltp_interfaces_mq_send_4_2 FAILED                   [  0%] &quot;,&quot;nuttx_hash&quot;:&quot;5607eece841346ae807f1474ea36e422d6dfc97d&quot;,&quot;subarch&quot;:&quot;qemu-rv&quot;,&quot;target&quot;:&quot;rv-virt:citest&quot;,&quot;timestamp&quot;:&quot;2024-12-10T19:48:36&quot;,&quot;url&quot;:&quot;https://gitlab.com/nuttxmacos2/nuttx-build-log/-/snippets/4779209#L824&quot;,&quot;url_display&quot;:&quot;gitlab.com/nuttxmacos2/nuttx-build-log/-/snippets/4779209#L824&quot;,&quot;user&quot;:&quot;nuttxmacos2&quot;,&quot;version&quot;:&quot;3&quot;},&quot;value&quot;:[1733974316.308,&quot;0&quot;]},{&quot;metric&quot;:{&quot;__name__&quot;:&quot;build_score&quot;,&quot;apps_hash&quot;:&quot;1f8b9aa74c38460fe8fe47646f70e85e79bcc21f&quot;,&quot;arch&quot;:&quot;xtensa&quot;,&quot;board&quot;:&quot;esp32s3-devkit&quot;,&quot;config&quot;:&quot;timer&quot;,&quot;exported_instance&quot;:&quot;esp32s3-devkit:timer&quot;,&quot;exported_job&quot;:&quot;nuttxpr&quot;,&quot;group&quot;:&quot;xtensa-02&quot;,&quot;instance&quot;:&quot;localhost:9091&quot;,&quot;job&quot;:&quot;pushgateway&quot;,&quot;msg&quot;:&quot;In file included from chip/esp32s3_libc_stubs.c:25: \n chip/esp32s3_libc_stubs.c: In function &#39;esp_setup_syscall_table&#39;: \n chip/esp32s3_libc_stubs.c:418:3: error: static assertion failed: \&quot;Invalid size of struct __lock\&quot; \n 418 |   static_assert(sizeof(struct __lock) &gt;= sizeof(mutex_t), \n |   ^~~~~~~~~~~~~ \n make[1]: *** [Makefile:146: esp32s3_libc_stubs.o] Error 1 \n make[1]: Target &#39;libarch.a&#39; not remade because of errors. \n make: *** [tools/LibTargets.mk:170: arch/xtensa/src/libarch.a] Error 2 \n ma&quot;,&quot;nuttx_hash&quot;:&quot;5607eece841346ae807f1474ea36e422d6dfc97d&quot;,&quot;subarch&quot;:&quot;esp32s3&quot;,&quot;target&quot;:&quot;esp32s3-devkit:timer&quot;,&quot;timestamp&quot;:&quot;2024-12-10T23:09:05&quot;,&quot;url&quot;:&quot;https://gist.github.com/nuttxpr/108ce53648bac75a85e8be288351b939#file-ci-xtensa-02-log-L769&quot;,&quot;url_display&quot;:&quot;gist.github.com/nuttxpr/108ce53648bac75a85e8be288351b939#file-ci-xtensa-02-log-L769&quot;,&quot;user&quot;:&quot;nuttxpr&quot;,&quot;version&quot;:&quot;3&quot;},&quot;value&quot;:[1733974316.308,&quot;0&quot;]},{&quot;metric&quot;:{&quot;__name__&quot;:&quot;build_score&quot;,&quot;apps_hash&quot;:&quot;e861ea8b53e6c86b28274e3651036761d17d88ea&quot;,&quot;arch&quot;:&quot;risc-v&quot;,&quot;board&quot;:&quot;rv-virt&quot;,&quot;config&quot;:&quot;citest&quot;,&quot;exported_instance&quot;:&quot;rv-virt:citest&quot;,&quot;exported_job&quot;:&quot;NuttX&quot;,&quot;group&quot;:&quot;risc-v-05&quot;,&quot;instance&quot;:&quot;localhost:9091&quot;,&quot;job&quot;:&quot;pushgateway&quot;,&quot;msg&quot;:&quot;test_example/test_example.py::test_hello FAILED                          [  0%] \n test_example/test_example.py::test_helloxx FAILED                        [  0%] \n test_example/test_example.py::test_pipe FAILED                           [  0%] \n test_example/test_example.py::test_popen FAILED                          [  0%] \n test_example/test_example.py::test_usrsocktest FAILED                    [  0%] \n test_open_posix/test_openposix_.py::test_ltp_interfaces_mq_send_4_2 FAILED [  0%] \n test_open_po&quot;,&quot;nuttx_hash&quot;:&quot;b99e7617aa2fa70f8724a2a7db4b08e723a09bb4&quot;,&quot;subarch&quot;:&quot;qemu-rv&quot;,&quot;target&quot;:&quot;rv-virt:citest&quot;,&quot;timestamp&quot;:&quot;2024-12-11T22:09:43&quot;,&quot;url&quot;:&quot;https://github.com/NuttX/nuttx/actions/runs/12285244144/job/34282901789#step:7:88&quot;,&quot;url_display&quot;:&quot;github.com/NuttX/nuttx/actions/runs/12285244144/job/34282901789#step:7:88&quot;,&quot;user&quot;:&quot;NuttX&quot;,&quot;version&quot;:&quot;3&quot;},&quot;value&quot;:[1733974316.308,&quot;0&quot;]}]}}

----------------------

Create Our App: https://docs.joinmastodon.org/client/token/#app
curl -X POST \
	-F &#39;client_name=NuttX Dashboard&#39; \
	-F &#39;redirect_uris=urn:ietf:wg:oauth:2.0:oob&#39; \
	-F &#39;scopes=read write push&#39; \
	-F &#39;website=https://nuttx-dashboard.org&#39; \
	https://nuttx-feed.org/api/v1/apps

{&quot;id&quot;:&quot;3&quot;,
&quot;name&quot;:&quot;NuttX Dashboard&quot;,
&quot;website&quot;:&quot;https://nuttx-dashboard.org&quot;,
&quot;scopes&quot;:[&quot;read&quot;,&quot;write&quot;,&quot;push&quot;],
&quot;redirect_uris&quot;:[&quot;urn:ietf:wg:oauth:2.0:oob&quot;],
&quot;vapid_key&quot;:&quot;...&quot;,
&quot;redirect_uri&quot;:&quot;urn:ietf:wg:oauth:2.0:oob&quot;,
&quot;client_id&quot;:&quot;...&quot;,
&quot;client_secret&quot;:&quot;...&quot;,
&quot;client_secret_expires_at&quot;:0}

Login to Account: https://docs.joinmastodon.org/client/authorized/
Authorise the User: https://docs.joinmastodon.org/client/authorized/#login
In a web browser:
https://nuttx-feed.org/oauth/authorize
?client_id=YOUR_CLIENT_ID
&amp;scope=read+write+push
&amp;redirect_uri=urn:ietf:wg:oauth:2.0:oob
&amp;response_type=code

&lt;&lt; Copy this authorization code and paste it to the application. &gt;&gt;

It will expire. Do it right away!

Obtain the token: https://docs.joinmastodon.org/client/authorized/#token
export CLIENT_ID=...
export CLIENT_SECRET=...
export AUTH_CODE=...
curl -X POST \
	-F &quot;client_id=$CLIENT_ID&quot; \
	-F &quot;client_secret=$CLIENT_SECRET&quot; \
	-F &quot;redirect_uri=urn:ietf:wg:oauth:2.0:oob&quot; \
	-F &quot;grant_type=authorization_code&quot; \
	-F &quot;code=$AUTH_CODE&quot; \
	-F &quot;scope=read write push&quot; \
	https://nuttx-feed.org/oauth/token

{&quot;access_token&quot;:&quot;...&quot;,
&quot;token_type&quot;:&quot;Bearer&quot;,
&quot;scope&quot;:&quot;read write push&quot;,
&quot;created_at&quot;:1733966892}

export ACCESS_TOKEN=...
curl \
	-H &quot;Authorization: Bearer $ACCESS_TOKEN&quot; \
	https://nuttx-feed.org/api/v1/accounts/verify_credentials

{
  &quot;id&quot;: &quot;...&quot;,
  &quot;username&quot;: &quot;lupyuen&quot;,
  &quot;acct&quot;: &quot;lupyuen&quot;,
  &quot;display_name&quot;: &quot;&quot;,
  &quot;locked&quot;: false,
  &quot;bot&quot;: false,
  &quot;discoverable&quot;: null,
  &quot;indexable&quot;: false,
  &quot;group&quot;: false,
  &quot;created_at&quot;: &quot;2024-12-08T00:00:00.000Z&quot;,
  &quot;note&quot;: &quot;&quot;,
  &quot;url&quot;: &quot;https://nuttx-feed.org/@lupyuen&quot;,
  &quot;uri&quot;: &quot;https://nuttx-feed.org/users/lupyuen&quot;,
  &quot;avatar&quot;: &quot;https://nuttx-feed.org/avatars/original/missing.png&quot;,
  &quot;avatar_static&quot;: &quot;https://nuttx-feed.org/avatars/original/missing.png&quot;,
  &quot;header&quot;: &quot;https://nuttx-feed.org/headers/original/missing.png&quot;,
  &quot;header_static&quot;: &quot;https://nuttx-feed.org/headers/original/missing.png&quot;,
  &quot;followers_count&quot;: 1,
  &quot;following_count&quot;: 1,
  &quot;statuses_count&quot;: 4,
  &quot;last_status_at&quot;: &quot;2024-12-11&quot;,
  &quot;hide_collections&quot;: null,
  &quot;noindex&quot;: false,
  &quot;source&quot;: {
    &quot;privacy&quot;: &quot;public&quot;,
    &quot;sensitive&quot;: false,
    &quot;language&quot;: null,
    &quot;note&quot;: &quot;&quot;,
    &quot;fields&quot;: [],
    &quot;follow_requests_count&quot;: 0,
    &quot;hide_collections&quot;: null,
    &quot;discoverable&quot;: null,
    &quot;indexable&quot;: false
  },
  &quot;emojis&quot;: [],
  &quot;roles&quot;: [
    {
      &quot;id&quot;: &quot;3&quot;,
      &quot;name&quot;: &quot;Owner&quot;,
      &quot;color&quot;: &quot;&quot;
    }
  ],
  &quot;fields&quot;: [],
  &quot;role&quot;: {
    &quot;id&quot;: &quot;3&quot;,
    &quot;name&quot;: &quot;Owner&quot;,
    &quot;permissions&quot;: &quot;1048575&quot;,
    &quot;color&quot;: &quot;&quot;,
    &quot;highlighted&quot;: true
  }
}

Create Status: https://docs.joinmastodon.org/methods/statuses/#create

curl -X POST \
	-H &quot;Authorization: Bearer $ACCESS_TOKEN&quot; \
	-F &quot;status=Posting a status from curl&quot; \
	https://nuttx-feed.org/api/v1/statuses

{&quot;id&quot;:&quot;113637285862132341&quot;,
&quot;created_at&quot;:&quot;2024-12-12T01:36:14.606Z&quot;,
&quot;in_reply_to_id&quot;:null,
&quot;in_reply_to_account_id&quot;:null,
&quot;sensitive&quot;:false,
&quot;spoiler_text&quot;:&quot;&quot;,
&quot;visibility&quot;:&quot;public&quot;,
&quot;language&quot;:&quot;en&quot;,
&quot;uri&quot;:&quot;https://nuttx-feed.org/users/lupyuen/statuses/113637285862132341&quot;,
&quot;url&quot;:&quot;https://nuttx-feed.org/@lupyuen/113637285862132341&quot;,
&quot;replies_count&quot;:0,
&quot;reblogs_count&quot;:0,
&quot;favourites_count&quot;:0,
&quot;edited_at&quot;:null,
&quot;favourited&quot;:false,
&quot;reblogged&quot;:false,
&quot;muted&quot;:false,
&quot;bookmarked&quot;:false,
&quot;pinned&quot;:false,
&quot;content&quot;:&quot;\u003cp\u003ePosting a status from curl\u003c/p\u003e&quot;,
&quot;filtered&quot;:[],
&quot;reblog&quot;:null,
&quot;application&quot;:{&quot;name&quot;:&quot;NuttX Dashboard&quot;,&quot;website&quot;:&quot;https://nuttx-dashboard.org&quot;},
&quot;account&quot;:{&quot;id&quot;:&quot;...&quot;,&quot;username&quot;:&quot;lupyuen&quot;,&quot;acct&quot;:&quot;lupyuen&quot;,&quot;display_name&quot;:&quot;&quot;,&quot;locked&quot;:false,&quot;bot&quot;:false,&quot;discoverable&quot;:null,&quot;indexable&quot;:false,&quot;group&quot;:false,&quot;created_at&quot;:&quot;2024-12-08T00:00:00.000Z&quot;,&quot;note&quot;:&quot;&quot;,&quot;url&quot;:&quot;https://nuttx-feed.org/@lupyuen&quot;,&quot;uri&quot;:&quot;https://nuttx-feed.org/users/lupyuen&quot;,&quot;avatar&quot;:&quot;https://nuttx-feed.org/avatars/original/missing.png&quot;,&quot;avatar_static&quot;:&quot;https://nuttx-feed.org/avatars/original/missing.png&quot;,&quot;header&quot;:&quot;https://nuttx-feed.org/headers/original/missing.png&quot;,&quot;header_static&quot;:&quot;https://nuttx-feed.org/headers/original/missing.png&quot;,&quot;followers_count&quot;:1,&quot;following_count&quot;:1,&quot;statuses_count&quot;:5,&quot;last_status_at&quot;:&quot;2024-12-12&quot;,&quot;hide_collections&quot;:null,&quot;noindex&quot;:false,&quot;emojis&quot;:[],&quot;roles&quot;:[{&quot;id&quot;:&quot;3&quot;,&quot;name&quot;:&quot;Owner&quot;,&quot;color&quot;:&quot;&quot;}],&quot;fields&quot;:[]},&quot;media_attachments&quot;:[],&quot;mentions&quot;:[],&quot;tags&quot;:[],&quot;emojis&quot;:[],&quot;card&quot;:null,&quot;poll&quot;:null}

https://github.com/h3poteto/megalodon-rs

Post With Status: https://github.com/h3poteto/megalodon-rs/blob/master/examples/mastodon_post_with_schedule.rs

-----------------

Public Timeline: https://docs.joinmastodon.org/client/public/#timelines
curl https://nuttx-feed.org/api/v1/timelines/public | jq
 
-----------------

https://gist.github.com/lupyuen/f01da036fd0299abc5c874ace8fd1b22

git clone https://github.com/mastodon/mastodon --branch v4.3.2
code mastodon
echo &gt;mastodon/.env.production

docker-compose.yml
&lt;&lt;
  db:
    volumes:
      -  postgres-data:/var/lib/postgresql/data

  redis:
    volumes:
      - redis-data:/data

  web:
    ports:
      - &#39;127.0.0.1:3001:3000&#39;
    #### TODO: command: bundle exec puma -C config/puma.rb
    command: sleep infinity #### TODO

  sidekiq:
    volumes:
      - lt-data:/mastodon/public/system

volumes:
  postgres-data:
  redis-data:
  es-data:
  lt-data:
&gt;&gt;

docker volume rm postgres-data
docker volume rm redis-data
docker volume rm es-data
docker volume rm lt-data

To Init The Database:
cd mastodon
set docker-compose.yml to &quot;command: sleep infinity&quot;
sudo docker compose up # Error response from daemon: error while creating mount source path &#39;/Users/luppy/mastodon/public/system&#39;: chown /Users/luppy/mastodon/public/system: permission denied
docker compose logs -f
Ctrl-C
sudo docker compose up # Works OK
docker compose logs -f
Ignore Redis and Streaming:
&lt;&lt;
redis-1      | 1:C 08 Dec 2024 23:16:32.034 # WARNING Memory overcommit must be enabled! Without it, a background save or replication may fail under low memory condition. Being disabled, it can also cause failures without low memory condition, see https://github.com/jemalloc/jemalloc/issues/1328. To fix this issue add &#39;vm.overcommit_memory = 1&#39; to /etc/sysctl.conf and then reboot or run the command &#39;sysctl vm.overcommit_memory=1&#39; for this to take effect.
streaming-1  | {&quot;level&quot;:&quot;error&quot;,&quot;time&quot;:1733699834202,&quot;pid&quot;:1,&quot;hostname&quot;:&quot;738ede3870fb&quot;,&quot;name&quot;:&quot;streaming&quot;,&quot;err&quot;:{&quot;type&quot;:&quot;Error&quot;,&quot;message&quot;:&quot;connect ECONNREFUSED 127.0.0.1:6379&quot;,&quot;stack&quot;:&quot;Error: connect ECONNREFUSED 127.0.0.1:6379\n    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1611:16)&quot;,&quot;errno&quot;:-111,&quot;code&quot;:&quot;ECONNREFUSED&quot;,&quot;syscall&quot;:&quot;connect&quot;,&quot;address&quot;:&quot;127.0.0.1&quot;,&quot;port&quot;:6379},&quot;msg&quot;:&quot;Redis Client Error!&quot;}
&gt;&gt;

https://docs.joinmastodon.org/admin/install/#creating-a-user
docker exec -it mastodon-db-1 /bin/bash
exec su-exec postgres psql
CREATE USER mastodon CREATEDB;
\q

https://docs.joinmastodon.org/admin/install/#generating-a-configuration
docker exec -it mastodon-web-1 /bin/bash
RAILS_ENV=production bin/rails mastodon:setup
exit
Copy the settings to .env.production
&lt;&lt;
# Generated with mastodon:setup on 2024-12-08 23:40:38 UTC
...
&gt;&gt;

restore docker-compose.yml to &quot;command: bundle exec puma -C config/puma.rb&quot;
sudo docker compose down
sudo docker compose up
docker compose logs -f
https://nuttx-feed.org/home

Administration &gt; Settings
  &gt; Branding
  &gt; About
  &gt; Registrations &gt; Who can sign up &gt; Approval Required for Sign up &gt; Require a Reason to Join

Moderation &gt; Accounts &gt; Approve

Approve Account:
https://docs.joinmastodon.org/admin/tootctl/#accounts-approve
docker exec -it mastodon-web-1 /bin/bash
bin/tootctl accounts modify nuttx_build --confirm

Ignore SMTP, need to approve manually
&lt;&lt;
sidekiq-1    | 2024-12-09T00:04:55.035Z pid=6 tid=2ppy class=ActionMailer::MailDeliveryJob jid=8b52310d0afc7d27b0af3d4b elapsed=0.043 INFO: fail
sidekiq-1    | 2024-12-09T00:04:55.036Z pid=6 tid=2ppy WARN: {&quot;context&quot;:&quot;Job raised exception&quot;,&quot;job&quot;:{&quot;retry&quot;:true,&quot;queue&quot;:&quot;mailers&quot;,&quot;wrapped&quot;:&quot;ActionMailer::MailDeliveryJob&quot;,&quot;args&quot;:[{&quot;job_class&quot;:&quot;ActionMailer::MailDeliveryJob&quot;,&quot;job_id&quot;:&quot;a7c8ac28-83bd-42b8-a4de-554f533a01f8&quot;,&quot;provider_job_id&quot;:null,&quot;queue_name&quot;:&quot;mailers&quot;,&quot;priority&quot;:null,&quot;arguments&quot;:[&quot;UserMailer&quot;,&quot;password_change&quot;,&quot;deliver_now&quot;,{&quot;args&quot;:[{&quot;_aj_globalid&quot;:&quot;gid://mastodon/User/1&quot;}],&quot;_aj_ruby2_keywords&quot;:[&quot;args&quot;]}],&quot;executions&quot;:0,&quot;exception_executions&quot;:{},&quot;locale&quot;:&quot;en&quot;,&quot;timezone&quot;:&quot;UTC&quot;,&quot;enqueued_at&quot;:&quot;2024-12-09T00:00:54.250576360Z&quot;,&quot;scheduled_at&quot;:null}],&quot;class&quot;:&quot;ActiveJob::QueueAdapters::SidekiqAdapter::JobWrapper&quot;,&quot;jid&quot;:&quot;8b52310d0afc7d27b0af3d4b&quot;,&quot;created_at&quot;:1733702454.2507422,&quot;enqueued_at&quot;:1733702694.9922712,&quot;error_message&quot;:&quot;Connection refused - connect(2) for \&quot;localhost\&quot; port 25&quot;,&quot;error_class&quot;:&quot;Errno::ECONNREFUSED&quot;,&quot;failed_at&quot;:1733702454.3886917,&quot;retry_count&quot;:3,&quot;retried_at&quot;:1733702562.7745714}}
sidekiq-1    | 2024-12-09T00:04:55.036Z pid=6 tid=2ppy WARN: Errno::ECONNREFUSED: Connection refused - connect(2) for &quot;localhost&quot; port 25
sidekiq-1    | 2024-12-09T00:04:55.036Z pid=6 tid=2ppy WARN: /usr/local/bundle/gems/net-smtp-0.5.0/lib/net/smtp.rb:663:in `initialize&#39;
&gt;&gt;

Create Account:
https://docs.joinmastodon.org/admin/setup/#admin-cli
docker exec -it mastodon-web-1 /bin/bash
bin/tootctl accounts create \
  lupyuen \
  --email luppy@appkaki.com \
  --confirmed \
  --role Owner

Approve Account:
https://docs.joinmastodon.org/admin/tootctl/#accounts-approve
docker exec -it mastodon-web-1 /bin/bash
bin/tootctl accounts approve lupyuen

curl -H &#39;Accept: application/activity+json&#39; https://nuttx-feed.org/@lupyuen | jq

curl -H &#39;Accept: application/activity+json&#39; https://nuttx-feed.org/@lupyuen/113619922496625622 | jq

curl https://nuttx-feed.org/.well-known/webfinger\?resource\=acct:lupyuen@nuttx-feed.org | jq

docker-compose.yml
https://github.com/lupyuen/mastodon/commit/278987886e67fdd8b76d65938f3308071c3cd5c2

Docker Logs:
https://gist.github.com/lupyuen/fb086d6f5fe84044c6c8dae1093b0328
https://gist.github.com/lupyuen/f4f887ccf4ecfda0d5103b834044bd7b
https://gist.github.com/lupyuen/edbf045433189bebd4ad843608772ce8
https://gist.github.com/lupyuen/420540f9157f2702c14944fc47743742
https://gist.github.com/lupyuen/89eb8fc76ac9342209bb9c0553298d4c
https://gist.github.com/lupyuen/21ad4e38fa00796d132e63d41e4a339f

CloudFlare: Security &gt; Settings &gt; High

Administration &gt; Dashboard
Could not connect to Elasticsearch. Please check that it is running, or disable full-text search

Enable Elastisearch:
https://github.com/lupyuen/mastodon/commit/b7d147d1e4928013ae789d783cf96b5b2628e347
.env.production
&lt;&lt;
ES_ENABLED=true
ES_HOST=es
ES_PORT=9200
&gt;&gt;
docker-compose.yml: Uncomment section for es
&lt;&lt;
  es:
    volumes:
       - es-data:/usr/share/elasticsearch/data
  web:
    depends_on:
      - db
      - redis
      - es
&gt;&gt;
docker compose down
docker compose build
docker compose up
docker compose logs -f
&lt;&lt;
es-1         | bootstrap check failure [1] of [1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]
&gt;&gt;

Increase max_map_count:
https://docs.rancherdesktop.io/how-to-guides/increasing-open-file-limit/
Restart Docker Desktop

docker exec -it mastodon-es-1 /bin/bash -c &quot;sysctl vm.max_map_count&quot;
&lt;&lt;
vm.max_map_count = 262144
&gt;&gt;

Administration &gt; Dashboard
&lt;&lt;
Elasticsearch index mappings are outdated
&gt;&gt;

docker exec -it mastodon-web-1 /bin/bash
bin/tootctl search deploy --only=instances accounts tags statuses public_statuses

Backing up Mastodon:
https://docs.joinmastodon.org/admin/backups/
Postgres:
docker exec -it mastodon-db-1 /bin/bash -c &quot;exec su-exec postgres pg_dumpall&quot; &gt;mastodon.sql
head -50 mastodon.sql

Redis:
docker cp mastodon-redis-1:/data/dump.rdb .
strings dump.rdb | tail -50

User-uploaded files:
tar cvf mastodon-public-system.tar mastodon/public/system

-----------------

Previously:
git clone https://github.com/mastodon/mastodon --branch v4.3.2
code mastodon

.devcontainer/compose.yaml:
&lt;&lt;
    ports:
      - &#39;127.0.0.1:3001:3000&#39;
&gt;&gt;

.env.development
&lt;&lt;
LOCAL_DOMAIN=nuttx-feed.org
&gt;&gt;

cd mastodon
docker compose -f .devcontainer/compose.yaml up -d
docker compose -f .devcontainer/compose.yaml exec app bin/setup
docker compose -f .devcontainer/compose.yaml exec app bin/dev
http://localhost:3001/home
docker compose -f .devcontainer/compose.yaml down

https://docs.joinmastodon.org/admin/setup/#admin-cli
docker exec -it devcontainer-app-1 /bin/bash
bin/tootctl accounts create \
  lupyuen \
  --email luppy@appkaki.com \
  --confirmed \
  --role Owner

https://docs.joinmastodon.org/admin/tootctl/#accounts-approve
bin/tootctl accounts approve lupyuen

docker exec -it devcontainer-app-1 /bin/bash
bin/tootctl search deploy --only=tags</code></pre></div>
<p>TODO: <a href="https://prometheus.io/docs/alerting/latest/alertmanager/">Alertmanager</a></p>
<h1 id="whats-next"><a class="doc-anchor" href="#whats-next">¬ß</a>2 What‚Äôs Next</h1>
<p>TODO</p>
<p>Many Thanks to the awesome <strong>NuttX Admins</strong> and <strong>NuttX Devs</strong>! And my <a href="https://github.com/sponsors/lupyuen"><strong>GitHub Sponsors</strong></a>, for sticking with me all these years.</p>
<ul>
<li>
<p><a href="https://github.com/sponsors/lupyuen"><strong>Sponsor me a coffee</strong></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/nuttx-sg2000"><strong>My Current Project: ‚ÄúApache NuttX RTOS for Sophgo SG2000‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/nuttx-ox64"><strong>My Other Project: ‚ÄúNuttX for Ox64 BL808‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/nuttx-star64"><strong>Older Project: ‚ÄúNuttX for Star64 JH7110‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/pinephone-nuttx"><strong>Olderer Project: ‚ÄúNuttX for PinePhone‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io"><strong>Check out my articles</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/rss.xml"><strong>RSS Feed</strong></a></p>
</li>
</ul>
<p><em>Got a question, comment or suggestion? Create an Issue or submit a Pull Request here‚Ä¶</em></p>
<p><a href="https://github.com/lupyuen/lupyuen.github.io/blob/master/src/mastodon.md"><strong>lupyuen.github.io/src/mastodon.md</strong></a></p>

    
    <!-- Begin scripts/rustdoc-after.html: Post-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker and Prism Theme -->
    <script src="../theme.js"></script>
    <script src="../prism.js"></script>
    <!-- Theme Picker and Prism Theme -->

    <!-- End scripts/rustdoc-after.html -->
    

</body>
</html>