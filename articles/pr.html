<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>Preparing a Pull Request for Apache NuttX RTOS</title>

    
    <!-- Begin scripts/articles/*-header.html: Article Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<meta property="og:title" 
    content="Preparing a Pull Request for Apache NuttX RTOS" 
    data-rh="true">
<meta property="og:description" 
    content="Here are the steps to prepare a Pull Request for Apache NuttX RTOS"
    data-rh="true">
<meta name="description" 
    content="Here are the steps to prepare a Pull Request for Apache NuttX RTOS">
<meta property="og:image" 
    content="https://lupyuen.github.io/images/pr-title.jpg">
<meta property="og:type" 
    content="article" data-rh="true">
<!-- End scripts/articles/*-header.html -->
<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">
<link rel="stylesheet" type="text/css" href="../dark.css">
<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
    a {
        color: #77d;
    }
</style>
<!-- End scripts/rustdoc-header.html -->


</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

        <!-- Begin scripts/rustdoc-before.html: Pre-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker -->
    <div class="theme-picker" style="left: 0"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg"
        width="18" alt="Pick another theme!"></button>
        <div id="theme-choices"></div>
    </div>
    <script src="../theme.js"></script>
    <script src="../prism.js"></script>
    <!-- Theme Picker -->

    <!-- End scripts/rustdoc-before.html -->
    

    <h1 class="title">Preparing a Pull Request for Apache NuttX RTOS</h1>
    <nav id="TOC"><ul>
<li><a href="#nuttx-repositories">1 NuttX Repositories</a><ul></ul></li>
<li><a href="#build-and-test">2 Build and Test</a><ul>
<li><a href="#regression-testing">2.1 Regression Testing</a><ul></ul></li>
<li><a href="#documentation">2.2 Documentation</a><ul></ul></li></ul></li>
<li><a href="#check-coding-style">3 Check Coding Style</a><ul></ul></li>
<li><a href="#squash-the-commits">4 Squash the Commits</a><ul></ul></li>
<li><a href="#write-the-pull-request">5 Write the Pull Request</a><ul>
<li><a href="#summary">5.1 Summary</a><ul></ul></li>
<li><a href="#impact">5.2 Impact</a><ul></ul></li>
<li><a href="#testing">5.3 Testing</a><ul></ul></li></ul></li>
<li><a href="#meditate">6 Meditate</a><ul></ul></li>
<li><a href="#submit-the-pull-request">7 Submit the Pull Request</a><ul></ul></li>
<li><a href="#fix-the-pull-request">8 Fix the Pull Request</a><ul></ul></li>
<li><a href="#update-our-repositories">9 Update Our Repositories</a><ul></ul></li>
<li><a href="#whats-next">10 What‚Äôs Next</a><ul></ul></li></ul></nav><p>üìù <em>30 Nov 2022</em></p>
<p><img src="https://lupyuen.github.io/images/pr-title.jpg" alt="TODO" /></p>
<p>This article explains how I prepared my Pull Requests for submission to <a href="https://nuttx.apache.org/docs/latest/index.html"><strong>Apache NuttX RTOS</strong></a>. So if we‚Äôre contributing code to NuttX, just follow these steps and things will (probably) go hunky dory!</p>
<p>Before we begin, please check out the official <strong>Development Workflow</strong> for NuttX‚Ä¶</p>
<ul>
<li><a href="https://nuttx.apache.org/docs/latest/contributing/workflow.html"><strong>‚ÄúNuttX Development Workflow‚Äù</strong></a></li>
</ul>
<p>OK let‚Äôs dive in!</p>
<p><img src="https://lupyuen.github.io/images/pr-fork.png" alt="Create Fork" /></p>
<h1 id="nuttx-repositories"><a href="#nuttx-repositories">1 NuttX Repositories</a></h1>
<p>We begin by <strong>creating our forks</strong> for the <strong><code>nuttx</code></strong> and <strong><code>apps</code></strong> repositories‚Ä¶</p>
<ol>
<li>
<p>Browse to <strong>NuttX Repository</strong>‚Ä¶</p>
<p><a href="https://github.com/apache/nuttx"><strong>github.com/apache/nuttx</strong></a></p>
<p>Click ‚Äú<strong>Fork</strong>‚Äù to create our fork. (Pic above)</p>
<p>Click ‚Äú<strong>Actions</strong>‚Äù and enable workflows‚Ä¶</p>
<p><img src="https://lupyuen.github.io/images/pr-actions.png" alt="Enable Workflows" /></p>
<p>(This will check that our code compiles OK at every commit)</p>
</li>
<li>
<p>Do the same for the <strong>NuttX Apps Repository</strong>‚Ä¶</p>
<p><a href="https://github.com/apache/nuttx-apps"><strong>github.com/apache/nuttx-apps</strong></a></p>
<p>Click ‚Äú<strong>Fork</strong>‚Äù to create our fork.</p>
<p>Click ‚Äú<strong>Actions</strong>‚Äù and enable workflows.</p>
</li>
<li>
<p>As a principle, let‚Äôs keep our <strong><code>master</code></strong> branch <strong>always in sync</strong> with the NuttX Mainline <strong><code>master</code></strong> branch.</p>
<p>(This seems cleaner for syncing upstream updates into our repo)</p>
<p>Let‚Äôs <strong>create a branch</strong> to make our changes‚Ä¶</p>
</li>
<li>
<p>In our NuttX Repository, click <strong><code>master</code></strong>.</p>
<p>Enter the name of our new branch.</p>
<p>Click ‚Äú<strong>Create Branch</strong>‚Äù</p>
<p><img src="https://lupyuen.github.io/images/pr-branch.png" alt="Create Branch" /></p>
<p><a href="https://github.com/lupyuen2/wip-pinephone-nuttx/tree/gic">(I named my branch <strong><code>gic</code></strong> for Generic Interrupt Controller)</a></p>
</li>
<li>
<p>Do the same for our <strong>NuttX Apps Repository</strong></p>
<p>(Because we should sync <strong><code>nuttx</code></strong> and <strong><code>apps</code></strong> too)</p>
</li>
<li>
<p>Download the new branches of our <strong><code>nuttx</code></strong> and <strong><code>apps</code></strong> repositories‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code># Download the &quot;gic&quot; branch of &quot;lupyuen2/wip-pinephone-nuttx&quot;
# TODO: Change the branch name and repo URLs
mkdir nuttx
cd nuttx
git clone \
  --branch gic \
  https://github.com/lupyuen2/wip-pinephone-nuttx \
  nuttx
git clone \
  --branch gic \
  https://github.com/lupyuen2/wip-pinephone-nuttx-apps \
  apps</code></pre></div>
<p>We‚Äôre now ready to code!</p>
</li>
</ol>
<h1 id="build-and-test"><a href="#build-and-test">2 Build and Test</a></h1>
<p>TODO</p>
<ul>
<li>
<p>test locally</p>
</li>
<li>
<p>capture the log</p>
</li>
<li>
<p>don‚Äôt wait too long because upstream may change</p>
</li>
<li>
<p>create a PR in a branch</p>
</li>
<li>
<p>testable (QEMU)</p>
</li>
<li>
<p>small modular self-contained feature</p>
</li>
<li>
<p>sometimes GitHub Actions will fail. Just re-run the failed jobs <a href="https://lupyuen.github.io/images/pr-rerun.png">(Like this)</a></p>
</li>
</ul>
<div class="example-wrap"><pre class="language-text"><code>Error response from daemon:
login attempt to https://ghcr.io/v2/
failed with status: 503 Service Unavailable&quot;</code></pre></div><h2 id="regression-testing"><a href="#regression-testing">2.1 Regression Testing</a></h2>
<p><em>Will our modified code break other parts of NuttX?</em></p>
<p>That‚Äôs why it‚Äôs good to run a <a href="https://en.wikipedia.org/wiki/Regression_testing"><strong>Regression Test</strong></a> (if feasible) to be sure that other parts of NuttX aren‚Äôt affected by our modified code.</p>
<p>TODO</p>
<ul>
<li>regression testing</li>
<li>(optional) logs, super helpful for debugging</li>
</ul>
<p>For our Pull Request‚Ä¶</p>
<p><a href="https://github.com/apache/nuttx/pull/7630">arch/arm64: Add support for Generic Interrupt Controller Version 2</a></p>
<p>run.sh QEMU: https://gist.github.com/lupyuen/5e2fba642a33bf64d3378df3795042d7</p>
<ul>
<li>QEMU good for regression testing</li>
<li>Since we might not have the actual hw</li>
<li>How to support PinePhone UART in QEMU?</li>
<li>Zig Extension?</li>
</ul>
<p>(Yeah it will be hard to run a Regression Test if it requires hardware that we don‚Äôt have)</p>
<h2 id="documentation"><a href="#documentation">2.2 Documentation</a></h2>
<p>TODO</p>
<p>Docs: https://nuttx.apache.org/docs/latest/contributing/documentation.html</p>
<p><img src="https://lupyuen.github.io/images/pr-nxstyle.png" alt="Check Coding Style with nxstyle" /></p>
<h1 id="check-coding-style"><a href="#check-coding-style">3 Check Coding Style</a></h1>
<p>TODO</p>
<p><a href="https://nuttx.apache.org/docs/latest/contributing/coding_style.html">NuttX C Coding Standard</a></p>
<p>nxstyle:</p>
<div class="example-wrap"><pre class="language-bash"><code>gcc -o $HOME/nxstyle $HOME/PinePhone/wip-nuttx/nuttx/tools/nxstyle.c

$HOME/nxstyle $HOME/PinePhone/wip-nuttx/nuttx/arch/arm64/Kconfig
../nxstyle arch/arm64/include/qemu/chip.h
../nxstyle arch/arm64/src/common/Make.defs
../nxstyle arch/arm64/src/common/arm64_gic.h
../nxstyle arch/arm64/src/common/arm64_gicv2.c
$HOME/nxstyle $HOME/PinePhone/wip-nuttx/nuttx/arch/arm64/src/common/arm64_gicv3.c
../nxstyle boards/arm64/qemu/qemu-armv8a/README.txt
../nxstyle boards/arm64/qemu/qemu-armv8a/configs/nsh_gicv2/defconfig

/* */ not balanced</code></pre></div>
<p>$HOME/nxstyle $HOME/PinePhone/wip-nuttx/nuttx/arch/arm/src/armv7-a/arm_gicv2.c</p>
<ul>
<li>VSCode Extension?</li>
<li>Linux checkpatch? https://marketplace.visualstudio.com/items?itemName=idanp.checkpatch</li>
<li>Best if can convert to NuttX style </li>
<li>Check one last time</li>
</ul>
<p><img src="https://lupyuen.github.io/images/pr-squash1.png" alt="Squash Commits with GitHub Desktop" /></p>
<h1 id="squash-the-commits"><a href="#squash-the-commits">4 Squash the Commits</a></h1>
<p>TODO</p>
<ul>
<li>Why squash commits </li>
<li>GitHub Desktop</li>
<li>Select commits and squash them</li>
<li>Force push</li>
</ul>
<h1 id="write-the-pull-request"><a href="#write-the-pull-request">5 Write the Pull Request</a></h1>
<p>TODO</p>
<ul>
<li>Markdown PR: https://gist.github.com/lupyuen/4dbe011143dfc5404e1791ba74a79deb</li>
<li>Update Doc</li>
<li>(optional) commands used for testing</li>
<li>(optional) logs, super helpful for debugging</li>
<li>regression testing</li>
</ul>
<p><a href="https://github.com/apache/nuttx/pull/7630">arch/arm64: Add support for Generic Interrupt Controller Version 2</a></p>
<p><a href="https://github.com/apache/nuttx/pull/7692">arch/arm64: Add support for PINE64 PinePhone</a></p>
<h2 id="summary"><a href="#summary">5.1 Summary</a></h2>
<p>TODO</p>
<h2 id="impact"><a href="#impact">5.2 Impact</a></h2>
<p>TODO</p>
<h2 id="testing"><a href="#testing">5.3 Testing</a></h2>
<p>TODO</p>
<h1 id="meditate"><a href="#meditate">6 Meditate</a></h1>
<p>TODO</p>
<ul>
<li>We‚Äôre about to make NuttX History‚Ä¶</li>
<li>Our PR will be recorded for posterity!</li>
<li>Breathe. Take a long walk and ponder who might benefit from the PR, how we might help them</li>
<li>I walked 12 km (3 hours) while meditating on the PR</li>
<li>Submit the PR</li>
<li>(Touch up the PR and resquashif we get an epiphany during the long walk)</li>
</ul>
<h1 id="submit-the-pull-request"><a href="#submit-the-pull-request">7 Submit the Pull Request</a></h1>
<p>TODO</p>
<ul>
<li>Grab a coffee and standby!</li>
<li>let the CI run and fix errors</li>
<li>wait for others to review and comment</li>
<li>Standby to fix the PR (have a strong cup of coffee)</li>
</ul>
<h1 id="fix-the-pull-request"><a href="#fix-the-pull-request">8 Fix the Pull Request</a></h1>
<p>TODO</p>
<h1 id="update-our-repositories"><a href="#update-our-repositories">9 Update Our Repositories</a></h1>
<p>TODO</p>
<ul>
<li>After merge: pull updates</li>
<li>create a new branch for the next feature</li>
</ul>
<p>Command Line: <a href="https://github.com/k88hudson/git-flight-rules">Flight rules for Git</a></p>
<h1 id="whats-next"><a href="#whats-next">10 What‚Äôs Next</a></h1>
<p>TODO</p>
<p>Many Thanks to my <a href="https://github.com/sponsors/lupyuen"><strong>GitHub Sponsors</strong></a> for supporting my work! This article wouldn‚Äôt have been possible without your support.</p>
<ul>
<li>
<p><a href="https://github.com/sponsors/lupyuen"><strong>Sponsor me a coffee</strong></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/pinephone-nuttx"><strong>My Current Project: ‚ÄúApache NuttX RTOS for PinePhone‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/book"><strong>My Other Project: ‚ÄúThe RISC-V BL602 Book‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io"><strong>Check out my articles</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/rss.xml"><strong>RSS Feed</strong></a></p>
</li>
</ul>
<p><em>Got a question, comment or suggestion? Create an Issue or submit a Pull Request here‚Ä¶</em></p>
<p><a href="https://github.com/lupyuen/lupyuen.github.io/blob/master/src/pr.md"><strong>lupyuen.github.io/src/pr.md</strong></a></p>

    
</body>
</html>