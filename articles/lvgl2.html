<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <title>NuttX RTOS for PinePhone: Boot to LVGL</title>

    
    <!-- Begin scripts/articles/*-header.html: Article Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<meta property="og:title" 
    content="NuttX RTOS for PinePhone: Boot to LVGL" 
    data-rh="true">
<meta property="og:description" 
    content="How we configure Apache NuttX RTOS to boot an LVGL Touchscreen App on Pine64 PinePhone"
    data-rh="true">
<meta name="description" 
    content="How we configure Apache NuttX RTOS to boot an LVGL Touchscreen App on Pine64 PinePhone">
<meta property="og:image" 
    content="https://lupyuen.github.io/images/lvgl2-title.jpg">
<meta property="og:type" 
    content="article" data-rh="true">
<!-- End scripts/articles/*-header.html -->
<!-- Begin scripts/rustdoc-header.html: Header for Custom Markdown files processed by rustdoc, like chip8.md -->
<link rel="alternate" type="application/rss+xml" title="RSS Feed for lupyuen" href="/rss.xml" />
<link rel="stylesheet" type="text/css" href="../normalize.css">
<link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle">
<link rel="stylesheet" type="text/css" href="../dark.css">
<link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle">
<link rel="stylesheet" type="text/css" href="../prism.css">
<script src="../storage.js"></script><noscript>
<link rel="stylesheet" href="../noscript.css"></noscript>
<link rel="shortcut icon" href="../favicon.ico">
<style type="text/css">
    #crate-search {
        background-image: url("../down-arrow.svg");
    }
    a {
        color: #77d;
    }
</style>
<!-- End scripts/rustdoc-header.html -->


</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

        <!-- Begin scripts/rustdoc-before.html: Pre-HTML for Custom Markdown files processed by rustdoc, like chip8.md -->

    <!-- Begin Theme Picker -->
    <div class="theme-picker" style="left: 0"><button id="theme-picker" aria-label="Pick another theme!"><img src="../brush.svg"
        width="18" alt="Pick another theme!"></button>
        <div id="theme-choices"></div>
    </div>
    <script src="../theme.js"></script>
    <script src="../prism.js"></script>
    <!-- Theme Picker -->

    <!-- End scripts/rustdoc-before.html -->
    

    <h1 class="title">NuttX RTOS for PinePhone: Boot to LVGL</h1>
    <nav id="TOC"><ul>
<li><a href="#boot-nuttx-on-pinephone">1 Boot NuttX on PinePhone</a><ul></ul></li>
<li><a href="#boot-to-lvgl">2 Boot to LVGL</a><ul></ul></li>
<li><a href="#touch-friendly-lvgl">3 Touch-Friendly LVGL</a><ul></ul></li>
<li><a href="#lvgl-demos">4 LVGL Demos</a><ul></ul></li>
<li><a href="#create-a-touchscreen-app">5 Create a Touchscreen App</a><ul></ul></li>
<li><a href="#whats-next">6 What‚Äôs Next</a><ul></ul></li>
<li><a href="#appendix-build-apache-nuttx-rtos-for-pinephone">7 Appendix: Build Apache NuttX RTOS for PinePhone</a><ul></ul></li>
<li><a href="#appendix-booting-apache-nuttx-rtos-on-pinephone">8 Appendix: Booting Apache NuttX RTOS on PinePhone</a><ul></ul></li></ul></nav><p>üìù <em>24 Jan 2023</em></p>
<p><img src="https://lupyuen.github.io/images/lvgl2-title.jpg" alt="NuttX on PinePhone now boots to the LVGL Touchscreen Demo, without a Serial Cable" /></p>
<p><a href="https://lupyuen.github.io/articles/what"><strong>Apache NuttX RTOS</strong></a> (Real-Time Operating System) now boots on <a href="https://wiki.pine64.org/index.php/PinePhone"><strong>Pine64 PinePhone</strong></a> and runs <strong>Touchscreen Apps</strong>! (Pic above)</p>
<p><em>Does it need a special Serial Cable for PinePhone?</em></p>
<p>Not any more‚Ä¶ NuttX will auto-boot into an <strong>LVGL Touchscreen App</strong>, without a Serial Cable!</p>
<p>All we need is a <strong>microSD Card</strong> for booting NuttX on PinePhone. NuttX won‚Äôt touch the eMMC Storage in PinePhone.</p>
<p>(Perfect for exploring the internals of PinePhone)</p>
<p><em>What‚Äôs LVGL?</em></p>
<p><a href="https://docs.lvgl.io/master/index.html"><strong>LVGL</strong></a> is a popular library for rendering <strong>Graphical User Interfaces</strong> on Microcontrollers.</p>
<p>Now we have ‚Äúupsized‚Äù <strong>LVGL for a Smartphone</strong>. And it works great!</p>
<p><em>So we can create our own Touchscreen App for PinePhone?</em></p>
<p>Yep! With LVGL, NuttX on PinePhone runs Touchscreen Apps <em>almost</em> like a regular Smartphone.</p>
<p>(Though much <em>much</em> simpler: It won‚Äôt make phone calls or browse the web)</p>
<p>In this article we shall‚Ä¶</p>
<ul>
<li>
<p>Make a <strong>Bootable microSD</strong> with NuttX inside</p>
</li>
<li>
<p>Configure NuttX to <strong>boot an LVGL App</strong></p>
</li>
<li>
<p>Make LVGL Apps more <strong>Touch-Friendly</strong> on PinePhone</p>
</li>
<li>
<p>Take a peek at the <strong>LVGL Demo Apps</strong> available for PinePhone</p>
</li>
</ul>
<p>And explore how we might create <strong>our own Touchscreen App</strong> for PinePhone.</p>
<p><em>What‚Äôs NuttX? Why run it on PinePhone?</em></p>
<p>If we‚Äôre new to NuttX, here‚Äôs a gentle intro‚Ä¶</p>
<ul>
<li><a href="https://lupyuen.github.io/articles/what"><strong>‚ÄúNuttX RTOS for PinePhone: What is it?‚Äù</strong></a></li>
</ul>
<p>We begin by making a Bootable microSD‚Ä¶</p>
<p><img src="https://lupyuen.github.io/images/arm-jumpdrive.png" alt="PinePhone Jumpdrive on microSD" /></p>
<h1 id="boot-nuttx-on-pinephone"><a href="#boot-nuttx-on-pinephone">1 Boot NuttX on PinePhone</a></h1>
<p>Let‚Äôs make a <strong>Bootable NuttX microSD</strong> that will start an LVGL Touchscreen App on our PinePhone‚Ä¶</p>
<ol>
<li>
<p>Download the <strong>PinePhone Jumpdrive Image <code>pine64-pinephone.img.xz</code></strong> from‚Ä¶</p>
<p><a href="https://github.com/dreemurrs-embedded/Jumpdrive/releases"><strong>dreemurrs-embedded/Jumpdrive</strong></a></p>
<p>Write the downloaded image to a microSD Card with
<a href="https://www.balena.io/etcher/"><strong>Balena Etcher</strong></a></p>
</li>
<li>
<p>Download <strong><code>Image.gz</code></strong> from the <a href="https://github.com/lupyuen2/wip-pinephone-nuttx/releases/tag/nuttx-12.0.0"><strong>NuttX Release</strong></a>‚Ä¶</p>
<p><a href="https://github.com/lupyuen2/wip-pinephone-nuttx/releases/download/nuttx-12.0.0/Image.gz"><strong>Image.gz: NuttX Image for PinePhone</strong></a></p>
<p>(If we prefer to <strong>build NuttX</strong> ourselves: <a href="https://lupyuen.github.io/articles/lvgl2#appendix-build-apache-nuttx-rtos-for-pinephone"><strong>Follow these steps</strong></a>)</p>
</li>
<li>
<p>Copy the downloaded <strong><code>Image.gz</code></strong> and overwrite the file on the microSD Card.</p>
<p>(Pic above)</p>
</li>
<li>
<p>Insert the microSD Card into PinePhone and power up PinePhone.</p>
<p>NuttX boots on PinePhone and shows (very briefly) a <a href="https://lupyuen.github.io/images/de3-title.jpg"><strong>Test Pattern</strong></a>.</p>
</li>
<li>
<p>The <a href="https://lupyuen.github.io/images/lvgl2-title.jpg"><strong>LVGL Touchscreen Demo</strong></a> appears on PinePhone! <a href="https://lupyuen.github.io/images/lvgl2-title.jpg">(Like this)</a></p>
<p>Tap around and play with the LVGL Widgets (UI Controls).</p>
<p><a href="https://www.youtube.com/watch?v=N-Yc2jj3TtQ">(Watch the demo on YouTube)</a></p>
</li>
</ol>
<p><em>Something doesn‚Äôt work right‚Ä¶</em></p>
<p>Yeah there are some <strong>limitations in our Touch Panel Driver</strong>: Scrolling and swiping won‚Äôt work right now.</p>
<p>Someday we might fix these issues in our driver‚Ä¶</p>
<ul>
<li><a href="https://lupyuen.github.io/articles/touch2#driver-limitations"><strong>‚ÄúTouch Panel Driver Limitations‚Äù</strong></a></li>
</ul>
<p>Let‚Äôs find out how we made Nuttx boot to LVGL‚Ä¶</p>
<p><img src="https://lupyuen.github.io/images/dsi3-title.jpg" alt="PinePhone with USB Serial Debug Cable" /></p>
<p><a href="https://wiki.pine64.org/index.php/PinePhone#Serial_console"><em>PinePhone with USB Serial Debug Cable</em></a></p>
<h1 id="boot-to-lvgl"><a href="#boot-to-lvgl">2 Boot to LVGL</a></h1>
<p><em>How did we configure NuttX to boot with an LVGL App?</em></p>
<p>Normally NuttX boots to the <strong>NSH Shell</strong>. Which lets us execute Console Commands through a <a href="https://wiki.pine64.org/index.php/PinePhone#Serial_console"><strong>USB Serial Debug Cable</strong></a>. (Pic above)</p>
<p>But for today‚Äôs demo we configured NuttX to boot instead with the <strong>LVGL Demo App</strong>. In the NuttX Project Folder, we ran‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>make menuconfig
</code></pre></div>
<p>And we set these options‚Ä¶</p>
<ol>
<li>
<p>In ‚Äú<strong>RTOS Features</strong> &gt; <strong>Tasks and Scheduling</strong>‚Äù‚Ä¶</p>
<p>Set <strong>‚ÄúApplication Entry Point‚Äù</strong> to <strong><code>lvgldemo_main</code></strong></p>
<p><em>(Which sets CONFIG_INIT_ENTRYPOINT)</em></p>
<p>Set <strong>‚ÄúApplication Entry Name‚Äù</strong> to <strong><code>lvgldemo_main</code></strong></p>
<p><em>(Which sets CONFIG_INIT_ENTRYNAME)</em></p>
</li>
<li>
<p>In ‚Äú<strong>Application Configuration</strong> &gt; <strong>NSH Library</strong>‚Äù‚Ä¶</p>
<p>Disable <strong>‚ÄúHave Architecture-Specific Initialization‚Äù</strong></p>
<p><em>(Which disables CONFIG_NSH_ARCHINIT)</em></p>
</li>
<li>
<p>Save the configuration and exit <strong><code>menuconfig</code></strong></p>
</li>
</ol>
<p>Which will start the <strong><code>lvgldemo</code></strong> app (instead of <strong><code>nsh</code></strong>) when NuttX boots.</p>
<p><em>Doesn‚Äôt <code>lvgldemo</code> require a Command-Line Argument?</em></p>
<p><strong><code>lvgldemo</code></strong> doesn‚Äôt require a Command-Line Argument if we make sure that <strong>only one LVGL Demo</strong> is selected. <a href="https://github.com/apache/nuttx-apps/pull/1494">(Because of this)</a></p>
<p>We‚Äôll talk about the available LVGL Demos in a while.</p>
<p><em>Why disable ‚ÄúNSH Architecture-Specific Initialization‚Äù?</em></p>
<p>Usually the NSH Shell initialises the drivers for <strong>LCD Display and Touch Panel</strong> on PinePhone.</p>
<p>But since we‚Äôre not running NSH Shell, we configured NuttX to initialise the drivers in our LVGL Demo App.</p>
<p><a href="https://github.com/apache/nuttx-apps/blob/master/examples/lvgldemo/lvgldemo.c#L42-L59">(More about this)</a></p>
<p>The Default LVGL Demo is a little hard to use, let‚Äôs talk about it‚Ä¶</p>
<p><img src="https://lupyuen.github.io/images/fb-lvgl3.jpg" alt="Default LVGL Demo App is not quite so Touch-Friendly" /></p>
<p><em>Default LVGL Demo App is not quite so Touch-Friendly</em></p>
<h1 id="touch-friendly-lvgl"><a href="#touch-friendly-lvgl">3 Touch-Friendly LVGL</a></h1>
<p><em>Is there a problem with the LVGL Demo App?</em></p>
<p>The pic above shows the LVGL Demo App with the Default Settings. The <strong>dense screen</strong> is a little hard to use with my thick shaky fingers‚Ä¶</p>
<ul>
<li><a href="https://youtu.be/N-Yc2jj3TtQ"><strong>Watch the demo on YouTube</strong></a></li>
</ul>
<p>Let‚Äôs tweak the LVGL Demo Code to make our app more accessible.</p>
<p>We modify this LVGL Source File: <a href="https://github.com/lupyuen2/wip-pinephone-lvgl/blob/pinephone/demos/widgets/lv_demo_widgets.c#L96-L150">apps/graphics/lvgl/lvgl/ demos/widgets/lv_demo_widgets.c</a></p>
<div class="example-wrap"><pre class="language-c"><code>// Insert this
#include &lt;stdio.h&gt;

// Modify this function
void lv_demo_widgets(void) {
    // Note: PinePhone has width 720 pixels.
    // LVGL will set Display Size to Large, which looks really tiny.
    // Shouldn&#39;t this code depend on DPI? (267 DPI for PinePhone)
    if(LV_HOR_RES &lt;= 320) disp_size = DISP_SMALL;
    else if(LV_HOR_RES &lt; 720) disp_size = DISP_MEDIUM;
    else disp_size = DISP_LARGE;

    // Insert this: Change Display Size from Large to Medium,
    // to make Widgets easier to tap
    disp_size = DISP_MEDIUM;

    // Insert this: Print warning if font is missing
    #undef LV_LOG_WARN
    #define LV_LOG_WARN(s) puts(s)
</code></pre></div>
<p>The first part of the code above comes from LVGL. Since PinePhone has 720 Horizontal Pixels, the code sets <strong>Display Size to Large</strong>. Which squishes everything on PinePhone.</p>
<p>That‚Äôs why in the code above we override and set <strong>Display Size to Medium</strong>. Which makes the screen less dense.</p>
<p><em>Shouldn‚Äôt the Display Size be computed based on Screen DPI?</em></p>
<p>Yeah probably. PinePhone‚Äôs Display has <a href="https://github.com/apache/nuttx/blob/master/boards/arm64/a64/pinephone/configs/lvgl/defconfig#L51"><strong>267 DPI</strong></a>, we should use it in the code above to compute the Display Size.</p>
<p>TODO</p>
<div class="example-wrap"><pre class="language-c"><code>    // Existing Code
    font_large = LV_FONT_DEFAULT;
    font_normal = LV_FONT_DEFAULT;
    lv_coord_t tab_h;

    // For Large Display Size (unused)...
    if(disp_size == DISP_LARGE) {
        ...
    }
    // For Medium Display Size...
    else if(disp_size == DISP_MEDIUM) {
        // Change this: Increase Tab Height from 45 to 70, to make Tabs easier to tap
        tab_h = 70;
        // Previously: tab_h = 45;

#if LV_FONT_MONTSERRAT_20
        font_large     = &amp;lv_font_montserrat_20;
#else
        LV_LOG_WARN(&quot;LV_FONT_MONTSERRAT_20 is not enabled for the widgets demo. Using LV_FONT_DEFAULT instead.&quot;);
#endif
#if LV_FONT_MONTSERRAT_14
        // Use the default font: Montserrat 20 instead of Montserrat 14
        // Previously: font_normal    = &amp;lv_font_montserrat_14;
#else
        LV_LOG_WARN(&quot;LV_FONT_MONTSERRAT_14 is not enabled for the widgets demo. Using LV_FONT_DEFAULT instead.&quot;);
#endif
    }
</code></pre></div>
<p>TODO</p>
<p><a href="https://github.com/apache/nuttx/blob/master/boards/arm64/a64/pinephone/configs/lvgl/defconfig#L52">Default Font</a></p>
<p>Configure LVGL with these settings‚Ä¶</p>
<ul>
<li><a href="https://lupyuen.github.io/articles/touch2#lvgl-calls-our-driver">‚ÄúLVGL Calls Our Driver‚Äù</a></li>
</ul>
<p>And add the fonts‚Ä¶</p>
<ul>
<li>
<p>Browse into ‚Äú<strong>LVGL</strong> &gt; <strong>LVGL Configuration</strong>‚Äù</p>
<ul>
<li>
<p>In ‚Äú<strong>Font usage</strong> &gt; <strong>Enable built-in fonts</strong>‚Äù</p>
<p>Enable ‚Äú<strong>Montserrat 20</strong>‚Äù</p>
</li>
</ul>
</li>
</ul>
<p>The LVGL Demo App is now less dense and easier to use‚Ä¶</p>
<ul>
<li>
<p><a href="https://www.youtube.com/shorts/De5ZehlIka8">Watch the Demo on YouTube</a></p>
<p>(Shot at ISO 800, F/5.6, Manual Focus on Sony NEX-7. Post-processed for Brightness, Constrast and White Point)</p>
</li>
</ul>
<p><em>What if we increase the Default Font Size? From Montserrat 14 to Montserrat 20?</em></p>
<p>Let‚Äôs increase the Default Font Size from 14 to 20‚Ä¶</p>
<ul>
<li>
<p>Browse into ‚Äú<strong>LVGL</strong> &gt; <strong>LVGL Configuration</strong>‚Äù</p>
<ul>
<li>
<p>In ‚Äú<strong>Font usage</strong> &gt; <strong>Select theme default title font</strong>‚Äù</p>
<p>Select ‚Äú<strong>Montserrat 20</strong>‚Äù</p>
</li>
</ul>
</li>
</ul>
<p>We run the LVGL Demo App as is, leaving Display Size <code>disp_size</code> as default <code>DISP_LARGE</code>.</p>
<p>Now the text is legible, but some controls are squished‚Ä¶</p>
<ul>
<li>
<p><a href="https://www.youtube.com/watch?v=N-Yc2jj3TtQ">Watch the Demo on YouTube</a></p>
<p>(Shot at ISO 400, F/5.0, Manual Focus, Exposure 0.3 on Sony NEX-7. No post-processing)</p>
</li>
</ul>
<p>TODO: We need to increase the Default Font Size from 14 to 20, AND set Display Size <code>disp_size</code> to <code>DISP_MEDIUM</code>. And we will get this‚Ä¶</p>
<p>TODO: <a href="https://github.com/lupyuen2/wip-pinephone-lvgl/blob/pinephone/demos/widgets/lv_demo_widgets.c#L96-L150">lv_demo_widgets.c</a></p>
<p><img src="https://lupyuen.github.io/images/lvgl2-title.jpg" alt="After changing LVGL Settings for PinePhone" /></p>
<h1 id="lvgl-demos"><a href="#lvgl-demos">4 LVGL Demos</a></h1>
<p>TODO</p>
<p><em>We‚Äôve seen the LVGL Widgets Demo on NuttX for PinePhone. What about other demos?</em></p>
<p>Yep there are 5 LVGL Demos available in <code>make menuconfig</code>‚Ä¶</p>
<ul>
<li>
<p>Browse into ‚Äú<strong>LVGL</strong> &gt; <strong>LVGL Configuration</strong>‚Äù</p>
<ul>
<li>
<p>In ‚Äú<strong>Demos</strong>‚Äù, select one or more of the these demos‚Ä¶</p>
<p>‚Äú<strong>Show Some Widgets</strong>‚Äù</p>
<p>‚Äú<strong>Demonstrate the usage of encoder and keyboard</strong>‚Äù</p>
<p>‚Äú<strong>Benchmark your system</strong>‚Äù</p>
<p>‚Äú<strong>Stress test for LVGL</strong>‚Äù</p>
<p>‚Äú<strong>Music player demo</strong>‚Äù</p>
</li>
</ul>
</li>
</ul>
<p>For Music Player Demo, we need these fonts‚Ä¶</p>
<ul>
<li>
<p>Browse into ‚Äú<strong>LVGL</strong> &gt; <strong>LVGL Configuration</strong>‚Äù</p>
<ul>
<li>
<p>In ‚Äú<strong>Font usage</strong>‚Äù, select‚Ä¶</p>
<p>‚Äú<strong>Montserrat 16</strong>‚Äù</p>
<p>‚Äú<strong>Montserrat 20</strong>‚Äù</p>
<p>‚Äú<strong>Montserrat 22</strong>‚Äù</p>
<p>‚Äú<strong>Montserrat 32</strong>‚Äù</p>
</li>
</ul>
</li>
</ul>
<p>To run the demos on PinePhone‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>nsh&gt; lvgldemo
Usage: lvgldemo demo_name
demo_name:
  widgets
  keypad_encoder
  benchmark
  stress
  music
</code></pre></div>
<p><a href="https://gist.github.com/lupyuen/b96ed96db295334db1cfabf461efad83">(Source)</a></p>
<p>We‚Äôve seen the LVGL Widgets Demo‚Ä¶</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=N-Yc2jj3TtQ">LVGL Widgets Demo on YouTube</a></li>
</ul>
<p>Here‚Äôs the LVGL Music Player Demo‚Ä¶</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=_cxCnKNibtA">LVGL Music Player Demo on YouTube</a></li>
</ul>
<p>And the LVGL Benchmark Demo‚Ä¶</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=deBzb-VbHck">LVGL Benchmark Demo on YouTube</a></li>
</ul>
<p>From the video we see the LVGL Benchmark Numbers‚Ä¶</p>
<ul>
<li>Weighted Frames Per Second: 20</li>
<li>Opa Speed: 100%</li>
</ul>
<div><table><thead><tr><th>Slow but common cases</th><th>Frames Per Sec</th></tr></thead><tbody>
<tr><td>Image RGB</td><td>19</td></tr>
<tr><td>Image RGB + Opa</td><td>17</td></tr>
<tr><td>Image ARGB</td><td>18</td></tr>
<tr><td>Image ARGB + Opa</td><td>17</td></tr>
<tr><td>Image ARGB Recolor</td><td>17</td></tr>
<tr><td>Image ARGB Recolor + Opa</td><td>16</td></tr>
<tr><td>Substr Image</td><td>19</td></tr>
</tbody></table>
</div><div><table><thead><tr><th>All Cases</th><th>Frames Per Sec</th></tr></thead><tbody>
<tr><td>Rectangle</td><td>24</td></tr>
<tr><td>Rectangle + Opa</td><td>23</td></tr>
<tr><td>Rectangle Rounded</td><td>23</td></tr>
<tr><td>Rectangle Rounded + Opa</td><td>21</td></tr>
<tr><td>Circle</td><td>23</td></tr>
<tr><td>Circle + Opa</td><td>20</td></tr>
<tr><td>Border</td><td>24</td></tr>
<tr><td>Border + Opa</td><td>24</td></tr>
<tr><td>Border Rounded</td><td>24</td></tr>
<tr><td>(Many many more)</td><td></td></tr>
</tbody></table>
</div>
<p>Note that the LVGL Demos start automatically when NuttX boots on PinePhone. Let‚Äôs talk about this‚Ä¶</p>
<h1 id="create-a-touchscreen-app"><a href="#create-a-touchscreen-app">5 Create a Touchscreen App</a></h1>
<p>TODO: Zig?</p>
<p><em>How to create our own LVGL Touchscreen App?</em></p>
<p>Inside our NuttX Project, look for the <strong>LVGL Demo Source Code</strong>‚Ä¶</p>
<ul>
<li><a href="https://github.com/lvgl/lvgl/blob/v8.3.3/demos/widgets/lv_demo_widgets.c#L202-L528">apps/graphics/lvgl/lvgl/ demos/widgets/lv_demo_widgets.c</a></li>
</ul>
<p>Modify the function <a href="https://github.com/lvgl/lvgl/blob/v8.3.3/demos/widgets/lv_demo_widgets.c#L202-L528"><strong>lv_demo_widgets</strong></a> to create our own <strong>LVGL Widgets</strong>‚Ä¶</p>
<div class="example-wrap"><pre class="language-c"><code>// Create a Button, set the Width and Height
void lv_demo_widgets(void) {
  lv_obj_t *btn = lv_btn_create(lv_scr_act());
  lv_obj_set_height(btn, LV_SIZE_CONTENT);
  lv_obj_set_width(btn, 120);
}
</code></pre></div>
<p>For details, check out the <a href="https://docs.lvgl.io/master/widgets/index.html"><strong>LVGL Widget Docs</strong></a>.</p>
<p><em>Now that we can boot NuttX to an LVGL Touchscreen App, what next?</em></p>
<p>Maybe we can create an LVGL Terminal App? That will let us interact with the NSH NuttX Shell?</p>
<p>LVGL already provides an Onscreen Keyboard that works on PinePhone NuttX.</p>
<p>But I have no idea how to start the NSH Process and redirect the Console Input / Output to LVGL ü§î</p>
<p>TODO: LED turns white if <code>lvgldemo</code> fails to start</p>
<h1 id="whats-next"><a href="#whats-next">6 What‚Äôs Next</a></h1>
<p>TODO</p>
<p>Meanwhile please check out the other articles on <strong>NuttX RTOS for PinePhone</strong>‚Ä¶</p>
<ul>
<li>
<p><a href="https://lupyuen.github.io/articles/what"><strong>‚ÄúNuttX RTOS for PinePhone: What is it?‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/arm"><strong>‚ÄúApache NuttX RTOS on Arm Cortex-A53: How it might run on PinePhone‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/uboot"><strong>‚ÄúPinePhone boots Apache NuttX RTOS‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/interrupt"><strong>‚ÄúNuttX RTOS for PinePhone: Fixing the Interrupts‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/serial"><strong>‚ÄúNuttX RTOS for PinePhone: UART Driver‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/pio"><strong>‚ÄúNuttX RTOS for PinePhone: Blinking the LEDs‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/dsi"><strong>‚ÄúUnderstanding PinePhone‚Äôs Display (MIPI DSI)‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/dsi2"><strong>‚ÄúNuttX RTOS for PinePhone: Display Driver in Zig‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/de"><strong>‚ÄúRendering PinePhone‚Äôs Display (DE and TCON0)‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/de2"><strong>‚ÄúNuttX RTOS for PinePhone: Render Graphics in Zig‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/dsi3"><strong>‚ÄúNuttX RTOS for PinePhone: MIPI Display Serial Interface‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/de3"><strong>‚ÄúNuttX RTOS for PinePhone: Display Engine‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/lcd"><strong>‚ÄúNuttX RTOS for PinePhone: LCD Panel‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/touch2"><strong>‚ÄúNuttX RTOS for PinePhone: Touch Panel‚Äù</strong></a></p>
</li>
</ul>
<p>Many Thanks to my <a href="https://github.com/sponsors/lupyuen"><strong>GitHub Sponsors</strong></a> for supporting my work! This article wouldn‚Äôt have been possible without your support.</p>
<ul>
<li>
<p><a href="https://github.com/sponsors/lupyuen"><strong>Sponsor me a coffee</strong></a></p>
</li>
<li>
<p><a href="https://github.com/lupyuen/pinephone-nuttx"><strong>My Current Project: ‚ÄúApache NuttX RTOS for PinePhone‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/articles/book"><strong>My Other Project: ‚ÄúThe RISC-V BL602 Book‚Äù</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io"><strong>Check out my articles</strong></a></p>
</li>
<li>
<p><a href="https://lupyuen.github.io/rss.xml"><strong>RSS Feed</strong></a></p>
</li>
</ul>
<p><em>Got a question, comment or suggestion? Create an Issue or submit a Pull Request here‚Ä¶</em></p>
<p><a href="https://github.com/lupyuen/lupyuen.github.io/blob/master/src/lvgl2.md"><strong>lupyuen.github.io/src/lvgl2.md</strong></a></p>
<h1 id="appendix-build-apache-nuttx-rtos-for-pinephone"><a href="#appendix-build-apache-nuttx-rtos-for-pinephone">7 Appendix: Build Apache NuttX RTOS for PinePhone</a></h1>
<p>TODO</p>
<ol>
<li>
<p>Install the Build Prerequisites, skip the RISC-V Toolchain‚Ä¶</p>
<p><a href="https://lupyuen.github.io/articles/nuttx#install-prerequisites">‚Äú<strong>Install Prerequisites</strong>‚Äù</a></p>
</li>
<li>
<p>Download the ARM64 Toolchain for
<strong>AArch64 Bare-Metal Target <code>aarch64-none-elf</code></strong></p>
<p><a href="https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads"><strong>Arm GNU Toolchain Downloads</strong></a></p>
<p>(Skip the section for Beta Releases)</p>
</li>
<li>
<p>Add the downloaded toolchain to the <strong><code>PATH</code></strong> Environment Variable‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>gcc-arm-...-aarch64-none-elf/bin
</code></pre></div>
<p>Check the ARM64 Toolchain‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>aarch64-none-elf-gcc -v
</code></pre></div></li>
<li>
<p>Download and configure NuttX‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>mkdir nuttx
cd nuttx
git clone https://github.com/apache/nuttx nuttx
git clone https://github.com/apache/nuttx-apps apps

cd nuttx
tools/configure.sh pinephone:lvgl
make menuconfig
</code></pre></div></li>
<li>
<p>TODO: Boot to NuttX App</p>
<p>Browse into ‚Äú<strong>???</strong> &gt; <strong>???</strong>‚Äù</p>
<ul>
<li>
<p>In ‚Äú<strong>???</strong>‚Äù</p>
<p>Enable ‚Äú<strong>???</strong>‚Äù</p>
</li>
</ul>
<p>Save the configuration and exit <strong><code>menuconfig</code></strong></p>
</li>
<li>
<p>Build the NuttX Project‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>make
</code></pre></div>
<p><a href="https://gist.github.com/lupyuen/7ce5f5abedba365cb70b59e39e081cdc">(TODO: See the Build Log)</a></p>
</li>
<li>
<p>TODO: Build then overwrite apps/graphics/lvgl/lvgl/ demos/widgets/lv_demo_widgets.c, then build again</p>
<p><a href="https://github.com/lupyuen2/wip-pinephone-lvgl/blob/pinephone/demos/widgets/lv_demo_widgets.c#L96-L150">lv_demo_widgets.c</a></p>
</li>
<li>
<p>Compress the NuttX Image‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>cp nuttx.bin Image
rm -f Image.gz
gzip Image
</code></pre></div>
<p><a href="https://gist.github.com/lupyuen/7ce5f5abedba365cb70b59e39e081cdc">(TODO: See the Build Log)</a></p>
<p>This produces the file <strong><code>Image.gz</code></strong>, which will be copied to PinePhone.</p>
</li>
<li>
<p>If the build fails with‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>token &quot;@&quot; is not valid in preprocessor
</code></pre></div>
<p>Then look for this file in the ARM64 Toolchain‚Ä¶</p>
<div class="example-wrap"><pre class="language-text"><code>gcc-arm-none-eabi/arm-none-eabi/include/_newlib_version.h
</code></pre></div>
<p>And <a href="https://github.com/apache/nuttx/pull/7284/commits/518b0eb31cb66f25b590ae9a79ab16c319b96b94#diff-12291efd8a0ded1bc38bad733d99e4840ae5112b465c04287f91ba5169612c73"><strong>apply this patch</strong></a>.</p>
</li>
</ol>
<p>TODO: Boot NuttX on PinePhone</p>
<h1 id="appendix-booting-apache-nuttx-rtos-on-pinephone"><a href="#appendix-booting-apache-nuttx-rtos-on-pinephone">8 Appendix: Booting Apache NuttX RTOS on PinePhone</a></h1>
<p>TODO</p>
<p>We‚Äôre ready to boot NuttX on our PinePhone!</p>
<ol>
<li>
<p>Download the <strong>PinePhone Jumpdrive Image <code>pine64-pinephone.img.xz</code></strong> from‚Ä¶</p>
<p><a href="https://github.com/dreemurrs-embedded/Jumpdrive/releases"><strong>dreemurrs-embedded/Jumpdrive</strong></a></p>
<p>Write the downloaded image to a microSD Card with
<a href="https://www.balena.io/etcher/"><strong>Balena Etcher</strong></a></p>
</li>
<li>
<p>Copy the file <strong><code>Image.gz</code></strong> from the previous section.</p>
<p>Overwrite the file on the microSD Card.</p>
<p>(Pic above)</p>
</li>
<li>
<p>On PinePhone, set <a href="https://wiki.pine64.org/index.php/PinePhone#Privacy_switch_configuration"><strong>Privacy Switch 6 (Headphone)</strong></a>
to <strong>Off</strong>.</p>
<p>Connect PinePhone to our computer with the <a href="https://wiki.pine64.org/index.php/PinePhone#Serial_console"><strong>Serial Debug Cable</strong></a>.</p>
<p>On our computer, start a <strong>Serial Terminal</strong> and connect to the USB Serial Port at <strong>115.2 kbps</strong>.</p>
</li>
<li>
<p>Insert the microSD Card into PinePhone and power up PinePhone.</p>
<p>NuttX boots on PinePhone and shows a <a href="https://lupyuen.github.io/images/de3-title.jpg"><strong>Test Pattern</strong></a>.</p>
<p><strong>NuttShell <code>nsh</code></strong> appears in the Serial Console. (Pic below)</p>
<p><a href="https://gist.github.com/lupyuen/5029b5d1195c4ee6a7c74f24897ceecd">(See the Boot Log)</a></p>
</li>
<li>
<p>To see the available commands in NuttShell‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>help
</code></pre></div>
<p>To run the <a href="https://lupyuen.github.io/articles/fb#lvgl-graphics-library"><strong>LVGL Demo App</strong></a>‚Ä¶</p>
<div class="example-wrap"><pre class="language-bash"><code>lvgldemo widgets
</code></pre></div>
<p><a href="https://lupyuen.github.io/images/fb-lvgl3.jpg">(We should see this)</a></p>
</li>
</ol>
<p>And that‚Äôs how we build and boot NuttX for PinePhone!</p>
<p><img src="https://lupyuen.github.io/images/fb-run2.png" alt="Booting Apache NuttX RTOS on PinePhone" /></p>
<p><a href="https://gist.github.com/lupyuen/5029b5d1195c4ee6a7c74f24897ceecd">(See the Boot Log)</a></p>

    
</body>
</html>